---
export const prerender = true;

import { getCollection } from "astro:content";
import Page from "@/wrappers/page.astro";
import { Container } from "@/components/ui";
import { resolveTechnologyIconUrl } from "@/utils/resolve-technology-icon";
import NewsletterCTA from "@/components/newsletter/NewsletterCTA.astro";

// Helper to normalize technology references from videos
function normalizeTechnologyRef(value: unknown): string | undefined {
	if (typeof value === "string") {
		return value.replace(/\/index$/, "");
	}
	if (typeof value === "object" && value !== null) {
		const ref = (value as any).id ?? (value as any).slug;
		if (typeof ref === "string") return ref.replace(/\/index$/, "");
	}
	return undefined;
}

// Compute video counts per technology
const allVideos = await getCollection("videos");
const videoCountsByTech = new Map<string, number>();
for (const video of allVideos) {
	const techs = video.data.technologies;
	if (Array.isArray(techs)) {
		for (const tech of techs) {
			const techId = normalizeTechnologyRef(tech);
			if (techId) {
				videoCountsByTech.set(techId, (videoCountsByTech.get(techId) || 0) + 1);
			}
		}
	}
}

import {
	DIMENSIONS,
	MATRIX_STATUS_VALUES,
	MATRIX_CONFIDENCE_VALUES,
	MATRIX_TRAJECTORY_VALUES,
	type TechnologyStatus,
} from "@/lib/explorer/dimensions";

// Types
type PipelineStage = (typeof MATRIX_STATUS_VALUES)[number];
type Confidence = (typeof MATRIX_CONFIDENCE_VALUES)[number];
type Trajectory = (typeof MATRIX_TRAJECTORY_VALUES)[number];

// CNCF Categories (dynamically discovered from data)
const pipelineStages = MATRIX_STATUS_VALUES.filter(
	(s) => s !== "graveyard" && s !== "guilty-pleasure",
);

// Category display metadata
const categoryIcons: Record<string, string> = {
	Provisioning: "üîß",
	"App Definition and Development": "üíª",
	"Orchestration & Management": "üéØ",
	Runtime: "‚ö°",
	"Observability and Analysis": "üìä",
	Platform: "üèóÔ∏è",
	Wasm: "üåê",
	Serverless: "‚òÅÔ∏è",
	CNAI: "ü§ñ",
};

const categoryDescriptions: Record<string, string> = {
	Provisioning: "Infrastructure automation and setup",
	"App Definition and Development": "Build, package, and deploy applications",
	"Orchestration & Management": "Container and workload management",
	Runtime: "Container runtimes and execution",
	"Observability and Analysis": "Monitoring, logging, and tracing",
	Platform: "Developer platforms and tooling",
	Wasm: "WebAssembly technologies",
	Serverless: "Function-as-a-service and event-driven",
	CNAI: "Cloud Native AI and ML",
};

const stageLabels = Object.fromEntries(
	DIMENSIONS["matrix.status"].values.map((v) => [v.value, v.label]),
);

const stageDescriptions = Object.fromEntries(
	DIMENSIONS["matrix.status"].values.map((v) => [v.value, v.description]),
);

const trajectoryEmoji: Record<Trajectory, string> = {
	rising: "‚Üó",
	stable: "‚Üí",
	falling: "‚Üò",
};

// Get all technologies with matrix data
const allTechnologies = await getCollection("technologies");
const matrixTechnologies = allTechnologies
	.filter((tech) => tech.data.matrix?.status && tech.data.category)
	.map((tech) => ({
		id: tech.id,
		name: tech.data.name,
		category: tech.data.category as string,
		status: tech.data.matrix!.status as PipelineStage,
		icon: resolveTechnologyIconUrl(tech.id, tech.data.logos),
		confidence: tech.data.matrix!.confidence as Confidence | undefined,
		trajectory: tech.data.matrix!.trajectory as Trajectory | undefined,
		// Card back fields
		why: tech.data.matrix!.why,
		firstUsed: tech.data.matrix!.firstUsed,
		lastUsed: tech.data.matrix!.lastUsed,
		makesMeFeel: tech.data.matrix!.makesMeFeel,
		spicyTake: tech.data.matrix!.spicyTake,
		videoCount: videoCountsByTech.get(tech.id) || 0,
		articleCount: 0, // TODO: Wire up when articles have technology links
	}));

// Get unique categories from data, sorted by count (most technologies first)
const categoryCounts = new Map<string, number>();
matrixTechnologies.forEach((tech) => {
	categoryCounts.set(
		tech.category,
		(categoryCounts.get(tech.category) || 0) + 1,
	);
});
const categories = [...categoryCounts.entries()]
	.sort((a, b) => b[1] - a[1])
	.map(([cat]) => cat);

// Build pipeline lanes (by category)
const pipelineLanes = categories.map((category) => ({
	category,
	label: category,
	description: categoryDescriptions[category] || "Cloud native technologies",
	icon: categoryIcons[category] || "üì¶",
	stages: Object.fromEntries(
		pipelineStages.map((stage) => [
			stage,
			matrixTechnologies.filter(
				(t) => t.category === category && t.status === stage,
			),
		]),
	) as Record<PipelineStage, typeof matrixTechnologies>,
}));

// Check for legacy status values and map them (only truly legacy values)
const legacyMapping: Record<string, PipelineStage> = {
	hold: "skip",
	assess: "watch",
	trial: "explore",
};

// Remap legacy values in pipeline lanes
pipelineLanes.forEach((lane) => {
	Object.entries(legacyMapping).forEach(([legacy, modern]) => {
		const legacyTech = matrixTechnologies.filter(
			(t) => t.category === lane.category && (t.status as string) === legacy,
		);
		if (legacyTech.length > 0) {
			lane.stages[modern] = [...lane.stages[modern], ...legacyTech];
		}
	});
});

// Calculate stats per stage
const stageStats = Object.fromEntries(
	pipelineStages.map((stage) => [
		stage,
		matrixTechnologies.filter((t) => t.status === stage).length,
	]),
) as Record<PipelineStage, number>;

// Graveyard: technologies with graveyard status OR deprecated/abandoned status
const graveyardTechnologies = allTechnologies
	.filter(
		(tech) =>
			tech.data.matrix?.status === "graveyard" ||
			tech.data.status === "deprecated" ||
			tech.data.status === "abandoned",
	)
	.map((tech) => ({
		id: tech.id,
		name: tech.data.name,
		status: tech.data.status as TechnologyStatus,
		category: tech.data.category as string | undefined,
		matrixStatus: tech.data.matrix?.status,
		icon: resolveTechnologyIconUrl(tech.id, tech.data.logos),
		confidence: tech.data.matrix?.confidence as Confidence | undefined,
		trajectory: tech.data.matrix?.trajectory as Trajectory | undefined,
		why: tech.data.matrix?.why,
		firstUsed: tech.data.matrix?.firstUsed,
		lastUsed: tech.data.matrix?.lastUsed,
		makesMeFeel: tech.data.matrix?.makesMeFeel,
		spicyTake: tech.data.matrix?.spicyTake,
		videoCount: videoCountsByTech.get(tech.id) || 0,
		articleCount: 0,
	}));

const techStatusLabels = Object.fromEntries(
	DIMENSIONS["status"].values.map((v) => [v.value, v.label]),
);
---

<Page
	title="Technology Matrix"
	description="Rawkode's opinionated guide to cloud native and platform engineering technologies."
>
	<!-- Custom Hero -->
	<section class="matrix-hero">
		<div class="hero-background">
			<div class="hero-gradient"></div>
			<div class="hero-grid"></div>
		</div>
		<Container size="xl" padding="lg">
			<div class="hero-content">
				<div class="hero-badge glass-chip">
					<span class="badge-dot"></span>
					<span>{matrixTechnologies.length} Technologies Mapped</span>
				</div>
				<h1 class="hero-title">
					Technology <span class="title-accent">Matrix</span>
				</h1>
				<p class="hero-subtitle text-secondary-content">
					My opinionated journey through cloud native technologies.
					<br class="hidden md:block" />
					From first glance to full advocacy.
				</p>

				<!-- Mini pipeline preview / Filter links to Advanced Mode -->
				<div class="hero-pipeline-preview" role="group" aria-label="Explore by stage">
					{pipelineStages.map((stage) => (
						<a
							href={`/technology/matrix/advanced?fs=${stage}`}
							class={`preview-stage preview-${stage}`}
						>
							<span class="preview-count">{stageStats[stage]}</span>
							<span class="preview-label">{stageLabels[stage]}</span>
						</a>
					))}
					<a
						href="/technology/matrix/advanced?fs=graveyard"
						class="preview-stage preview-graveyard"
					>
						<span class="preview-count">{graveyardTechnologies.length}</span>
						<span class="preview-label">Graveyard</span>
					</a>
				</div>

				<!-- Advanced Mode CTA -->
				<a href="/technology/matrix/advanced" class="advanced-mode-link">
					<span>Advanced Mode</span>
					<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
					</svg>
				</a>
			</div>
		</Container>
	</section>

	<!-- Legend Section -->
	<section class="matrix-legend">
		<Container size="xl" padding="lg">
			<details class="legend-details">
				<summary class="legend-summary">
					<span class="legend-icon">üìñ</span>
					<span class="legend-title">How to Read This Matrix</span>
					<svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
					</svg>
				</summary>
				<div class="legend-content">
					<p class="legend-intro">
						This matrix represents my personal journey with cloud native technologies. Each stage reflects where a technology sits in my evaluation and adoption process‚Äîfrom first impression to full advocacy. It's opinionated, based on my experience, and constantly evolving.
					</p>
					<div class="legend-stages">
						{pipelineStages.map((stage) => (
							<div class={`legend-stage legend-stage-${stage}`}>
								<div class="stage-indicator"></div>
								<div class="stage-info">
									<span class="stage-name">{stageLabels[stage]}</span>
									<span class="stage-desc">{
										stage === "skip" ? "This technology isn't for me right now, or I haven't played with it yet. This is not a reflection on the technology itself‚Äîit's about what I need at this moment." :
										stage === "watch" ? "Something here piqued my interest. I want to learn more and I'm keeping an eye on its development." :
										stage === "explore" ? "I think people should kick the tyres on this. While I can't recommend it yet, I believe it has a lot to teach you." :
										stage === "learn" ? "A technology I think will be useful to you even if you don't adopt it. Learn it and expand your mind." :
										stage === "adopt" ? "Safe to adopt if it fits your needs. I'd confidently use this in real projects." :
										stage === "advocate" ? "I suggest everyone learn and utilise this technology. I'm actively championing it." :
										stageDescriptions[stage]
									}</span>
								</div>
							</div>
						))}
						<div class="legend-stage legend-stage-graveyard">
							<div class="stage-indicator"></div>
							<div class="stage-info">
								<span class="stage-name">Graveyard</span>
								<span class="stage-desc">I don't think this project should be noticed, nevermind adopted. These technologies burned me, were abandoned, or have been superseded.</span>
							</div>
						</div>
					</div>
				</div>
			</details>
		</Container>
	</section>

	<Container size="xl" padding="lg">
		<!-- Matrix Updates CTA -->
		<NewsletterCTA
			server:defer
			class="mb-8"
			audience="matrix"
			badge="Matrix updates in your inbox"
			headline="Track my technology journey"
			subtitle="Get notified when I move technologies through the matrix‚Äînew discoveries, changed opinions, and spicy takes."
		/>

		<div class="matrix-content">

			<!-- Pipeline Header -->
			<div class="pipeline-header" role="img" aria-label="Pipeline stages from Skip to Advocate">
				<div class="header-flow-line"></div>
				{pipelineStages.map((stage, idx) => (
					<div class={`header-stage header-${stage}`} style={`--stage-index: ${idx}`}>
						<div class="stage-arrow">
							<div class="stage-content">
								<span class="stage-label">{stageLabels[stage]}</span>
								<span class="stage-sublabel">{stageDescriptions[stage]}</span>
							</div>
						</div>
					</div>
				))}
			</div>

			<!-- Pipeline Lanes -->
			<div class="pipeline-lanes">
				{pipelineLanes.map((lane, laneIdx) => (
					<div class="lane-wrapper" style={`--lane-index: ${laneIdx}`} data-lane={lane.category}>
						<div class="lane-tabs">
							<div class="lane-tab">
								<span class="lane-icon">{lane.icon}</span>
								<span class="lane-title">{lane.label}</span>
								<span class="lane-desc text-muted">‚Äî {lane.description}</span>
							</div>
						</div>
						<div class="lane glass-card">
							<div class="lane-grid">
								{pipelineStages.map((stage) => (
									<div class={`lane-cell cell-${stage}`}>
										{lane.stages[stage].length > 0 ? (
											<div class="cell-content">
												{lane.stages[stage].map((tech) => (
													<button
														type="button"
														class={`tech-icon chip-${stage}`}
														data-name={tech.name}
														data-id={tech.id}
														data-status={tech.status}
														data-category={tech.category}
														data-why={tech.why || ""}
														data-first-used={tech.firstUsed || ""}
														data-last-used={tech.lastUsed || ""}
														data-makes-me-feel={tech.makesMeFeel || ""}
														data-spicy-take={tech.spicyTake || ""}
														data-video-count={tech.videoCount}
														data-article-count={tech.articleCount}
														data-confidence={tech.confidence || ""}
														data-trajectory={tech.trajectory || ""}
														data-icon={tech.icon || ""}
													>
														{tech.icon ? (
															<img src={tech.icon} alt={tech.name} class="icon-img" loading="lazy" />
														) : (
															<span class="icon-initial">{tech.name[0]}</span>
														)}
														{tech.trajectory && (
															<span class={`icon-trajectory trajectory-${tech.trajectory}`}>
																{trajectoryEmoji[tech.trajectory]}
															</span>
														)}
													</button>
												))}
											</div>
										) : (
											<div class="cell-empty"></div>
										)}
									</div>
								))}
							</div>
						</div>
					</div>
				))}
			</div>

			<!-- Graveyard Section -->
			{graveyardTechnologies.length > 0 && (
				<div class="graveyard-section">
					<div class="graveyard-header">
						<div class="graveyard-title-group">
							<span class="graveyard-icon">ü™¶</span>
							<h2 class="graveyard-title">Graveyard</h2>
						</div>
						<p class="graveyard-subtitle text-muted">Deprecated, abandoned, or burned me</p>
					</div>
					<div class="graveyard-grid glass-card">
						{graveyardTechnologies.map((tech) => (
							<button
								type="button"
								class="graveyard-item"
								data-name={tech.name}
								data-id={tech.id}
								data-status={tech.matrixStatus || "graveyard"}
								data-category={tech.category || ""}
								data-why={tech.why || ""}
								data-first-used={tech.firstUsed || ""}
								data-last-used={tech.lastUsed || ""}
								data-makes-me-feel={tech.makesMeFeel || ""}
								data-spicy-take={tech.spicyTake || ""}
								data-video-count={tech.videoCount}
								data-article-count={tech.articleCount}
								data-confidence={tech.confidence || ""}
								data-trajectory={tech.trajectory || ""}
								data-icon={tech.icon || ""}
							>
								<div class="graveyard-icon-wrapper">
									{tech.icon ? (
										<img src={tech.icon} alt={tech.name} class="graveyard-img" loading="lazy" />
									) : (
										<span class="graveyard-initial">{tech.name[0]}</span>
									)}
								</div>
								<div class="graveyard-info">
									<span class="graveyard-name">{tech.name}</span>
									<span class={`graveyard-status status-${tech.status}`}>
										{techStatusLabels[tech.status] || tech.status}
									</span>
								</div>
							</button>
						))}
					</div>
				</div>
			)}

		</div>
	</Container>

	<!-- Card Popup Modal -->
	<div id="tech-card-modal" class="modal-backdrop" aria-hidden="true">
		<div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modal-tech-name">
			<button type="button" class="modal-close" aria-label="Close">
				<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
				</svg>
			</button>

			<div class="modal-card-frame">
				<!-- Header -->
				<div class="modal-header">
					<div class="modal-icon-wrapper">
						<img id="modal-icon" src="" alt="" class="modal-icon" />
						<div id="modal-icon-placeholder" class="modal-icon-placeholder"></div>
					</div>
					<div class="modal-titles">
						<h3 id="modal-tech-name" class="modal-name"></h3>
						<div class="modal-meta">
							<span id="modal-status-badge" class="modal-status-badge"></span>
							<span id="modal-category" class="modal-category"></span>
						</div>
					</div>
				</div>

				<!-- Body -->
				<div class="modal-body">
					<div id="modal-why-section" class="modal-section">
						<div class="section-label">Why I use it</div>
						<p id="modal-why" class="section-text"></p>
					</div>

					<div class="modal-stats">
						<div class="modal-stat">
							<span id="modal-videos" class="stat-value">0</span>
							<span class="stat-label">Videos</span>
						</div>
						<div class="modal-stat">
							<span id="modal-articles" class="stat-value">0</span>
							<span class="stat-label">Articles</span>
						</div>
						<div class="modal-stat">
							<span id="modal-first-used" class="stat-value">‚Äî</span>
							<span class="stat-label">First Used</span>
						</div>
						<div class="modal-stat">
							<span id="modal-trajectory" class="stat-value">‚Äî</span>
							<span class="stat-label">Trajectory</span>
						</div>
					</div>

					<div id="modal-spicy-section" class="modal-spicy">
						<span class="spicy-icon">üå∂Ô∏è</span>
						<span id="modal-spicy-take" class="spicy-text"></span>
					</div>
				</div>

				<!-- Footer -->
				<div class="modal-footer">
					<a id="modal-cta-link" href="" class="modal-cta">
						<span>View Details</span>
						<svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
						</svg>
					</a>
				</div>
			</div>
		</div>
	</div>
</Page>

<style>
	/* ===== LEGEND ===== */
	.matrix-legend {
		padding: 0;
		margin-bottom: 2rem;
	}

	.legend-details {
		background: var(--surface-card);
		border: 1px solid var(--surface-border);
		border-radius: 12px;
		overflow: hidden;
	}

	.legend-summary {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		padding: 1rem 1.25rem;
		cursor: pointer;
		user-select: none;
		transition: background 0.2s ease;
	}

	.legend-summary:hover {
		background: var(--surface-card-muted);
	}

	.legend-summary::-webkit-details-marker {
		display: none;
	}

	.legend-summary::marker {
		display: none;
		content: "";
	}

	.legend-icon {
		font-size: 1.25rem;
	}

	.legend-title {
		flex: 1;
		font-size: 0.95rem;
		font-weight: 600;
		color: var(--text-primary-content);
	}

	.legend-summary .chevron {
		transition: transform 0.2s ease;
		color: var(--text-muted);
	}

	.legend-details[open] .chevron {
		transform: rotate(180deg);
	}

	.legend-content {
		padding: 0 1.25rem 1.25rem;
		border-top: 1px solid var(--surface-border);
	}

	.legend-intro {
		margin: 1rem 0 1.5rem;
		font-size: 0.9rem;
		line-height: 1.6;
		color: var(--text-secondary-content);
	}

	.legend-stages {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
		gap: 0.75rem;
	}

	.legend-stage {
		display: flex;
		align-items: flex-start;
		gap: 0.75rem;
		padding: 0.75rem;
		border-radius: 8px;
		background: var(--surface-card-muted);
	}

	.legend-stage .stage-indicator {
		flex-shrink: 0;
		width: 8px;
		height: 8px;
		border-radius: 50%;
		margin-top: 0.375rem;
	}

	.legend-stage-skip .stage-indicator { background: rgb(239, 68, 68); }
	.legend-stage-watch .stage-indicator { background: rgb(249, 115, 22); }
	.legend-stage-explore .stage-indicator { background: rgb(202, 138, 4); }
	.legend-stage-learn .stage-indicator { background: rgb(59, 130, 246); }
	.legend-stage-adopt .stage-indicator { background: rgb(34, 197, 94); }
	.legend-stage-advocate .stage-indicator { background: rgb(var(--brand-primary)); }
	.legend-stage-graveyard .stage-indicator { background: rgb(107, 114, 128); }

	.legend-stage .stage-info {
		display: flex;
		flex-direction: column;
		gap: 0.25rem;
	}

	.legend-stage .stage-name {
		font-size: 0.8rem;
		font-weight: 700;
		text-transform: uppercase;
		letter-spacing: 0.04em;
		color: var(--text-primary-content);
	}

	.legend-stage .stage-desc {
		font-size: 0.8rem;
		line-height: 1.5;
		color: var(--text-secondary-content);
	}

	@media (max-width: 768px) {
		.legend-stages {
			grid-template-columns: 1fr;
		}

		.legend-summary {
			padding: 0.875rem 1rem;
		}

		.legend-content {
			padding: 0 1rem 1rem;
		}
	}

	/* ===== HERO ===== */
	.matrix-hero {
		position: relative;
		padding: 4rem 0 3rem;
		overflow: hidden;
	}

	.hero-background {
		position: absolute;
		inset: 0;
		z-index: 0;
	}

	.hero-gradient {
		position: absolute;
		inset: 0;
		background:
			radial-gradient(ellipse 80% 50% at 50% -20%, rgb(var(--brand-primary) / 0.15), transparent),
			radial-gradient(ellipse 60% 40% at 80% 50%, rgb(var(--brand-secondary) / 0.1), transparent),
			radial-gradient(ellipse 50% 30% at 20% 80%, rgb(var(--brand-primary) / 0.08), transparent);
	}

	.hero-grid {
		position: absolute;
		inset: 0;
		background-image:
			linear-gradient(var(--surface-border) 1px, transparent 1px),
			linear-gradient(90deg, var(--surface-border) 1px, transparent 1px);
		background-size: 60px 60px;
		mask-image: radial-gradient(ellipse at center, black, transparent 70%);
	}

	.hero-content {
		position: relative;
		z-index: 1;
		text-align: center;
	}

	.hero-badge {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		margin-bottom: 1.5rem;
	}

	.badge-dot {
		width: 6px;
		height: 6px;
		background: rgb(var(--brand-primary));
		border-radius: 50%;
		animation: pulse 2s ease-in-out infinite;
	}

	@keyframes pulse {
		0%, 100% { opacity: 1; transform: scale(1); }
		50% { opacity: 0.5; transform: scale(1.2); }
	}

	.hero-title {
		font-size: clamp(2.5rem, 6vw, 4rem);
		font-weight: 800;
		letter-spacing: -0.03em;
		line-height: 1.1;
		margin: 0 0 1rem;
	}

	.title-accent {
		background: linear-gradient(135deg, rgb(var(--brand-primary)), rgb(var(--brand-secondary)));
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
	}

	.hero-subtitle {
		font-size: 1.125rem;
		margin: 0 0 2.5rem;
		line-height: 1.6;
	}

	/* Hero Pipeline Preview */
	.hero-pipeline-preview {
		display: flex;
		justify-content: center;
		gap: 0.25rem;
		flex-wrap: wrap;
		max-width: 600px;
		margin: 0 auto;
	}

	.preview-stage {
		display: flex;
		flex-direction: column;
		align-items: center;
		padding: 0.75rem 1rem;
		border-radius: 8px;
		min-width: 70px;
		transition: transform 0.2s ease, box-shadow 0.2s ease;
		border: 1px solid var(--surface-border);
	}

	.preview-stage:hover {
		transform: translateY(-2px);
	}

	.preview-count {
		font-size: 1.25rem;
		font-weight: 700;
	}

	.preview-label {
		font-size: 0.65rem;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		opacity: 0.8;
	}

	/* Pipeline stage colors - these are semantic to the matrix concept */
	.preview-skip { background: rgba(239, 68, 68, 0.15); color: rgb(239, 68, 68); }
	.preview-watch { background: rgba(249, 115, 22, 0.15); color: rgb(249, 115, 22); }
	.preview-explore { background: rgba(234, 179, 8, 0.15); color: rgb(180, 130, 0); }
	.preview-learn { background: rgba(59, 130, 246, 0.15); color: rgb(59, 130, 246); }
	.preview-adopt { background: rgba(34, 197, 94, 0.15); color: rgb(34, 197, 94); }
	.preview-advocate { background: rgb(var(--brand-primary) / 0.15); color: rgb(var(--brand-primary)); }

	html.dark .preview-skip { background: rgba(239, 68, 68, 0.2); color: rgb(252, 165, 165); }
	html.dark .preview-watch { background: rgba(249, 115, 22, 0.2); color: rgb(253, 186, 116); }
	html.dark .preview-explore { background: rgba(234, 179, 8, 0.2); color: rgb(253, 224, 71); }
	html.dark .preview-learn { background: rgba(59, 130, 246, 0.2); color: rgb(147, 197, 253); }
	html.dark .preview-adopt { background: rgba(34, 197, 94, 0.2); color: rgb(134, 239, 172); }
	html.dark .preview-advocate { background: rgb(var(--brand-primary) / 0.25); color: rgb(var(--brand-secondary)); }

	/* Graveyard preview button */
	.preview-graveyard { background: rgba(107, 114, 128, 0.15); color: rgb(107, 114, 128); }
	html.dark .preview-graveyard { background: rgba(107, 114, 128, 0.25); color: rgb(156, 163, 175); }

	/* Preview stage link styles */
	.preview-stage {
		cursor: pointer;
		font-family: inherit;
		text-decoration: none;
	}

	.preview-stage:hover {
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
	}

	.preview-stage:focus-visible {
		outline: 2px solid currentColor;
		outline-offset: 2px;
	}

	/* Advanced Mode link */
	.advanced-mode-link {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		margin-top: 1.5rem;
		padding: 0.625rem 1.25rem;
		background: rgb(var(--brand-primary));
		color: white;
		font-size: 0.85rem;
		font-weight: 600;
		border-radius: 9999px;
		text-decoration: none;
		transition: all 0.2s ease;
	}

	.advanced-mode-link:hover {
		transform: translateY(-2px);
		box-shadow: 0 4px 12px rgb(var(--brand-primary) / 0.3);
	}

	.advanced-mode-link svg {
		transition: transform 0.2s ease;
	}

	.advanced-mode-link:hover svg {
		transform: translateX(3px);
	}

	/* ===== MATRIX CONTENT ===== */
	.matrix-content {
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}

	/* ===== PIPELINE HEADER ===== */
	.pipeline-header {
		display: flex;
		position: relative;
		gap: 0.25rem;
		padding: 0 0 0.5rem;
		overflow-x: auto;
		scrollbar-width: none;
	}

	.pipeline-header::-webkit-scrollbar {
		display: none;
	}

	.header-flow-line {
		display: none; /* Replaced by chevron shapes */
	}

	.header-stage {
		flex: 1;
		min-width: 130px;
	}

	.stage-arrow {
		display: flex;
		align-items: stretch;
		height: 100%;
		filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
		transition: transform 0.2s ease;
	}

	.stage-arrow:hover {
		transform: translateY(-2px);
		filter: drop-shadow(0 8px 12px rgba(0, 0, 0, 0.15));
		z-index: 10;
	}

	.stage-content {
		flex: 1;
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
		padding: 1rem 1.5rem 1rem 2.5rem; /* Left padding for notch */
		background: var(--stage-color);
		clip-path: polygon(
			0% 0%,
			calc(100% - 1.2rem) 0%,
			100% 50%,
			calc(100% - 1.2rem) 100%,
			0% 100%,
			1.2rem 50%
		);
		transition: all 0.2s ease;
	}

	/* First stage: Flat left */
	.header-stage:first-child .stage-content {
		padding-left: 1.5rem;
		clip-path: polygon(
			0% 0%,
			calc(100% - 1.2rem) 0%,
			100% 50%,
			calc(100% - 1.2rem) 100%,
			0% 100%
		);
		border-top-left-radius: 8px;
		border-bottom-left-radius: 8px;
	}

	/* Last stage: Pointed right */
	.header-stage:last-child .stage-content {
		clip-path: polygon(
			0% 0%,
			100% 0%,
			100% 50%,
			100% 100%,
			0% 100%,
			1.2rem 50%
		);
		padding-right: 1.5rem;
	}

	/* Stage colors */
	.header-skip .stage-content { background: rgb(239, 68, 68); }
	.header-watch .stage-content { background: rgb(249, 115, 22); }
	.header-explore .stage-content { background: rgb(202, 138, 4); }
	.header-learn .stage-content { background: rgb(59, 130, 246); }
	.header-adopt .stage-content { background: rgb(22, 163, 74); }
	
	/* Advocate: Special cool styling */
	.header-advocate .stage-content {
		background: linear-gradient(
			135deg,
			rgb(var(--brand-primary)) 0%,
			rgb(var(--brand-secondary)) 100%
		);
		background-size: 200% 200%;
		animation: shimmer 3s ease infinite;
	}

	@keyframes shimmer {
		0% { background-position: 0% 50%; }
		50% { background-position: 100% 50%; }
		100% { background-position: 0% 50%; }
	}

	.stage-label {
		font-size: 0.85rem;
		font-weight: 800;
		color: white;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		text-shadow: 0 1px 2px rgba(0,0,0,0.1);
	}

	.stage-sublabel {
		font-size: 0.65rem;
		color: rgba(255, 255, 255, 0.9);
		margin-top: 0.125rem;
		font-weight: 500;
	}

	/* ===== PIPELINE LANES ===== */
	.pipeline-lanes {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	.lane-wrapper {
		animation: fadeInUp 0.4s ease-out backwards;
		animation-delay: calc(var(--lane-index) * 0.1s);
	}

	@keyframes fadeInUp {
		from {
			opacity: 0;
			transform: translateY(10px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	/* Tab container */
	.lane-tabs {
		display: flex;
		justify-content: space-between;
		align-items: flex-end;
	}

	/* Manila folder tab */
	.lane-tab {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.5rem 1rem 0.375rem;
		background: var(--surface-card);
		border: 1px solid var(--surface-border);
		border-bottom: none;
		border-radius: 10px 10px 0 0;
		margin-left: 1rem;
		position: relative;
		z-index: 1;
		margin-bottom: -1px;
	}

	.lane-icon {
		font-size: 1rem;
	}

	.lane-title {
		font-size: 0.75rem;
		font-weight: 700;
		text-transform: uppercase;
		letter-spacing: 0.04em;
		color: rgb(17, 24, 39);
	}

	html.dark .lane-title {
		color: rgb(255, 255, 255);
	}

	.lane-desc {
		font-size: 0.7rem;
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
	}

	.lane {
		overflow: hidden;
	}

	.lane-grid {
		display: grid;
		grid-template-columns: repeat(6, 1fr);
	}

	.lane-cell {
		padding: 0.5rem;
		min-height: 48px;
		border-right: 1px solid var(--surface-border);
		transition: background 0.2s ease;
		display: flex;
		align-items: center;
	}

	.lane-cell:last-child {
		border-right: none;
	}

	.lane-cell:hover {
		background: var(--surface-card-muted);
	}

	/* Subtle stage tints */
	.cell-skip { background: rgba(239, 68, 68, 0.03); }
	.cell-watch { background: rgba(249, 115, 22, 0.03); }
	.cell-explore { background: rgba(234, 179, 8, 0.03); }
	.cell-learn { background: rgba(59, 130, 246, 0.03); }
	.cell-adopt { background: rgba(34, 197, 94, 0.04); }
	.cell-advocate { background: rgb(var(--brand-primary) / 0.04); }

	html.dark .cell-skip { background: rgba(239, 68, 68, 0.06); }
	html.dark .cell-watch { background: rgba(249, 115, 22, 0.06); }
	html.dark .cell-explore { background: rgba(234, 179, 8, 0.06); }
	html.dark .cell-learn { background: rgba(59, 130, 246, 0.06); }
	html.dark .cell-adopt { background: rgba(34, 197, 94, 0.08); }
	html.dark .cell-advocate { background: rgb(var(--brand-primary) / 0.08); }

	.cell-content {
		display: flex;
		flex-wrap: wrap;
		gap: 0.5rem;
		align-content: center;
		align-items: center;
	}

	.cell-empty {
		min-height: 20px;
	}

	/* ===== TECH ICONS ===== */
	.tech-icon {
		position: relative;
		display: inline-flex;
		align-items: center;
		justify-content: center;
		width: 36px;
		height: 36px;
		padding: 0;
		background: var(--surface-card);
		border: 1px solid var(--surface-border);
		border-radius: 10px;
		text-decoration: none;
		cursor: pointer;
		font-family: inherit;
		transition: all 0.2s ease;
	}

	.tech-icon:hover {
		transform: scale(1.15);
		border-color: rgb(var(--brand-primary));
		box-shadow: 0 0 0 3px rgb(var(--brand-primary) / 0.2);
	}

	/* Tech icon tooltip */
	.tech-icon::after {
		content: attr(data-name);
		position: absolute;
		bottom: calc(100% + 12px);
		left: 50%;
		transform: translateX(-50%) translateY(4px);
		padding: 0.625rem 1rem;
		background: rgba(17, 24, 39, 0.85);
		backdrop-filter: blur(16px);
		-webkit-backdrop-filter: blur(16px);
		border: 1px solid rgba(255, 255, 255, 0.1);
		border-top: 2px solid rgb(var(--brand-primary));
		border-radius: 10px;
		font-size: 0.8rem;
		font-weight: 600;
		letter-spacing: 0.01em;
		color: #f9fafb;
		white-space: nowrap;
		box-shadow:
			0 8px 32px rgba(0, 0, 0, 0.3),
			0 4px 12px rgba(0, 0, 0, 0.2),
			inset 0 0 0 1px rgba(255, 255, 255, 0.05);
		opacity: 0;
		visibility: hidden;
		transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
		pointer-events: none;
		z-index: 100;
	}

	html.dark .tech-icon::after {
		background: rgba(0, 0, 0, 0.8);
		border-color: rgba(255, 255, 255, 0.15);
		border-top-color: rgb(var(--brand-primary));
	}

	/* Tooltip arrow */
	.tech-icon::before {
		content: "";
		position: absolute;
		bottom: calc(100% + 4px);
		left: 50%;
		transform: translateX(-50%) translateY(4px);
		width: 0;
		height: 0;
		border-left: 8px solid transparent;
		border-right: 8px solid transparent;
		border-top: 8px solid rgba(17, 24, 39, 0.85);
		filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
		opacity: 0;
		visibility: hidden;
		transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
		pointer-events: none;
		z-index: 100;
	}

	html.dark .tech-icon::before {
		border-top-color: rgba(0, 0, 0, 0.8);
	}

	.tech-icon:hover::after,
	.tech-icon:hover::before {
		opacity: 1;
		visibility: visible;
		transform: translateX(-50%) translateY(0);
	}


	.icon-img {
		width: 22px;
		height: 22px;
		object-fit: contain;
		border-radius: 4px;
	}

	.icon-initial {
		width: 22px;
		height: 22px;
		display: flex;
		align-items: center;
		justify-content: center;
		background: var(--surface-card-muted);
		border-radius: 4px;
		font-size: 0.7rem;
		font-weight: 700;
		color: rgb(17, 24, 39);
	}

	html.dark .icon-initial {
		color: rgb(255, 255, 255);
	}

	.icon-trajectory {
		position: absolute;
		bottom: -2px;
		right: -2px;
		font-size: 0.6rem;
		font-weight: 700;
		width: 14px;
		height: 14px;
		display: flex;
		align-items: center;
		justify-content: center;
		background: var(--surface-card);
		border-radius: 50%;
		border: 1px solid var(--surface-border);
		line-height: 1;
	}

	.trajectory-rising { color: rgb(34, 197, 94); }
	.trajectory-stable { color: rgb(156, 163, 175); }
	.trajectory-falling { color: rgb(239, 68, 68); }

	html.dark .trajectory-rising { color: rgb(134, 239, 172); }
	html.dark .trajectory-stable { color: rgb(156, 163, 175); }
	html.dark .trajectory-falling { color: rgb(252, 165, 165); }



	/* ===== RESPONSIVE ===== */
	@media (max-width: 1024px) {
		.pipeline-header {
			padding-bottom: 1rem;
		}

		.lane-desc {
			display: none;
		}
	}

	@media (max-width: 768px) {
		.matrix-hero {
			padding: 3rem 0 2rem;
		}

		.hero-pipeline-preview {
			gap: 0.375rem;
		}

		.preview-stage {
			padding: 0.5rem 0.75rem;
			min-width: 50px;
		}

		.preview-count {
			font-size: 1rem;
		}

		.preview-label {
			font-size: 0.55rem;
		}

		.pipeline-header {
			display: none;
		}

		.lane-tab {
			margin-left: 0.5rem;
		}

		.lane-desc {
			display: none;
		}

		.lane-grid {
			display: flex;
			flex-direction: column;
		}

		.lane-cell {
			border-right: none;
			border-bottom: 1px solid var(--surface-border);
			min-height: auto;
			padding: 0.75rem;
			flex-direction: column;
			align-items: flex-start;
			gap: 0.5rem;
		}

		.lane-cell:empty,
		.lane-cell:has(.cell-empty) {
			display: none;
		}

		.lane-cell::before {
			content: attr(data-stage);
			display: block;
			font-size: 0.6rem;
			font-weight: 600;
			text-transform: uppercase;
			letter-spacing: 0.05em;
			opacity: 0.7;
		}

		.cell-skip::before { content: 'Skip'; color: rgb(239, 68, 68); }
		.cell-watch::before { content: 'Watch'; color: rgb(249, 115, 22); }
		.cell-explore::before { content: 'Explore'; color: rgb(202, 138, 4); }
		.cell-learn::before { content: 'Learn'; color: rgb(59, 130, 246); }
		.cell-adopt::before { content: 'Adopt'; color: rgb(34, 197, 94); }
		.cell-advocate::before { content: 'Advocate'; color: rgb(var(--brand-primary)); }

		.cell-content {
			gap: 0.75rem;
		}

		.tech-icon {
			width: 40px;
			height: 40px;
		}

		.icon-img {
			width: 24px;
			height: 24px;
		}

	}

	/* ===== MODAL POPUP ===== */
	.modal-backdrop {
		position: fixed;
		inset: 0;
		z-index: 999;
		background: rgba(0, 0, 0, 0.6);
		backdrop-filter: blur(4px);
		display: flex;
		align-items: center;
		justify-content: center;
		opacity: 0;
		visibility: hidden;
		transition: opacity 0.2s ease, visibility 0.2s ease;
	}

	.modal-backdrop.visible {
		opacity: 1;
		visibility: visible;
	}

	.modal-content {
		position: relative;
		width: 480px;
		max-width: calc(100vw - 3rem);
		max-height: calc(100vh - 4rem);
		overflow-y: auto;
		transform: scale(0.95);
		transition: transform 0.2s ease;
	}

	.modal-backdrop.visible .modal-content {
		transform: scale(1);
	}

	.modal-close {
		position: absolute;
		top: 1rem;
		right: 1rem;
		z-index: 10;
		width: 40px;
		height: 40px;
		display: flex;
		align-items: center;
		justify-content: center;
		background: var(--surface-card);
		border: 1px solid var(--surface-border);
		border-radius: 50%;
		color: var(--text-muted);
		cursor: pointer;
		transition: all 0.15s ease;
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
	}

	.modal-close:hover {
		background: var(--surface-card-muted);
		color: var(--text-primary-content);
		transform: scale(1.05);
	}

	.modal-card-frame {
		background: var(--surface-card);
		border: 1px solid var(--surface-border);
		border-radius: 1.5rem;
		overflow: hidden;
		box-shadow:
			0 25px 50px rgba(0, 0, 0, 0.25),
			0 0 0 1px rgba(0, 0, 0, 0.05);
	}

	.modal-header {
		display: flex;
		align-items: center;
		gap: 1.25rem;
		padding: 1.75rem;
		background: var(--surface-card-muted);
		border-bottom: 4px solid var(--text-muted);
	}

	.modal-header.status-skip { border-bottom-color: #ef4444; }
	.modal-header.status-watch { border-bottom-color: #f97316; }
	.modal-header.status-explore { border-bottom-color: #ca8a04; }
	.modal-header.status-learn { border-bottom-color: #3b82f6; }
	.modal-header.status-adopt { border-bottom-color: #22c55e; }
	.modal-header.status-advocate { border-bottom-color: rgb(var(--brand-primary)); }
	.modal-header.status-graveyard { border-bottom-color: #6b7280; }

	.modal-icon-wrapper {
		flex-shrink: 0;
	}

	.modal-icon {
		width: 80px;
		height: 80px;
		object-fit: contain;
		border-radius: 1rem;
		background: var(--surface-card);
		padding: 0.875rem;
		border: 1px solid var(--surface-border);
	}

	.modal-icon-placeholder {
		width: 80px;
		height: 80px;
		display: none;
		align-items: center;
		justify-content: center;
		background: var(--surface-card);
		border-radius: 1rem;
		border: 1px solid var(--surface-border);
		font-size: 2rem;
		font-weight: 700;
		color: var(--text-primary-content);
	}

	.modal-titles {
		flex: 1;
		min-width: 0;
	}

	.modal-name {
		font-size: 1.75rem;
		font-weight: 700;
		color: var(--text-primary-content);
		margin: 0 0 0.625rem;
		line-height: 1.2;
	}

	.modal-meta {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		flex-wrap: wrap;
	}

	.modal-status-badge {
		font-size: 0.75rem;
		font-weight: 700;
		text-transform: uppercase;
		letter-spacing: 0.04em;
		padding: 0.375rem 0.75rem;
		border-radius: 0.375rem;
		color: white;
		background: var(--text-muted);
	}

	.modal-status-badge.status-skip { background: #ef4444; }
	.modal-status-badge.status-watch { background: #f97316; }
	.modal-status-badge.status-explore { background: #ca8a04; }
	.modal-status-badge.status-learn { background: #3b82f6; }
	.modal-status-badge.status-adopt { background: #22c55e; }
	.modal-status-badge.status-advocate { background: rgb(var(--brand-primary)); }
	.modal-status-badge.status-graveyard { background: #6b7280; }

	.modal-category {
		font-size: 0.875rem;
		color: var(--text-secondary-content);
	}

	.modal-body {
		display: flex;
		flex-direction: column;
		gap: 1.25rem;
		padding: 1.5rem 1.75rem;
	}

	.modal-section {
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
	}

	.modal-section .section-label {
		font-size: 0.6875rem;
		font-weight: 700;
		text-transform: uppercase;
		letter-spacing: 0.08em;
		color: var(--text-muted);
	}

	.modal-section .section-text {
		font-size: 0.9375rem;
		line-height: 1.6;
		color: var(--text-secondary-content);
		margin: 0;
	}

	.modal-stats {
		display: grid;
		grid-template-columns: repeat(4, 1fr);
		gap: 0.75rem;
	}

	.modal-stat {
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 0.25rem;
		padding: 0.875rem 0.5rem;
		background: var(--surface-card-muted);
		border-radius: 0.75rem;
	}

	.modal-stat .stat-value {
		font-size: 1rem;
		font-weight: 700;
		color: var(--text-primary-content);
	}

	.modal-stat .stat-label {
		font-size: 0.625rem;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.04em;
		color: var(--text-muted);
		text-align: center;
	}

	.modal-spicy {
		display: none;
		align-items: flex-start;
		gap: 0.75rem;
		padding: 1rem;
		background: rgba(239, 68, 68, 0.08);
		border: 1px solid rgba(239, 68, 68, 0.15);
		border-radius: 0.75rem;
	}

	.modal-spicy.visible {
		display: flex;
	}

	.modal-spicy .spicy-icon {
		font-size: 1.125rem;
		flex-shrink: 0;
		line-height: 1.4;
	}

	.modal-spicy .spicy-text {
		font-size: 0.875rem;
		font-style: italic;
		color: #be123c;
		line-height: 1.5;
	}

	html.dark .modal-spicy .spicy-text {
		color: #fda4af;
	}

	.modal-footer {
		padding: 0 1.75rem 1.75rem;
	}

	.modal-cta {
		display: flex;
		align-items: center;
		justify-content: center;
		gap: 0.625rem;
		width: 100%;
		padding: 1rem 1.5rem;
		background: linear-gradient(135deg, rgb(var(--brand-primary)) 0%, rgb(var(--brand-secondary)) 100%);
		color: white;
		border-radius: 0.75rem;
		font-size: 0.875rem;
		font-weight: 700;
		text-transform: uppercase;
		letter-spacing: 0.04em;
		text-decoration: none;
		transition: all 0.2s ease;
	}

	.modal-cta:hover {
		transform: translateY(-2px);
		box-shadow: 0 8px 20px rgb(var(--brand-primary) / 0.35);
	}

	.modal-cta svg {
		transition: transform 0.2s ease;
	}

	.modal-cta:hover svg {
		transform: translateX(4px);
	}

	@media (max-width: 540px) {
		.modal-content {
			width: calc(100vw - 2rem);
		}

		.modal-header {
			padding: 1.25rem;
			gap: 1rem;
		}

		.modal-icon,
		.modal-icon-placeholder {
			width: 64px;
			height: 64px;
		}

		.modal-name {
			font-size: 1.375rem;
		}

		.modal-body {
			padding: 1.25rem;
		}

		.modal-stats {
			grid-template-columns: repeat(2, 1fr);
		}

		.modal-footer {
			padding: 0 1.25rem 1.25rem;
		}
	}

	/* ===== GRAVEYARD SECTION ===== */
	.graveyard-section {
		margin-top: 3rem;
		padding-top: 2rem;
		border-top: 1px solid var(--surface-border);
	}

	.graveyard-header {
		display: flex;
		flex-direction: column;
		gap: 0.25rem;
		margin-bottom: 1rem;
	}

	.graveyard-title-group {
		display: flex;
		align-items: center;
		gap: 0.5rem;
	}

	.graveyard-icon {
		font-size: 1.5rem;
	}

	.graveyard-title {
		font-size: 1.25rem;
		font-weight: 700;
		color: rgb(107, 114, 128);
		margin: 0;
	}

	html.dark .graveyard-title {
		color: rgb(156, 163, 175);
	}

	.graveyard-subtitle {
		font-size: 0.85rem;
		margin: 0;
		padding-left: 2.25rem;
	}

	.graveyard-grid {
		display: flex;
		flex-wrap: wrap;
		gap: 0.75rem;
		padding: 1rem;
		background: rgba(107, 114, 128, 0.05);
	}

	html.dark .graveyard-grid {
		background: rgba(55, 65, 81, 0.3);
	}

	.graveyard-item {
		position: relative;
		display: flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.5rem 0.75rem;
		background: var(--surface-card);
		border: 1px solid var(--surface-border);
		border-radius: 10px;
		text-decoration: none;
		cursor: pointer;
		font-family: inherit;
		font-size: inherit;
		transition: all 0.2s ease;
		opacity: 0.7;
	}

	/* Graveyard item tooltip */
	.graveyard-item::after {
		content: "View details";
		position: absolute;
		bottom: calc(100% + 10px);
		left: 50%;
		transform: translateX(-50%) translateY(4px);
		padding: 0.5rem 0.875rem;
		background: rgba(17, 24, 39, 0.85);
		backdrop-filter: blur(16px);
		-webkit-backdrop-filter: blur(16px);
		border: 1px solid rgba(255, 255, 255, 0.1);
		border-top: 2px solid #6b7280;
		border-radius: 8px;
		font-size: 0.75rem;
		font-weight: 600;
		letter-spacing: 0.02em;
		color: #f9fafb;
		white-space: nowrap;
		box-shadow:
			0 8px 32px rgba(0, 0, 0, 0.3),
			0 4px 12px rgba(0, 0, 0, 0.2),
			inset 0 0 0 1px rgba(255, 255, 255, 0.05);
		opacity: 0;
		visibility: hidden;
		transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
		pointer-events: none;
		z-index: 100;
	}

	html.dark .graveyard-item::after {
		background: rgba(0, 0, 0, 0.8);
		border-color: rgba(255, 255, 255, 0.15);
		border-top-color: #6b7280;
	}

	.graveyard-item::before {
		content: "";
		position: absolute;
		bottom: calc(100% + 2px);
		left: 50%;
		transform: translateX(-50%) translateY(4px);
		width: 0;
		height: 0;
		border-left: 6px solid transparent;
		border-right: 6px solid transparent;
		border-top: 6px solid rgba(17, 24, 39, 0.85);
		opacity: 0;
		visibility: hidden;
		transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
		pointer-events: none;
		z-index: 100;
	}

	html.dark .graveyard-item::before {
		border-top-color: rgba(0, 0, 0, 0.8);
	}

	.graveyard-item:hover::after,
	.graveyard-item:hover::before {
		opacity: 1;
		visibility: visible;
		transform: translateX(-50%) translateY(0);
	}

	.graveyard-item:hover {
		opacity: 1;
		transform: translateY(-2px);
		border-color: rgb(107, 114, 128);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
	}

	html.dark .graveyard-item:hover {
		border-color: rgb(156, 163, 175);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
	}

	.graveyard-icon-wrapper {
		width: 28px;
		height: 28px;
		display: flex;
		align-items: center;
		justify-content: center;
		filter: grayscale(70%);
		transition: filter 0.2s ease;
	}

	.graveyard-item:hover .graveyard-icon-wrapper {
		filter: grayscale(30%);
	}

	.graveyard-img {
		width: 24px;
		height: 24px;
		object-fit: contain;
		border-radius: 4px;
	}

	.graveyard-initial {
		width: 24px;
		height: 24px;
		display: flex;
		align-items: center;
		justify-content: center;
		background: var(--surface-card-muted);
		border-radius: 4px;
		font-size: 0.7rem;
		font-weight: 700;
		color: rgb(107, 114, 128);
	}

	.graveyard-info {
		display: flex;
		flex-direction: column;
		gap: 0.125rem;
	}

	.graveyard-name {
		font-size: 0.8rem;
		font-weight: 600;
		color: rgb(75, 85, 99);
		line-height: 1.2;
	}

	html.dark .graveyard-name {
		color: rgb(209, 213, 219);
	}

	.graveyard-status {
		font-size: 0.6rem;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.04em;
	}

	.graveyard-status.status-deprecated {
		color: rgb(234, 179, 8);
	}

	.graveyard-status.status-abandoned {
		color: rgb(239, 68, 68);
	}

	html.dark .graveyard-status.status-deprecated {
		color: rgb(253, 224, 71);
	}

	html.dark .graveyard-status.status-abandoned {
		color: rgb(252, 165, 165);
	}

	@media (max-width: 768px) {
		.graveyard-section {
			margin-top: 2rem;
			padding-top: 1.5rem;
		}

		.graveyard-grid {
			gap: 0.5rem;
			padding: 0.75rem;
		}

		.graveyard-item {
			padding: 0.375rem 0.5rem;
		}

		.graveyard-name {
			font-size: 0.75rem;
		}
	}
</style>

<script>
	const statusLabels: Record<string, string> = {
		"skip": "Skip",
		"watch": "Watch",
		"explore": "Explore",
		"learn": "Learn",
		"adopt": "Adopt",
		"advocate": "Advocate",
		"graveyard": "Graveyard",
	};

	const trajectoryIcons: Record<string, string> = {
		"rising": "‚ÜóÔ∏è",
		"stable": "‚Üí",
		"falling": "‚ÜòÔ∏è",
	};

	function formatDate(dateStr: string): string {
		if (!dateStr) return "‚Äî";
		const [year, month] = dateStr.split("-");
		if (!year || !month) return dateStr;
		const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
		return `${months[parseInt(month, 10) - 1]} ${year}`;
	}

	// Modal elements
	const modal = document.getElementById('tech-card-modal');
	const modalIcon = document.getElementById('modal-icon') as HTMLImageElement;
	const modalIconPlaceholder = document.getElementById('modal-icon-placeholder');
	const modalName = document.getElementById('modal-tech-name');
	const modalStatusBadge = document.getElementById('modal-status-badge');
	const modalCategory = document.getElementById('modal-category');
	const modalHeader = modal?.querySelector('.modal-header');
	const modalWhySection = document.getElementById('modal-why-section');
	const modalWhy = document.getElementById('modal-why');
	const modalVideos = document.getElementById('modal-videos');
	const modalArticles = document.getElementById('modal-articles');
	const modalFirstUsed = document.getElementById('modal-first-used');
	const modalTrajectory = document.getElementById('modal-trajectory');
	const modalSpicySection = document.getElementById('modal-spicy-section');
	const modalSpicyTake = document.getElementById('modal-spicy-take');
	const modalCtaLink = document.getElementById('modal-cta-link') as HTMLAnchorElement;
	const modalClose = modal?.querySelector('.modal-close');

	function showModal(button: Element) {
		const id = button.getAttribute('data-id') || "";
		const name = button.getAttribute('data-name') || "";
		const status = button.getAttribute('data-status') || "";
		const category = button.getAttribute('data-category') || "";
		const why = button.getAttribute('data-why') || "";
		const firstUsed = button.getAttribute('data-first-used') || "";
		const spicy = button.getAttribute('data-spicy-take') || "";
		const videoCount = button.getAttribute('data-video-count') || "0";
		const articleCount = button.getAttribute('data-article-count') || "0";
		const trajectory = button.getAttribute('data-trajectory') || "";
		const iconUrl = button.getAttribute('data-icon') || "";

		// Populate modal
		if (modalIcon && modalIconPlaceholder) {
			if (iconUrl) {
				modalIcon.src = iconUrl;
				modalIcon.alt = name;
				modalIcon.style.display = 'block';
				modalIconPlaceholder.style.display = 'none';
			} else {
				modalIcon.style.display = 'none';
				modalIconPlaceholder.textContent = name[0] || '?';
				modalIconPlaceholder.style.display = 'flex';
			}
		}

		if (modalName) modalName.textContent = name;

		if (modalStatusBadge) {
			modalStatusBadge.textContent = statusLabels[status] || status;
			modalStatusBadge.className = `modal-status-badge status-${status}`;
		}

		if (modalCategory) modalCategory.textContent = category || "Uncategorized";

		if (modalHeader) {
			modalHeader.className = `modal-header status-${status}`;
		}

		if (modalWhySection && modalWhy) {
			if (why) {
				modalWhy.textContent = why;
				modalWhySection.style.display = 'flex';
			} else {
				modalWhySection.style.display = 'none';
			}
		}

		if (modalVideos) modalVideos.textContent = videoCount;
		if (modalArticles) modalArticles.textContent = articleCount;
		if (modalFirstUsed) modalFirstUsed.textContent = formatDate(firstUsed);
		if (modalTrajectory) modalTrajectory.textContent = trajectoryIcons[trajectory] || "‚Äî";

		if (modalSpicySection && modalSpicyTake) {
			if (spicy) {
				modalSpicyTake.textContent = spicy;
				modalSpicySection.classList.add('visible');
			} else {
				modalSpicySection.classList.remove('visible');
			}
		}

		if (modalCtaLink) {
			modalCtaLink.href = `/technology/${id}`;
		}

		// Show modal
		modal?.classList.add('visible');
		modal?.setAttribute('aria-hidden', 'false');
		document.body.style.overflow = 'hidden';
	}

	function hideModal() {
		modal?.classList.remove('visible');
		modal?.setAttribute('aria-hidden', 'true');
		document.body.style.overflow = '';
	}

	// Close modal on backdrop click
	modal?.addEventListener('click', (e) => {
		if (e.target === modal) {
			hideModal();
		}
	});

	// Close modal on close button click
	modalClose?.addEventListener('click', hideModal);

	// Close modal on escape key
	document.addEventListener('keydown', (e) => {
		if (e.key === 'Escape' && modal?.classList.contains('visible')) {
			hideModal();
		}
	});

	// Add click handlers to all tech icons
	document.querySelectorAll('.tech-icon').forEach(button => {
		button.addEventListener('click', (e) => {
			e.preventDefault();
			showModal(button);
		});
	});

	// Add click handlers to graveyard items
	document.querySelectorAll('.graveyard-item').forEach(button => {
		button.addEventListener('click', (e) => {
			e.preventDefault();
			showModal(button);
		});
	});
</script>
