var zl=Object.create;var nr=Object.defineProperty;var Vl=Object.getOwnPropertyDescriptor;var Kl=Object.getOwnPropertyNames;var Yl=Object.getPrototypeOf,Jl=Object.prototype.hasOwnProperty;var i=(t,e)=>nr(t,"name",{value:e,configurable:!0});var Z=(t,e)=>()=>(t&&(e=t(t=0)),e);var se=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Qs=(t,e)=>{for(var r in e)nr(t,r,{get:e[r],enumerable:!0})},ks=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Kl(e))!Jl.call(t,s)&&s!==r&&nr(t,s,{get:()=>e[s],enumerable:!(n=Vl(e,s))||n.enumerable});return t};var zs=(t,e,r)=>(r=t!=null?zl(Yl(t)):{},ks(e||!t||!t.__esModule?nr(r,"default",{value:t,enumerable:!0}):r,t)),Gl=t=>ks(nr({},"__esModule",{value:!0}),t);function Vs(t){let e=[];for(let r in t)if(Array.isArray(t[r]))for(let n of t[r])e.push(r,n);else e.push(r,t[r]);return e}function he(t){return new Error(`[unenv] ${t} is not implemented yet!`)}function we(t){return Object.assign(i(()=>{throw he(t)},"fn"),{__unenv__:!0})}function rt(t){return class{__unenv__=!0;constructor(){throw new Error(`[unenv] ${t} is not implemented yet!`)}}}var Rt=Z(()=>{d();f();c();i(Vs,"rawHeaders");i(he,"createNotImplementedError");i(we,"notImplemented");i(rt,"notImplementedClass")});var Jn,Gn,Wl,It,Wn,ir,sr,qr,or,jr,Ks,Ys=Z(()=>{d();f();c();Rt();Jn=globalThis.performance?.timeOrigin??Date.now(),Gn=globalThis.performance?.now?globalThis.performance.now.bind(globalThis.performance):()=>Date.now()-Jn,Wl={name:"node",entryType:"node",startTime:0,duration:0,nodeStart:0,v8Start:0,bootstrapComplete:0,environment:0,loopStart:0,loopExit:0,idleTime:0,uvMetricsInfo:{loopCount:0,events:0,eventsWaiting:0},detail:void 0,toJSON(){return this}},It=class{static{i(this,"PerformanceEntry")}__unenv__=!0;detail;entryType="event";name;startTime;constructor(e,r){this.name=e,this.startTime=r?.startTime||Gn(),this.detail=r?.detail}get duration(){return Gn()-this.startTime}toJSON(){return{name:this.name,entryType:this.entryType,startTime:this.startTime,duration:this.duration,detail:this.detail}}},Wn=class extends It{static{i(this,"PerformanceMark")}entryType="mark";constructor(){super(...arguments)}get duration(){return 0}},ir=class extends It{static{i(this,"PerformanceMeasure")}entryType="measure"},sr=class extends It{static{i(this,"PerformanceResourceTiming")}entryType="resource";serverTiming=[];connectEnd=0;connectStart=0;decodedBodySize=0;domainLookupEnd=0;domainLookupStart=0;encodedBodySize=0;fetchStart=0;initiatorType="";name="";nextHopProtocol="";redirectEnd=0;redirectStart=0;requestStart=0;responseEnd=0;responseStart=0;secureConnectionStart=0;startTime=0;transferSize=0;workerStart=0;responseStatus=0},qr=class{static{i(this,"PerformanceObserverEntryList")}__unenv__=!0;getEntries(){return[]}getEntriesByName(e,r){return[]}getEntriesByType(e){return[]}},or=class{static{i(this,"Performance")}__unenv__=!0;timeOrigin=Jn;eventCounts=new Map;_entries=[];_resourceTimingBufferSize=0;navigation=void 0;timing=void 0;timerify(e,r){throw he("Performance.timerify")}get nodeTiming(){return Wl}eventLoopUtilization(){return{}}markResourceTiming(){return new sr("")}onresourcetimingbufferfull=null;now(){return this.timeOrigin===Jn?Gn():Date.now()-this.timeOrigin}clearMarks(e){this._entries=e?this._entries.filter(r=>r.name!==e):this._entries.filter(r=>r.entryType!=="mark")}clearMeasures(e){this._entries=e?this._entries.filter(r=>r.name!==e):this._entries.filter(r=>r.entryType!=="measure")}clearResourceTimings(){this._entries=this._entries.filter(e=>e.entryType!=="resource"||e.entryType!=="navigation")}getEntries(){return this._entries}getEntriesByName(e,r){return this._entries.filter(n=>n.name===e&&(!r||n.entryType===r))}getEntriesByType(e){return this._entries.filter(r=>r.entryType===e)}mark(e,r){let n=new Wn(e,r);return this._entries.push(n),n}measure(e,r,n){let s,o;typeof r=="string"?(s=this.getEntriesByName(r,"mark")[0]?.startTime,o=this.getEntriesByName(n,"mark")[0]?.startTime):(s=Number.parseFloat(r?.start)||this.now(),o=Number.parseFloat(r?.end)||this.now());let a=new ir(e,{startTime:s,detail:{start:s,end:o}});return this._entries.push(a),a}setResourceTimingBufferSize(e){this._resourceTimingBufferSize=e}addEventListener(e,r,n){throw he("Performance.addEventListener")}removeEventListener(e,r,n){throw he("Performance.removeEventListener")}dispatchEvent(e){throw he("Performance.dispatchEvent")}toJSON(){return this}},jr=class{static{i(this,"PerformanceObserver")}__unenv__=!0;static supportedEntryTypes=[];_callback=null;constructor(e){this._callback=e}takeRecords(){return[]}disconnect(){throw he("PerformanceObserver.disconnect")}observe(e){throw he("PerformanceObserver.observe")}bind(e){return e}runInAsyncScope(e,r,...n){return e.call(r,...n)}asyncId(){return 0}triggerAsyncId(){return 0}emitDestroy(){return this}},Ks=globalThis.performance&&"addEventListener"in globalThis.performance?globalThis.performance:new or});var Js=Z(()=>{d();f();c();Ys()});var c=Z(()=>{Js();globalThis.performance=Ks;globalThis.Performance=or;globalThis.PerformanceEntry=It;globalThis.PerformanceMark=Wn;globalThis.PerformanceMeasure=ir;globalThis.PerformanceObserver=jr;globalThis.PerformanceObserverEntryList=qr;globalThis.PerformanceResourceTiming=sr});var Re,Gs=Z(()=>{d();f();c();Re=Object.assign(()=>{},{__unenv__:!0})});import{Writable as Ws}from"node:stream";var Te,Xs,Zs,eo,Fr,Xl,n0,i0,s0,Zl,o0,a0,u0,l0,c0,f0,d0,h0,m0,p0,g0,y0,E0,T0,S0,_0,to,ro,no,io,so=Z(()=>{d();f();c();Gs();Rt();Te=globalThis.console,Xs=!0,Zs=new Ws,eo=new Ws,Fr=Te?.log??Re,Xl=Te?.info??Fr,n0=Te?.trace??Xl,i0=Te?.debug??Fr,s0=Te?.table??Fr,Zl=Te?.error??Fr,o0=Te?.warn??Zl,a0=Te?.createTask??we("console.createTask"),u0=Te?.clear??Re,l0=Te?.count??Re,c0=Te?.countReset??Re,f0=Te?.dir??Re,d0=Te?.dirxml??Re,h0=Te?.group??Re,m0=Te?.groupEnd??Re,p0=Te?.groupCollapsed??Re,g0=Te?.profile??Re,y0=Te?.profileEnd??Re,E0=Te?.time??Re,T0=Te?.timeEnd??Re,S0=Te?.timeLog??Re,_0=Te?.timeStamp??Re,to=Te?.Console??rt("console.Console"),ro=new Map,no=Re,io=Re});var Xn,O0,x0,R0,I0,P0,B0,D0,L0,M0,U0,$0,q0,j0,F0,H0,Q0,k0,z0,V0,K0,Y0,J0,G0,W0,oo,ao=Z(()=>{d();f();c();so();Xn=globalThis.console,{assert:O0,clear:x0,context:R0,count:I0,countReset:P0,createTask:B0,debug:D0,dir:L0,dirxml:M0,error:U0,group:$0,groupCollapsed:q0,groupEnd:j0,info:F0,log:H0,profile:Q0,profileEnd:k0,table:z0,time:V0,timeEnd:K0,timeLog:Y0,timeStamp:J0,trace:G0,warn:W0}=Xn;Object.assign(Xn,{Console:to,_ignoreErrors:Xs,_stderr:Zs,_stderrErrorHandler:io,_stdout:eo,_stdoutErrorHandler:no,_times:ro});oo=Xn});var f=Z(()=>{ao();globalThis.console=oo});var uo,lo=Z(()=>{d();f();c();uo=Object.assign(i(function(e){let r=Date.now(),n=Math.trunc(r/1e3),s=r%1e3*1e6;if(e){let o=n-e[0],a=s-e[0];return a<0&&(o=o-1,a=1e9+a),[o,a]}return[n,s]},"hrtime"),{bigint:i(function(){return BigInt(Date.now()*1e6)},"bigint")})});var ar,co=Z(()=>{d();f();c();ar=class{static{i(this,"ReadStream")}fd;isRaw=!1;isTTY=!1;constructor(e){this.fd=e}setRawMode(e){return this.isRaw=e,this}}});var jt,fo=Z(()=>{d();f();c();jt=class{static{i(this,"WriteStream")}fd;columns=80;rows=24;isTTY=!1;constructor(e){this.fd=e}clearLine(e,r){return r&&r(),!1}clearScreenDown(e){return e&&e(),!1}cursorTo(e,r,n){return n&&typeof n=="function"&&n(),!1}moveCursor(e,r,n){return n&&n(),!1}getColorDepth(e){return 1}hasColors(e,r){return!1}getWindowSize(){return[this.columns,this.rows]}write(e,r,n){e instanceof Uint8Array&&(e=new TextDecoder().decode(e));try{console.log(e)}catch{}return n&&typeof n=="function"&&n(),!1}}});var ho=Z(()=>{d();f();c();co();fo()});var Zn,mo=Z(()=>{d();f();c();Zn="22.14.0"});import{EventEmitter as po}from"node:events";var Hr,go=Z(()=>{d();f();c();ho();Rt();mo();Hr=class t extends po{static{i(this,"Process")}env;hrtime;nextTick;constructor(e){super(),this.env=e.env,this.hrtime=e.hrtime,this.nextTick=e.nextTick;for(let r of[...Object.getOwnPropertyNames(t.prototype),...Object.getOwnPropertyNames(po.prototype)]){let n=this[r];typeof n=="function"&&(this[r]=n.bind(this))}}emitWarning(e,r,n){console.warn(`${n?`[${n}] `:""}${r?`${r}: `:""}${e}`)}emit(...e){return super.emit(...e)}listeners(e){return super.listeners(e)}#t;#r;#n;get stdin(){return this.#t??=new ar(0)}get stdout(){return this.#r??=new jt(1)}get stderr(){return this.#n??=new jt(2)}#e="/";chdir(e){this.#e=e}cwd(){return this.#e}arch="";platform="";argv=[];argv0="";execArgv=[];execPath="";title="";pid=200;ppid=100;get version(){return`v${Zn}`}get versions(){return{node:Zn}}get allowedNodeEnvironmentFlags(){return new Set}get sourceMapsEnabled(){return!1}get debugPort(){return 0}get throwDeprecation(){return!1}get traceDeprecation(){return!1}get features(){return{}}get release(){return{}}get connected(){return!1}get config(){return{}}get moduleLoadList(){return[]}constrainedMemory(){return 0}availableMemory(){return 0}uptime(){return 0}resourceUsage(){return{}}ref(){}unref(){}umask(){throw he("process.umask")}getBuiltinModule(){}getActiveResourcesInfo(){throw he("process.getActiveResourcesInfo")}exit(){throw he("process.exit")}reallyExit(){throw he("process.reallyExit")}kill(){throw he("process.kill")}abort(){throw he("process.abort")}dlopen(){throw he("process.dlopen")}setSourceMapsEnabled(){throw he("process.setSourceMapsEnabled")}loadEnvFile(){throw he("process.loadEnvFile")}disconnect(){throw he("process.disconnect")}cpuUsage(){throw he("process.cpuUsage")}setUncaughtExceptionCaptureCallback(){throw he("process.setUncaughtExceptionCaptureCallback")}hasUncaughtExceptionCaptureCallback(){throw he("process.hasUncaughtExceptionCaptureCallback")}initgroups(){throw he("process.initgroups")}openStdin(){throw he("process.openStdin")}assert(){throw he("process.assert")}binding(){throw he("process.binding")}permission={has:we("process.permission.has")};report={directory:"",filename:"",signal:"SIGUSR2",compact:!1,reportOnFatalError:!1,reportOnSignal:!1,reportOnUncaughtException:!1,getReport:we("process.report.getReport"),writeReport:we("process.report.writeReport")};finalization={register:we("process.finalization.register"),unregister:we("process.finalization.unregister"),registerBeforeExit:we("process.finalization.registerBeforeExit")};memoryUsage=Object.assign(()=>({arrayBuffers:0,rss:0,external:0,heapTotal:0,heapUsed:0}),{rss:i(()=>0,"rss")});mainModule=void 0;domain=void 0;send=void 0;exitCode=void 0;channel=void 0;getegid=void 0;geteuid=void 0;getgid=void 0;getgroups=void 0;getuid=void 0;setegid=void 0;seteuid=void 0;setgid=void 0;setgroups=void 0;setuid=void 0;_events=void 0;_eventsCount=void 0;_exiting=void 0;_maxListeners=void 0;_debugEnd=void 0;_debugProcess=void 0;_fatalException=void 0;_getActiveHandles=void 0;_getActiveRequests=void 0;_kill=void 0;_preload_modules=void 0;_rawDebug=void 0;_startProfilerIdleNotifier=void 0;_stopProfilerIdleNotifier=void 0;_tickCallback=void 0;_disconnect=void 0;_handleQueue=void 0;_pendingMessage=void 0;_channel=void 0;_send=void 0;_linkedBinding=void 0}});var yo,Eo,Qr,To,ei,ec,tc,rc,nc,ic,sc,oc,ac,uc,lc,cc,fc,dc,hc,mc,pc,gc,yc,Ec,Tc,Sc,_c,bc,wc,Cc,Nc,Ac,vc,Oc,xc,Rc,Ic,Pc,Bc,Dc,Lc,Mc,Uc,$c,qc,jc,Fc,Hc,Qc,kc,zc,Vc,Kc,Yc,Jc,Gc,Wc,Xc,Zc,ef,tf,rf,nf,sf,of,af,uf,lf,cf,ff,df,hf,mf,pf,gf,yf,Ef,Tf,Sf,_f,bf,wf,Cf,Nf,Af,vf,jg,Of,xf,Rf,If,Pf,Bf,Df,Lf,Mf,Uf,$f,qf,jf,Ff,Hf,Qf,kf,zf,Vf,Kf,Yf,Jf,Fg,Gf,Wf,Xf,Zf,So,_o=Z(()=>{d();f();c();lo();go();yo=globalThis.process,Eo=yo.getBuiltinModule,Qr=Eo("node:process"),To=globalThis.Cloudflare.compatibilityFlags.enable_nodejs_process_v2,ei=new Hr({env:yo.env,hrtime:To?Qr.hrtime:uo,nextTick:Qr.nextTick}),{exit:ec,features:tc,platform:rc}=Qr,{env:nc,hrtime:ic,nextTick:sc}=ei,{_channel:oc,_disconnect:ac,_events:uc,_eventsCount:lc,_handleQueue:cc,_maxListeners:fc,_pendingMessage:dc,_send:hc,assert:mc,disconnect:pc,mainModule:gc}=ei,{_debugEnd:yc,_debugProcess:Ec,_exiting:Tc,_fatalException:Sc,_getActiveHandles:_c,_getActiveRequests:bc,_kill:wc,_linkedBinding:Cc,_preload_modules:Nc,_rawDebug:Ac,_startProfilerIdleNotifier:vc,_stopProfilerIdleNotifier:Oc,_tickCallback:xc,abort:Rc,addListener:Ic,allowedNodeEnvironmentFlags:Pc,arch:Bc,argv:Dc,argv0:Lc,availableMemory:Mc,binding:Uc,channel:$c,chdir:qc,config:jc,connected:Fc,constrainedMemory:Hc,cpuUsage:Qc,cwd:kc,debugPort:zc,dlopen:Vc,domain:Kc,emit:Yc,emitWarning:Jc,eventNames:Gc,execArgv:Wc,execPath:Xc,exitCode:Zc,finalization:ef,getActiveResourcesInfo:tf,getegid:rf,geteuid:nf,getgid:sf,getgroups:of,getMaxListeners:af,getuid:uf,hasUncaughtExceptionCaptureCallback:lf,initgroups:cf,kill:ff,listenerCount:df,listeners:hf,loadEnvFile:mf,memoryUsage:pf,moduleLoadList:gf,off:yf,on:Ef,once:Tf,openStdin:Sf,permission:_f,pid:bf,ppid:wf,prependListener:Cf,prependOnceListener:Nf,rawListeners:Af,reallyExit:vf,ref:jg,release:Of,removeAllListeners:xf,removeListener:Rf,report:If,resourceUsage:Pf,send:Bf,setegid:Df,seteuid:Lf,setgid:Mf,setgroups:Uf,setMaxListeners:$f,setSourceMapsEnabled:qf,setuid:jf,setUncaughtExceptionCaptureCallback:Ff,sourceMapsEnabled:Hf,stderr:Qf,stdin:kf,stdout:zf,throwDeprecation:Vf,title:Kf,traceDeprecation:Yf,umask:Jf,unref:Fg,uptime:Gf,version:Wf,versions:Xf}=To?Qr:ei,Zf={abort:Rc,addListener:Ic,allowedNodeEnvironmentFlags:Pc,hasUncaughtExceptionCaptureCallback:lf,setUncaughtExceptionCaptureCallback:Ff,loadEnvFile:mf,sourceMapsEnabled:Hf,arch:Bc,argv:Dc,argv0:Lc,chdir:qc,config:jc,connected:Fc,constrainedMemory:Hc,availableMemory:Mc,cpuUsage:Qc,cwd:kc,debugPort:zc,dlopen:Vc,disconnect:pc,emit:Yc,emitWarning:Jc,env:nc,eventNames:Gc,execArgv:Wc,execPath:Xc,exit:ec,finalization:ef,features:tc,getBuiltinModule:Eo,getActiveResourcesInfo:tf,getMaxListeners:af,hrtime:ic,kill:ff,listeners:hf,listenerCount:df,memoryUsage:pf,nextTick:sc,on:Ef,off:yf,once:Tf,pid:bf,platform:rc,ppid:wf,prependListener:Cf,prependOnceListener:Nf,rawListeners:Af,release:Of,removeAllListeners:xf,removeListener:Rf,report:If,resourceUsage:Pf,setMaxListeners:$f,setSourceMapsEnabled:qf,stderr:Qf,stdin:kf,stdout:zf,title:Kf,throwDeprecation:Vf,traceDeprecation:Yf,umask:Jf,uptime:Gf,version:Wf,versions:Xf,domain:Kc,initgroups:cf,moduleLoadList:gf,reallyExit:vf,openStdin:Sf,assert:mc,binding:Uc,send:Bf,exitCode:Zc,channel:$c,getegid:rf,geteuid:nf,getgid:sf,getgroups:of,getuid:uf,setegid:Df,seteuid:Lf,setgid:Mf,setgroups:Uf,setuid:jf,permission:_f,mainModule:gc,_events:uc,_eventsCount:lc,_exiting:Tc,_maxListeners:fc,_debugEnd:yc,_debugProcess:Ec,_fatalException:Sc,_getActiveHandles:_c,_getActiveRequests:bc,_kill:wc,_preload_modules:Nc,_rawDebug:Ac,_startProfilerIdleNotifier:vc,_stopProfilerIdleNotifier:Oc,_tickCallback:xc,_disconnect:ac,_handleQueue:cc,_pendingMessage:dc,_channel:oc,_send:hc,_linkedBinding:Cc},So=Zf});var d=Z(()=>{_o();globalThis.process=So});function ur(){if(!kr&&(kr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!kr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return kr(ed)}var kr,ed,ti=Z(()=>{d();f();c();ed=new Uint8Array(16);i(ur,"rng")});var bo,wo=Z(()=>{d();f();c();bo=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i});function td(t){return typeof t=="string"&&bo.test(t)}var mt,lr=Z(()=>{d();f();c();wo();i(td,"validate");mt=td});function rd(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(Pe[t[e+0]]+Pe[t[e+1]]+Pe[t[e+2]]+Pe[t[e+3]]+"-"+Pe[t[e+4]]+Pe[t[e+5]]+"-"+Pe[t[e+6]]+Pe[t[e+7]]+"-"+Pe[t[e+8]]+Pe[t[e+9]]+"-"+Pe[t[e+10]]+Pe[t[e+11]]+Pe[t[e+12]]+Pe[t[e+13]]+Pe[t[e+14]]+Pe[t[e+15]]).toLowerCase();if(!mt(r))throw TypeError("Stringified UUID is invalid");return r}var Pe,zr,pt,cr=Z(()=>{d();f();c();lr();Pe=[];for(zr=0;zr<256;++zr)Pe.push((zr+256).toString(16).substr(1));i(rd,"stringify");pt=rd});function nd(t,e,r){var n=e&&r||0,s=e||new Array(16);t=t||{};var o=t.node||Co,a=t.clockseq!==void 0?t.clockseq:ri;if(o==null||a==null){var u=t.random||(t.rng||ur)();o==null&&(o=Co=[u[0]|1,u[1],u[2],u[3],u[4],u[5]]),a==null&&(a=ri=(u[6]<<8|u[7])&16383)}var m=t.msecs!==void 0?t.msecs:Date.now(),E=t.nsecs!==void 0?t.nsecs:ii+1,g=m-ni+(E-ii)/1e4;if(g<0&&t.clockseq===void 0&&(a=a+1&16383),(g<0||m>ni)&&t.nsecs===void 0&&(E=0),E>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");ni=m,ii=E,ri=a,m+=122192928e5;var x=((m&268435455)*1e4+E)%4294967296;s[n++]=x>>>24&255,s[n++]=x>>>16&255,s[n++]=x>>>8&255,s[n++]=x&255;var P=m/4294967296*1e4&268435455;s[n++]=P>>>8&255,s[n++]=P&255,s[n++]=P>>>24&15|16,s[n++]=P>>>16&255,s[n++]=a>>>8|128,s[n++]=a&255;for(var Y=0;Y<6;++Y)s[n+Y]=o[Y];return e||pt(s)}var Co,ri,ni,ii,No,Ao=Z(()=>{d();f();c();ti();cr();ni=0,ii=0;i(nd,"v1");No=nd});function id(t){if(!mt(t))throw TypeError("Invalid UUID");var e,r=new Uint8Array(16);return r[0]=(e=parseInt(t.slice(0,8),16))>>>24,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=e&255,r[4]=(e=parseInt(t.slice(9,13),16))>>>8,r[5]=e&255,r[6]=(e=parseInt(t.slice(14,18),16))>>>8,r[7]=e&255,r[8]=(e=parseInt(t.slice(19,23),16))>>>8,r[9]=e&255,r[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,r[11]=e/4294967296&255,r[12]=e>>>24&255,r[13]=e>>>16&255,r[14]=e>>>8&255,r[15]=e&255,r}var Vr,si=Z(()=>{d();f();c();lr();i(id,"parse");Vr=id});function sd(t){t=unescape(encodeURIComponent(t));for(var e=[],r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e}function fr(t,e,r){function n(s,o,a,u){if(typeof s=="string"&&(s=sd(s)),typeof o=="string"&&(o=Vr(o)),o.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var m=new Uint8Array(16+s.length);if(m.set(o),m.set(s,o.length),m=r(m),m[6]=m[6]&15|e,m[8]=m[8]&63|128,a){u=u||0;for(var E=0;E<16;++E)a[u+E]=m[E];return a}return pt(m)}i(n,"generateUUID");try{n.name=t}catch{}return n.DNS=od,n.URL=ad,n}var od,ad,oi=Z(()=>{d();f();c();cr();si();i(sd,"stringToBytes");od="6ba7b810-9dad-11d1-80b4-00c04fd430c8",ad="6ba7b811-9dad-11d1-80b4-00c04fd430c8";i(fr,"default")});function ud(t){if(typeof t=="string"){var e=unescape(encodeURIComponent(t));t=new Uint8Array(e.length);for(var r=0;r<e.length;++r)t[r]=e.charCodeAt(r)}return ld(cd(fd(t),t.length*8))}function ld(t){for(var e=[],r=t.length*32,n="0123456789abcdef",s=0;s<r;s+=8){var o=t[s>>5]>>>s%32&255,a=parseInt(n.charAt(o>>>4&15)+n.charAt(o&15),16);e.push(a)}return e}function vo(t){return(t+64>>>9<<4)+14+1}function cd(t,e){t[e>>5]|=128<<e%32,t[vo(e)-1]=e;for(var r=1732584193,n=-271733879,s=-1732584194,o=271733878,a=0;a<t.length;a+=16){var u=r,m=n,E=s,g=o;r=Le(r,n,s,o,t[a],7,-680876936),o=Le(o,r,n,s,t[a+1],12,-389564586),s=Le(s,o,r,n,t[a+2],17,606105819),n=Le(n,s,o,r,t[a+3],22,-1044525330),r=Le(r,n,s,o,t[a+4],7,-176418897),o=Le(o,r,n,s,t[a+5],12,1200080426),s=Le(s,o,r,n,t[a+6],17,-1473231341),n=Le(n,s,o,r,t[a+7],22,-45705983),r=Le(r,n,s,o,t[a+8],7,1770035416),o=Le(o,r,n,s,t[a+9],12,-1958414417),s=Le(s,o,r,n,t[a+10],17,-42063),n=Le(n,s,o,r,t[a+11],22,-1990404162),r=Le(r,n,s,o,t[a+12],7,1804603682),o=Le(o,r,n,s,t[a+13],12,-40341101),s=Le(s,o,r,n,t[a+14],17,-1502002290),n=Le(n,s,o,r,t[a+15],22,1236535329),r=Me(r,n,s,o,t[a+1],5,-165796510),o=Me(o,r,n,s,t[a+6],9,-1069501632),s=Me(s,o,r,n,t[a+11],14,643717713),n=Me(n,s,o,r,t[a],20,-373897302),r=Me(r,n,s,o,t[a+5],5,-701558691),o=Me(o,r,n,s,t[a+10],9,38016083),s=Me(s,o,r,n,t[a+15],14,-660478335),n=Me(n,s,o,r,t[a+4],20,-405537848),r=Me(r,n,s,o,t[a+9],5,568446438),o=Me(o,r,n,s,t[a+14],9,-1019803690),s=Me(s,o,r,n,t[a+3],14,-187363961),n=Me(n,s,o,r,t[a+8],20,1163531501),r=Me(r,n,s,o,t[a+13],5,-1444681467),o=Me(o,r,n,s,t[a+2],9,-51403784),s=Me(s,o,r,n,t[a+7],14,1735328473),n=Me(n,s,o,r,t[a+12],20,-1926607734),r=Ue(r,n,s,o,t[a+5],4,-378558),o=Ue(o,r,n,s,t[a+8],11,-2022574463),s=Ue(s,o,r,n,t[a+11],16,1839030562),n=Ue(n,s,o,r,t[a+14],23,-35309556),r=Ue(r,n,s,o,t[a+1],4,-1530992060),o=Ue(o,r,n,s,t[a+4],11,1272893353),s=Ue(s,o,r,n,t[a+7],16,-155497632),n=Ue(n,s,o,r,t[a+10],23,-1094730640),r=Ue(r,n,s,o,t[a+13],4,681279174),o=Ue(o,r,n,s,t[a],11,-358537222),s=Ue(s,o,r,n,t[a+3],16,-722521979),n=Ue(n,s,o,r,t[a+6],23,76029189),r=Ue(r,n,s,o,t[a+9],4,-640364487),o=Ue(o,r,n,s,t[a+12],11,-421815835),s=Ue(s,o,r,n,t[a+15],16,530742520),n=Ue(n,s,o,r,t[a+2],23,-995338651),r=$e(r,n,s,o,t[a],6,-198630844),o=$e(o,r,n,s,t[a+7],10,1126891415),s=$e(s,o,r,n,t[a+14],15,-1416354905),n=$e(n,s,o,r,t[a+5],21,-57434055),r=$e(r,n,s,o,t[a+12],6,1700485571),o=$e(o,r,n,s,t[a+3],10,-1894986606),s=$e(s,o,r,n,t[a+10],15,-1051523),n=$e(n,s,o,r,t[a+1],21,-2054922799),r=$e(r,n,s,o,t[a+8],6,1873313359),o=$e(o,r,n,s,t[a+15],10,-30611744),s=$e(s,o,r,n,t[a+6],15,-1560198380),n=$e(n,s,o,r,t[a+13],21,1309151649),r=$e(r,n,s,o,t[a+4],6,-145523070),o=$e(o,r,n,s,t[a+11],10,-1120210379),s=$e(s,o,r,n,t[a+2],15,718787259),n=$e(n,s,o,r,t[a+9],21,-343485551),r=gt(r,u),n=gt(n,m),s=gt(s,E),o=gt(o,g)}return[r,n,s,o]}function fd(t){if(t.length===0)return[];for(var e=t.length*8,r=new Uint32Array(vo(e)),n=0;n<e;n+=8)r[n>>5]|=(t[n/8]&255)<<n%32;return r}function gt(t,e){var r=(t&65535)+(e&65535),n=(t>>16)+(e>>16)+(r>>16);return n<<16|r&65535}function dd(t,e){return t<<e|t>>>32-e}function Kr(t,e,r,n,s,o){return gt(dd(gt(gt(e,t),gt(n,o)),s),r)}function Le(t,e,r,n,s,o,a){return Kr(e&r|~e&n,t,e,s,o,a)}function Me(t,e,r,n,s,o,a){return Kr(e&n|r&~n,t,e,s,o,a)}function Ue(t,e,r,n,s,o,a){return Kr(e^r^n,t,e,s,o,a)}function $e(t,e,r,n,s,o,a){return Kr(r^(e|~n),t,e,s,o,a)}var Oo,xo=Z(()=>{d();f();c();i(ud,"md5");i(ld,"md5ToHexEncodedArray");i(vo,"getOutputLength");i(cd,"wordsToMd5");i(fd,"bytesToWords");i(gt,"safeAdd");i(dd,"bitRotateLeft");i(Kr,"md5cmn");i(Le,"md5ff");i(Me,"md5gg");i(Ue,"md5hh");i($e,"md5ii");Oo=ud});var hd,Ro,Io=Z(()=>{d();f();c();oi();xo();hd=fr("v3",48,Oo),Ro=hd});function md(t,e,r){t=t||{};var n=t.random||(t.rng||ur)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(var s=0;s<16;++s)e[r+s]=n[s];return e}return pt(n)}var Po,Bo=Z(()=>{d();f();c();ti();cr();i(md,"v4");Po=md});function pd(t,e,r,n){switch(t){case 0:return e&r^~e&n;case 1:return e^r^n;case 2:return e&r^e&n^r&n;case 3:return e^r^n}}function ai(t,e){return t<<e|t>>>32-e}function gd(t){var e=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof t=="string"){var n=unescape(encodeURIComponent(t));t=[];for(var s=0;s<n.length;++s)t.push(n.charCodeAt(s))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var o=t.length/4+2,a=Math.ceil(o/16),u=new Array(a),m=0;m<a;++m){for(var E=new Uint32Array(16),g=0;g<16;++g)E[g]=t[m*64+g*4]<<24|t[m*64+g*4+1]<<16|t[m*64+g*4+2]<<8|t[m*64+g*4+3];u[m]=E}u[a-1][14]=(t.length-1)*8/Math.pow(2,32),u[a-1][14]=Math.floor(u[a-1][14]),u[a-1][15]=(t.length-1)*8&4294967295;for(var x=0;x<a;++x){for(var P=new Uint32Array(80),Y=0;Y<16;++Y)P[Y]=u[x][Y];for(var G=16;G<80;++G)P[G]=ai(P[G-3]^P[G-8]^P[G-14]^P[G-16],1);for(var B=r[0],q=r[1],D=r[2],ne=r[3],ee=r[4],W=0;W<80;++W){var Q=Math.floor(W/20),j=ai(B,5)+pd(Q,q,D,ne)+ee+e[Q]+P[W]>>>0;ee=ne,ne=D,D=ai(q,30)>>>0,q=B,B=j}r[0]=r[0]+B>>>0,r[1]=r[1]+q>>>0,r[2]=r[2]+D>>>0,r[3]=r[3]+ne>>>0,r[4]=r[4]+ee>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,r[0]&255,r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,r[1]&255,r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,r[2]&255,r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,r[3]&255,r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,r[4]&255]}var Do,Lo=Z(()=>{d();f();c();i(pd,"f");i(ai,"ROTL");i(gd,"sha1");Do=gd});var yd,Mo,Uo=Z(()=>{d();f();c();oi();Lo();yd=fr("v5",80,Do),Mo=yd});var $o,qo=Z(()=>{d();f();c();$o="00000000-0000-0000-0000-000000000000"});function Ed(t){if(!mt(t))throw TypeError("Invalid UUID");return parseInt(t.substr(14,1),16)}var jo,Fo=Z(()=>{d();f();c();lr();i(Ed,"version");jo=Ed});var Ho={};Qs(Ho,{NIL:()=>$o,parse:()=>Vr,stringify:()=>pt,v1:()=>No,v3:()=>Ro,v4:()=>Po,v5:()=>Mo,validate:()=>mt,version:()=>jo});var Qo=Z(()=>{d();f();c();Ao();Io();Bo();Uo();qo();Fo();lr();cr();si()});var Pt=se(F=>{"use strict";d();f();c();Object.defineProperty(F,"__esModule",{value:!0});F.isValidType=F.asData=F.isJsonContentType=F.clone=F.asBase64=F.base64AsBinary=F.asBuffer=F.isBuffer=F.isBase64=F.equalsOrThrow=F.isStringOrObjectOrThrow=F.isDefinedOrThrow=F.isStringOrThrow=F.isBinary=F.isDate=F.isInteger=F.isBoolean=F.isDefined=F.isObject=F.isString=F.ValidationError=void 0;var ko=(function(){try{return globalThis}catch{try{return self}catch{return global}}})(),ui=class extends TypeError{static{i(this,"ValidationError")}constructor(e,r){let n=r instanceof Array?r?.reduce((s,o)=>s.concat(`
  ${o instanceof Object?JSON.stringify(o):o}`),e):e;super(n),this.errors=r||[]}};F.ValidationError=ui;var Td=i(t=>typeof t=="string","isString");F.isString=Td;var Sd=i(t=>typeof t=="object","isObject");F.isObject=Sd;var _d=i(t=>t!==null&&typeof t<"u","isDefined");F.isDefined=_d;var bd=i(t=>typeof t=="boolean","isBoolean");F.isBoolean=bd;var wd=i(t=>Number.isInteger(t),"isInteger");F.isInteger=wd;var Cd=i(t=>t instanceof Date,"isDate");F.isDate=Cd;var Nd=i(t=>ArrayBuffer.isView(t),"isBinary");F.isBinary=Nd;var Ad=i((t,e)=>(0,F.isString)(t)?!0:(()=>{throw e})(),"isStringOrThrow");F.isStringOrThrow=Ad;var vd=i((t,e)=>(0,F.isDefined)(t)?!0:(()=>{throw e})(),"isDefinedOrThrow");F.isDefinedOrThrow=vd;var Od=i((t,e)=>(0,F.isString)(t)||(0,F.isObject)(t)?!0:(()=>{throw e})(),"isStringOrObjectOrThrow");F.isStringOrObjectOrThrow=Od;var xd=i((t,e,r)=>t===e?!0:(()=>{throw r})(),"equalsOrThrow");F.equalsOrThrow=xd;var Rd=i(t=>Buffer.from(t,"base64").toString("base64")===t,"isBase64");F.isBase64=Rd;var Id=i(t=>t instanceof Buffer,"isBuffer");F.isBuffer=Id;var Pd=i(t=>(0,F.isBinary)(t)?Buffer.from(t):(0,F.isBuffer)(t)?t:(()=>{throw new TypeError("is not buffer or a valid binary")})(),"asBuffer");F.asBuffer=Pd;var Bd=i(t=>Uint8Array.from(i(r=>ko.atob?ko.atob(r):Buffer.from(r,"base64").toString("binary"),"toBinaryString")(t),r=>r.charCodeAt(0)),"base64AsBinary");F.base64AsBinary=Bd;var Dd=i(t=>(0,F.asBuffer)(t).toString("base64"),"asBase64");F.asBase64=Dd;var Ld=i(t=>JSON.parse(JSON.stringify(t)),"clone");F.clone=Ld;var Md=i(t=>t&&t.match(/(json)/i),"isJsonContentType");F.isJsonContentType=Md;var Ud=i((t,e)=>{let r=(0,F.isString)(t)&&!(0,F.isBase64)(t)&&(0,F.isJsonContentType)(e)?JSON.parse(t):t;return(0,F.isBinary)(r)?(0,F.asBase64)(r):r},"asData");F.asData=Ud;var $d=i(t=>(0,F.isBoolean)(t)||(0,F.isInteger)(t)||(0,F.isString)(t)||(0,F.isDate)(t)||(0,F.isBinary)(t)||(0,F.isObject)(t),"isValidType");F.isValidType=$d});var Vo=se(li=>{"use strict";d();f();c();Object.defineProperty(li,"__esModule",{value:!0});function zo(t){let e=t.length,r=0,n=0,s;for(;n<e;)r++,s=t.charCodeAt(n++),s>=55296&&s<=56319&&n<e&&(s=t.charCodeAt(n),(s&64512)===56320&&n++);return r}i(zo,"ucs2length");li.default=zo;zo.code='require("ajv/dist/runtime/ucs2length").default'});var mi=se(ot=>{"use strict";d();f();c();Object.defineProperty(ot,"__esModule",{value:!0});ot.formatNames=ot.fastFormats=ot.fullFormats=void 0;function Ft(t,e){return{validate:t,compare:e}}i(Ft,"fmtDef");ot.fullFormats={date:Ft(Jo,di),time:Ft(Go,hi),"date-time":Ft(Hd,Wo),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:zd,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:Xd,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:Vd,int32:{type:"number",validate:Jd},int64:{type:"number",validate:Gd},float:{type:"number",validate:Yo},double:{type:"number",validate:Yo},password:!0,binary:!0};ot.fastFormats={...ot.fullFormats,date:Ft(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,di),time:Ft(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,hi),"date-time":Ft(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,Wo),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i};ot.formatNames=Object.keys(ot.fullFormats);function qd(t){return t%4===0&&(t%100!==0||t%400===0)}i(qd,"isLeapYear");var jd=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,Fd=[0,31,28,31,30,31,30,31,31,30,31,30,31];function Jo(t){let e=jd.exec(t);if(!e)return!1;let r=+e[1],n=+e[2],s=+e[3];return n>=1&&n<=12&&s>=1&&s<=(n===2&&qd(r)?29:Fd[n])}i(Jo,"date");function di(t,e){if(t&&e)return t>e?1:t<e?-1:0}i(di,"compareDate");var ci=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function Go(t,e){let r=ci.exec(t);if(!r)return!1;let n=+r[1],s=+r[2],o=+r[3],a=r[5];return(n<=23&&s<=59&&o<=59||n===23&&s===59&&o===60)&&(!e||a!=="")}i(Go,"time");function hi(t,e){if(!(t&&e))return;let r=ci.exec(t),n=ci.exec(e);if(r&&n)return t=r[1]+r[2]+r[3]+(r[4]||""),e=n[1]+n[2]+n[3]+(n[4]||""),t>e?1:t<e?-1:0}i(hi,"compareTime");var fi=/t|\s/i;function Hd(t){let e=t.split(fi);return e.length===2&&Jo(e[0])&&Go(e[1],!0)}i(Hd,"date_time");function Wo(t,e){if(!(t&&e))return;let[r,n]=t.split(fi),[s,o]=e.split(fi),a=di(r,s);if(a!==void 0)return a||hi(n,o)}i(Wo,"compareDateTime");var Qd=/\/|:/,kd=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function zd(t){return Qd.test(t)&&kd.test(t)}i(zd,"uri");var Ko=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function Vd(t){return Ko.lastIndex=0,Ko.test(t)}i(Vd,"byte");var Kd=-(2**31),Yd=2**31-1;function Jd(t){return Number.isInteger(t)&&t<=Yd&&t>=Kd}i(Jd,"validateInt32");function Gd(t){return Number.isInteger(t)}i(Gd,"validateInt64");function Yo(){return!0}i(Yo,"validateNumber");var Wd=/[^\\]\\Z/;function Xd(t){if(Wd.test(t))return!1;try{return new RegExp(t),!0}catch{return!1}}i(Xd,"regex")});var Xo=se((VE,pi)=>{"use strict";d();f();c();pi.exports=me;pi.exports.default=me;var Zd={type:["string","null"],minLength:1},eh={type:["string","null"],format:"uri",minLength:1},th={type:["string","null"],minLength:1},rh={type:["string","null"],format:"date-time",minLength:1},nh={type:["object","string","number","array","boolean","null"]},ih={type:["string","null"],contentEncoding:"base64"},yt=Vo().default,sh=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,oh=mi().fullFormats.uri,ah=mi().fullFormats["date-time"];function me(t,{instancePath:e="",parentData:r,parentDataProperty:n,rootData:s=t}={}){let o=null,a=0;if(a===0)if(t&&typeof t=="object"&&!Array.isArray(t)){let m;if(t.id===void 0&&(m="id")||t.source===void 0&&(m="source")||t.specversion===void 0&&(m="specversion")||t.type===void 0&&(m="type"))return me.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:m},message:"must have required property '"+m+"'"}],!1;if(t.id!==void 0){let E=t.id,g=a;if(a===a)if(typeof E=="string"){if(yt(E)<1)return me.errors=[{instancePath:e+"/id",schemaPath:"#/definitions/iddef/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"}],!1}else return me.errors=[{instancePath:e+"/id",schemaPath:"#/definitions/iddef/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var u=g===a}else var u=!0;if(u){if(t.source!==void 0){let E=t.source,g=a,x=a;if(a===x&&a===x)if(typeof E=="string"){if(yt(E)<1)return me.errors=[{instancePath:e+"/source",schemaPath:"#/definitions/sourcedef/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"}],!1;if(!sh.test(E))return me.errors=[{instancePath:e+"/source",schemaPath:"#/definitions/sourcedef/format",keyword:"format",params:{format:"uri-reference"},message:'must match format "uri-reference"'}],!1}else return me.errors=[{instancePath:e+"/source",schemaPath:"#/definitions/sourcedef/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var u=g===a}else var u=!0;if(u){if(t.specversion!==void 0){let E=t.specversion,g=a;if(a===a)if(typeof E=="string"){if(yt(E)<1)return me.errors=[{instancePath:e+"/specversion",schemaPath:"#/definitions/specversiondef/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"}],!1}else return me.errors=[{instancePath:e+"/specversion",schemaPath:"#/definitions/specversiondef/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var u=g===a}else var u=!0;if(u){if(t.type!==void 0){let E=t.type,g=a;if(a===a)if(typeof E=="string"){if(yt(E)<1)return me.errors=[{instancePath:e+"/type",schemaPath:"#/definitions/typedef/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"}],!1}else return me.errors=[{instancePath:e+"/type",schemaPath:"#/definitions/typedef/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var u=g===a}else var u=!0;if(u){if(t.datacontenttype!==void 0){let E=t.datacontenttype,g=a,x=a;if(typeof E!="string"&&E!==null)return me.errors=[{instancePath:e+"/datacontenttype",schemaPath:"#/definitions/datacontenttypedef/type",keyword:"type",params:{type:Zd.type},message:"must be string,null"}],!1;if(a===x&&typeof E=="string"&&yt(E)<1)return me.errors=[{instancePath:e+"/datacontenttype",schemaPath:"#/definitions/datacontenttypedef/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"}],!1;var u=g===a}else var u=!0;if(u){if(t.dataschema!==void 0){let E=t.dataschema,g=a,x=a;if(typeof E!="string"&&E!==null)return me.errors=[{instancePath:e+"/dataschema",schemaPath:"#/definitions/dataschemadef/type",keyword:"type",params:{type:eh.type},message:"must be string,null"}],!1;if(a===x&&a===x&&typeof E=="string"){if(yt(E)<1)return me.errors=[{instancePath:e+"/dataschema",schemaPath:"#/definitions/dataschemadef/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"}],!1;if(!oh(E))return me.errors=[{instancePath:e+"/dataschema",schemaPath:"#/definitions/dataschemadef/format",keyword:"format",params:{format:"uri"},message:'must match format "uri"'}],!1}var u=g===a}else var u=!0;if(u){if(t.subject!==void 0){let E=t.subject,g=a,x=a;if(typeof E!="string"&&E!==null)return me.errors=[{instancePath:e+"/subject",schemaPath:"#/definitions/subjectdef/type",keyword:"type",params:{type:th.type},message:"must be string,null"}],!1;if(a===x&&typeof E=="string"&&yt(E)<1)return me.errors=[{instancePath:e+"/subject",schemaPath:"#/definitions/subjectdef/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"}],!1;var u=g===a}else var u=!0;if(u){if(t.time!==void 0){let E=t.time,g=a,x=a;if(typeof E!="string"&&E!==null)return me.errors=[{instancePath:e+"/time",schemaPath:"#/definitions/timedef/type",keyword:"type",params:{type:rh.type},message:"must be string,null"}],!1;if(a===x&&a===x&&typeof E=="string"){if(yt(E)<1)return me.errors=[{instancePath:e+"/time",schemaPath:"#/definitions/timedef/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"}],!1;if(!ah.validate(E))return me.errors=[{instancePath:e+"/time",schemaPath:"#/definitions/timedef/format",keyword:"format",params:{format:"date-time"},message:'must match format "date-time"'}],!1}var u=g===a}else var u=!0;if(u){if(t.data!==void 0){let E=t.data,g=a;if(typeof E!="object"&&typeof E!="string"&&!(typeof E=="number"&&isFinite(E))&&typeof E!="boolean")return me.errors=[{instancePath:e+"/data",schemaPath:"#/definitions/datadef/type",keyword:"type",params:{type:nh.type},message:"must be object,string,number,array,boolean,null"}],!1;var u=g===a}else var u=!0;if(u)if(t.data_base64!==void 0){let E=t.data_base64,g=a;if(typeof E!="string"&&E!==null)return me.errors=[{instancePath:e+"/data_base64",schemaPath:"#/definitions/data_base64def/type",keyword:"type",params:{type:ih.type},message:"must be string,null"}],!1;var u=g===a}else var u=!0}}}}}}}}}else return me.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return me.errors=o,a===0}i(me,"validate20")});var ta=se(Ht=>{"use strict";d();f();c();var uh=Ht&&Ht.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ht,"__esModule",{value:!0});Ht.validateCloudEvent=void 0;var Zo=Pt(),lh=Yr(),ea=uh(Xo());function ch(t){if(t.specversion===lh.V1){if(!(0,ea.default)(t))throw new Zo.ValidationError("invalid payload",ea.default.errors)}else return!1;let e=/^[a-z0-9]+$/;for(let r in t)if(e.test(r)===!1&&r!=="data_base64")throw new Zo.ValidationError(`invalid attribute name: "${r}"`);return!0}i(ch,"validateCloudEvent");Ht.validateCloudEvent=ch});var Yr=se(nt=>{"use strict";d();f();c();Object.defineProperty(nt,"__esModule",{value:!0});nt.CloudEvent=nt.V03=nt.V1=void 0;var fh=(Qo(),Gl(Ho)),dh=Bt(),hh=ta(),Et=Pt();nt.V1="1.0";nt.V03="0.3";var gi=class t{static{i(this,"CloudEvent")}constructor(e,r=!0){let n={...e};if(this.id=n.id||(0,fh.v4)(),delete n.id,this.time=n.time||new Date().toISOString(),delete n.time,this.type=n.type,delete n.type,this.source=n.source,delete n.source,this.specversion=n.specversion||nt.V1,delete n.specversion,this.datacontenttype=n.datacontenttype,delete n.datacontenttype,this.subject=n.subject,delete n.subject,this.datacontentencoding=n.datacontentencoding,delete n.datacontentencoding,this.dataschema=n.dataschema,delete n.dataschema,this.data_base64=n.data_base64,this.data_base64&&(this.data=(0,Et.base64AsBinary)(this.data_base64)),delete n.data_base64,this.schemaurl=n.schemaurl,delete n.schemaurl,(0,Et.isBinary)(n.data)&&(this.data_base64=(0,Et.asBase64)(n.data)),this.data=typeof n.data<"u"?n.data:this.data,delete n.data,this.specversion===nt.V1&&this.schemaurl)throw new TypeError("cannot set schemaurl on version 1.0 event");if(this.specversion===nt.V03&&this.dataschema)throw new TypeError("cannot set dataschema on version 0.3 event");for(let[s,o]of Object.entries(n)){if(!s.match(/^[a-z0-9]+$/)&&r)throw new Et.ValidationError(`invalid extension name: ${s}
CloudEvents attribute names MUST consist of lower-case letters ('a' to 'z')
or digits ('0' to '9') from the ASCII character set. Attribute names SHOULD
be descriptive and terse and SHOULD NOT exceed 20 characters in length.`);if(!(0,Et.isValidType)(o)&&r)throw new Et.ValidationError(`invalid extension value: ${o}
Extension values must conform to the CloudEvent type system.
See: https://github.com/cloudevents/spec/blob/v1.0/spec.md#type-system`);this[s]=o}r&&this.validate(),Object.freeze(this)}toJSON(){let e={...this};return e.time=new Date(this.time).toISOString(),e.data_base64&&e.data&&delete e.data,e}toString(){return JSON.stringify(this)}validate(){try{return(0,hh.validateCloudEvent)(this)}catch(e){throw e instanceof Et.ValidationError?e:new Et.ValidationError("invalid payload",[e])}}async emit(e=!0){return await dh.Emitter.emitEvent(this,e),this}cloneWith(e,r=!0){return t.cloneWith(this,e,r)}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}static cloneWith(e,r,n=!0){return new t(Object.assign({},e,r),n)}};nt.CloudEvent=gi});import mh from"util";var na=se((uT,ra)=>{d();f();c();ra.exports=mh});var yi=se((ia,Jr)=>{d();f();c();(function(t){"use strict";var e,r=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,n=Math.ceil,s=Math.floor,o="[BigNumber Error] ",a=o+"Number primitive has more than 15 significant digits: ",u=1e14,m=14,E=9007199254740991,g=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],x=1e7,P=1e9;function Y(Q){var j,$,K,M=L.prototype={constructor:L,toString:null,valueOf:null},ye=new L(1),ce=20,ue=4,de=-7,Ee=21,Ge=-1e7,Ke=1e7,ut=!1,Ot=1,ht=0,Qn={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},xt="0123456789abcdefghijklmnopqrstuvwxyz",kn=!0;function L(l,h){var p,N,S,b,v,y,_,A,C=this;if(!(C instanceof L))return new L(l,h);if(h==null){if(l&&l._isBigNumber===!0){C.s=l.s,!l.c||l.e>Ke?C.c=C.e=null:l.e<Ge?C.c=[C.e=0]:(C.e=l.e,C.c=l.c.slice());return}if((y=typeof l=="number")&&l*0==0){if(C.s=1/l<0?(l=-l,-1):1,l===~~l){for(b=0,v=l;v>=10;v/=10,b++);b>Ke?C.c=C.e=null:(C.e=b,C.c=[l]);return}A=String(l)}else{if(!r.test(A=String(l)))return K(C,A,y);C.s=A.charCodeAt(0)==45?(A=A.slice(1),-1):1}(b=A.indexOf("."))>-1&&(A=A.replace(".","")),(v=A.search(/e/i))>0?(b<0&&(b=v),b+=+A.slice(v+1),A=A.substring(0,v)):b<0&&(b=A.length)}else{if(D(h,2,xt.length,"Base"),h==10&&kn)return C=new L(l),We(C,ce+C.e+1,ue);if(A=String(l),y=typeof l=="number"){if(l*0!=0)return K(C,A,y,h);if(C.s=1/l<0?(A=A.slice(1),-1):1,L.DEBUG&&A.replace(/^0\.0*|\./,"").length>15)throw Error(a+l)}else C.s=A.charCodeAt(0)===45?(A=A.slice(1),-1):1;for(p=xt.slice(0,h),b=v=0,_=A.length;v<_;v++)if(p.indexOf(N=A.charAt(v))<0){if(N=="."){if(v>b){b=_;continue}}else if(!S&&(A==A.toUpperCase()&&(A=A.toLowerCase())||A==A.toLowerCase()&&(A=A.toUpperCase()))){S=!0,v=-1,b=0;continue}return K(C,String(l),y,h)}y=!1,A=$(A,h,10,C.s),(b=A.indexOf("."))>-1?A=A.replace(".",""):b=A.length}for(v=0;A.charCodeAt(v)===48;v++);for(_=A.length;A.charCodeAt(--_)===48;);if(A=A.slice(v,++_)){if(_-=v,y&&L.DEBUG&&_>15&&(l>E||l!==s(l)))throw Error(a+C.s*l);if((b=b-v-1)>Ke)C.c=C.e=null;else if(b<Ge)C.c=[C.e=0];else{if(C.e=b,C.c=[],v=(b+1)%m,b<0&&(v+=m),v<_){for(v&&C.c.push(+A.slice(0,v)),_-=m;v<_;)C.c.push(+A.slice(v,v+=m));v=m-(A=A.slice(v)).length}else v-=_;for(;v--;A+="0");C.c.push(+A)}}else C.c=[C.e=0]}i(L,"BigNumber"),L.clone=Y,L.ROUND_UP=0,L.ROUND_DOWN=1,L.ROUND_CEIL=2,L.ROUND_FLOOR=3,L.ROUND_HALF_UP=4,L.ROUND_HALF_DOWN=5,L.ROUND_HALF_EVEN=6,L.ROUND_HALF_CEIL=7,L.ROUND_HALF_FLOOR=8,L.EUCLID=9,L.config=L.set=function(l){var h,p;if(l!=null)if(typeof l=="object"){if(l.hasOwnProperty(h="DECIMAL_PLACES")&&(p=l[h],D(p,0,P,h),ce=p),l.hasOwnProperty(h="ROUNDING_MODE")&&(p=l[h],D(p,0,8,h),ue=p),l.hasOwnProperty(h="EXPONENTIAL_AT")&&(p=l[h],p&&p.pop?(D(p[0],-P,0,h),D(p[1],0,P,h),de=p[0],Ee=p[1]):(D(p,-P,P,h),de=-(Ee=p<0?-p:p))),l.hasOwnProperty(h="RANGE"))if(p=l[h],p&&p.pop)D(p[0],-P,-1,h),D(p[1],1,P,h),Ge=p[0],Ke=p[1];else if(D(p,-P,P,h),p)Ge=-(Ke=p<0?-p:p);else throw Error(o+h+" cannot be zero: "+p);if(l.hasOwnProperty(h="CRYPTO"))if(p=l[h],p===!!p)if(p)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))ut=p;else throw ut=!p,Error(o+"crypto unavailable");else ut=p;else throw Error(o+h+" not true or false: "+p);if(l.hasOwnProperty(h="MODULO_MODE")&&(p=l[h],D(p,0,9,h),Ot=p),l.hasOwnProperty(h="POW_PRECISION")&&(p=l[h],D(p,0,P,h),ht=p),l.hasOwnProperty(h="FORMAT"))if(p=l[h],typeof p=="object")Qn=p;else throw Error(o+h+" not an object: "+p);if(l.hasOwnProperty(h="ALPHABET"))if(p=l[h],typeof p=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(p))kn=p.slice(0,10)=="0123456789",xt=p;else throw Error(o+h+" invalid: "+p)}else throw Error(o+"Object expected: "+l);return{DECIMAL_PLACES:ce,ROUNDING_MODE:ue,EXPONENTIAL_AT:[de,Ee],RANGE:[Ge,Ke],CRYPTO:ut,MODULO_MODE:Ot,POW_PRECISION:ht,FORMAT:Qn,ALPHABET:xt}},L.isBigNumber=function(l){if(!l||l._isBigNumber!==!0)return!1;if(!L.DEBUG)return!0;var h,p,N=l.c,S=l.e,b=l.s;e:if({}.toString.call(N)=="[object Array]"){if((b===1||b===-1)&&S>=-P&&S<=P&&S===s(S)){if(N[0]===0){if(S===0&&N.length===1)return!0;break e}if(h=(S+1)%m,h<1&&(h+=m),String(N[0]).length==h){for(h=0;h<N.length;h++)if(p=N[h],p<0||p>=u||p!==s(p))break e;if(p!==0)return!0}}}else if(N===null&&S===null&&(b===null||b===1||b===-1))return!0;throw Error(o+"Invalid BigNumber: "+l)},L.maximum=L.max=function(){return Hs(arguments,-1)},L.minimum=L.min=function(){return Hs(arguments,1)},L.random=(function(){var l=9007199254740992,h=Math.random()*l&2097151?function(){return s(Math.random()*l)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(p){var N,S,b,v,y,_=0,A=[],C=new L(ye);if(p==null?p=ce:D(p,0,P),v=n(p/m),ut)if(crypto.getRandomValues){for(N=crypto.getRandomValues(new Uint32Array(v*=2));_<v;)y=N[_]*131072+(N[_+1]>>>11),y>=9e15?(S=crypto.getRandomValues(new Uint32Array(2)),N[_]=S[0],N[_+1]=S[1]):(A.push(y%1e14),_+=2);_=v/2}else if(crypto.randomBytes){for(N=crypto.randomBytes(v*=7);_<v;)y=(N[_]&31)*281474976710656+N[_+1]*1099511627776+N[_+2]*4294967296+N[_+3]*16777216+(N[_+4]<<16)+(N[_+5]<<8)+N[_+6],y>=9e15?crypto.randomBytes(7).copy(N,_):(A.push(y%1e14),_+=7);_=v/7}else throw ut=!1,Error(o+"crypto unavailable");if(!ut)for(;_<v;)y=h(),y<9e15&&(A[_++]=y%1e14);for(v=A[--_],p%=m,v&&p&&(y=g[m-p],A[_]=s(v/y)*y);A[_]===0;A.pop(),_--);if(_<0)A=[b=0];else{for(b=-1;A[0]===0;A.splice(0,1),b-=m);for(_=1,y=A[0];y>=10;y/=10,_++);_<m&&(b-=m-_)}return C.e=b,C.c=A,C}})(),L.sum=function(){for(var l=1,h=arguments,p=new L(h[0]);l<h.length;)p=p.plus(h[l++]);return p},$=(function(){var l="0123456789";function h(p,N,S,b){for(var v,y=[0],_,A=0,C=p.length;A<C;){for(_=y.length;_--;y[_]*=N);for(y[0]+=b.indexOf(p.charAt(A++)),v=0;v<y.length;v++)y[v]>S-1&&(y[v+1]==null&&(y[v+1]=0),y[v+1]+=y[v]/S|0,y[v]%=S)}return y.reverse()}return i(h,"toBaseOut"),function(p,N,S,b,v){var y,_,A,C,I,k,V,ie,Se=p.indexOf("."),ve=ce,re=ue;for(Se>=0&&(C=ht,ht=0,p=p.replace(".",""),ie=new L(N),k=ie.pow(p.length-Se),ht=C,ie.c=h(W(B(k.c),k.e,"0"),10,S,l),ie.e=ie.c.length),V=h(p,N,S,v?(y=xt,l):(y=l,xt)),A=C=V.length;V[--C]==0;V.pop());if(!V[0])return y.charAt(0);if(Se<0?--A:(k.c=V,k.e=A,k.s=b,k=j(k,ie,ve,re,S),V=k.c,I=k.r,A=k.e),_=A+ve+1,Se=V[_],C=S/2,I=I||_<0||V[_+1]!=null,I=re<4?(Se!=null||I)&&(re==0||re==(k.s<0?3:2)):Se>C||Se==C&&(re==4||I||re==6&&V[_-1]&1||re==(k.s<0?8:7)),_<1||!V[0])p=I?W(y.charAt(1),-ve,y.charAt(0)):y.charAt(0);else{if(V.length=_,I)for(--S;++V[--_]>S;)V[_]=0,_||(++A,V=[1].concat(V));for(C=V.length;!V[--C];);for(Se=0,p="";Se<=C;p+=y.charAt(V[Se++]));p=W(p,A,y.charAt(0))}return p}})(),j=(function(){function l(N,S,b){var v,y,_,A,C=0,I=N.length,k=S%x,V=S/x|0;for(N=N.slice();I--;)_=N[I]%x,A=N[I]/x|0,v=V*_+A*k,y=k*_+v%x*x+C,C=(y/b|0)+(v/x|0)+V*A,N[I]=y%b;return C&&(N=[C].concat(N)),N}i(l,"multiply");function h(N,S,b,v){var y,_;if(b!=v)_=b>v?1:-1;else for(y=_=0;y<b;y++)if(N[y]!=S[y]){_=N[y]>S[y]?1:-1;break}return _}i(h,"compare");function p(N,S,b,v){for(var y=0;b--;)N[b]-=y,y=N[b]<S[b]?1:0,N[b]=y*v+N[b]-S[b];for(;!N[0]&&N.length>1;N.splice(0,1));}return i(p,"subtract"),function(N,S,b,v,y){var _,A,C,I,k,V,ie,Se,ve,re,fe,De,$r,Kn,Yn,st,rr,Xe=N.s==S.s?1:-1,Qe=N.c,_e=S.c;if(!Qe||!Qe[0]||!_e||!_e[0])return new L(!N.s||!S.s||(Qe?_e&&Qe[0]==_e[0]:!_e)?NaN:Qe&&Qe[0]==0||!_e?Xe*0:Xe/0);for(Se=new L(Xe),ve=Se.c=[],A=N.e-S.e,Xe=b+A+1,y||(y=u,A=G(N.e/m)-G(S.e/m),Xe=Xe/m|0),C=0;_e[C]==(Qe[C]||0);C++);if(_e[C]>(Qe[C]||0)&&A--,Xe<0)ve.push(1),I=!0;else{for(Kn=Qe.length,st=_e.length,C=0,Xe+=2,k=s(y/(_e[0]+1)),k>1&&(_e=l(_e,k,y),Qe=l(Qe,k,y),st=_e.length,Kn=Qe.length),$r=st,re=Qe.slice(0,st),fe=re.length;fe<st;re[fe++]=0);rr=_e.slice(),rr=[0].concat(rr),Yn=_e[0],_e[1]>=y/2&&Yn++;do{if(k=0,_=h(_e,re,st,fe),_<0){if(De=re[0],st!=fe&&(De=De*y+(re[1]||0)),k=s(De/Yn),k>1)for(k>=y&&(k=y-1),V=l(_e,k,y),ie=V.length,fe=re.length;h(V,re,ie,fe)==1;)k--,p(V,st<ie?rr:_e,ie,y),ie=V.length,_=1;else k==0&&(_=k=1),V=_e.slice(),ie=V.length;if(ie<fe&&(V=[0].concat(V)),p(re,V,fe,y),fe=re.length,_==-1)for(;h(_e,re,st,fe)<1;)k++,p(re,st<fe?rr:_e,fe,y),fe=re.length}else _===0&&(k++,re=[0]);ve[C++]=k,re[0]?re[fe++]=Qe[$r]||0:(re=[Qe[$r]],fe=1)}while(($r++<Kn||re[0]!=null)&&Xe--);I=re[0]!=null,ve[0]||ve.splice(0,1)}if(y==u){for(C=1,Xe=ve[0];Xe>=10;Xe/=10,C++);We(Se,b+(Se.e=C+A*m-1)+1,v,I)}else Se.e=A,Se.r=+I;return Se}})();function zn(l,h,p,N){var S,b,v,y,_;if(p==null?p=ue:D(p,0,8),!l.c)return l.toString();if(S=l.c[0],v=l.e,h==null)_=B(l.c),_=N==1||N==2&&(v<=de||v>=Ee)?ee(_,v):W(_,v,"0");else if(l=We(new L(l),h,p),b=l.e,_=B(l.c),y=_.length,N==1||N==2&&(h<=b||b<=de)){for(;y<h;_+="0",y++);_=ee(_,b)}else if(h-=v+(N===2&&b>v),_=W(_,b,"0"),b+1>y){if(--h>0)for(_+=".";h--;_+="0");}else if(h+=b-y,h>0)for(b+1==y&&(_+=".");h--;_+="0");return l.s<0&&S?"-"+_:_}i(zn,"format");function Hs(l,h){for(var p,N,S=1,b=new L(l[0]);S<l.length;S++)N=new L(l[S]),(!N.s||(p=q(b,N))===h||p===0&&b.s===h)&&(b=N);return b}i(Hs,"maxOrMin");function Vn(l,h,p){for(var N=1,S=h.length;!h[--S];h.pop());for(S=h[0];S>=10;S/=10,N++);return(p=N+p*m-1)>Ke?l.c=l.e=null:p<Ge?l.c=[l.e=0]:(l.e=p,l.c=h),l}i(Vn,"normalise"),K=(function(){var l=/^(-?)0([xbo])(?=\w[\w.]*$)/i,h=/^([^.]+)\.$/,p=/^\.([^.]+)$/,N=/^-?(Infinity|NaN)$/,S=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(b,v,y,_){var A,C=y?v:v.replace(S,"");if(N.test(C))b.s=isNaN(C)?null:C<0?-1:1;else{if(!y&&(C=C.replace(l,function(I,k,V){return A=(V=V.toLowerCase())=="x"?16:V=="b"?2:8,!_||_==A?k:I}),_&&(A=_,C=C.replace(h,"$1").replace(p,"0.$1")),v!=C))return new L(C,A);if(L.DEBUG)throw Error(o+"Not a"+(_?" base "+_:"")+" number: "+v);b.s=null}b.c=b.e=null}})();function We(l,h,p,N){var S,b,v,y,_,A,C,I=l.c,k=g;if(I){e:{for(S=1,y=I[0];y>=10;y/=10,S++);if(b=h-S,b<0)b+=m,v=h,_=I[A=0],C=s(_/k[S-v-1]%10);else if(A=n((b+1)/m),A>=I.length)if(N){for(;I.length<=A;I.push(0));_=C=0,S=1,b%=m,v=b-m+1}else break e;else{for(_=y=I[A],S=1;y>=10;y/=10,S++);b%=m,v=b-m+S,C=v<0?0:s(_/k[S-v-1]%10)}if(N=N||h<0||I[A+1]!=null||(v<0?_:_%k[S-v-1]),N=p<4?(C||N)&&(p==0||p==(l.s<0?3:2)):C>5||C==5&&(p==4||N||p==6&&(b>0?v>0?_/k[S-v]:0:I[A-1])%10&1||p==(l.s<0?8:7)),h<1||!I[0])return I.length=0,N?(h-=l.e+1,I[0]=k[(m-h%m)%m],l.e=-h||0):I[0]=l.e=0,l;if(b==0?(I.length=A,y=1,A--):(I.length=A+1,y=k[m-b],I[A]=v>0?s(_/k[S-v]%k[v])*y:0),N)for(;;)if(A==0){for(b=1,v=I[0];v>=10;v/=10,b++);for(v=I[0]+=y,y=1;v>=10;v/=10,y++);b!=y&&(l.e++,I[0]==u&&(I[0]=1));break}else{if(I[A]+=y,I[A]!=u)break;I[A--]=0,y=1}for(b=I.length;I[--b]===0;I.pop());}l.e>Ke?l.c=l.e=null:l.e<Ge&&(l.c=[l.e=0])}return l}i(We,"round");function lt(l){var h,p=l.e;return p===null?l.toString():(h=B(l.c),h=p<=de||p>=Ee?ee(h,p):W(h,p,"0"),l.s<0?"-"+h:h)}return i(lt,"valueOf"),M.absoluteValue=M.abs=function(){var l=new L(this);return l.s<0&&(l.s=1),l},M.comparedTo=function(l,h){return q(this,new L(l,h))},M.decimalPlaces=M.dp=function(l,h){var p,N,S,b=this;if(l!=null)return D(l,0,P),h==null?h=ue:D(h,0,8),We(new L(b),l+b.e+1,h);if(!(p=b.c))return null;if(N=((S=p.length-1)-G(this.e/m))*m,S=p[S])for(;S%10==0;S/=10,N--);return N<0&&(N=0),N},M.dividedBy=M.div=function(l,h){return j(this,new L(l,h),ce,ue)},M.dividedToIntegerBy=M.idiv=function(l,h){return j(this,new L(l,h),0,1)},M.exponentiatedBy=M.pow=function(l,h){var p,N,S,b,v,y,_,A,C,I=this;if(l=new L(l),l.c&&!l.isInteger())throw Error(o+"Exponent not an integer: "+lt(l));if(h!=null&&(h=new L(h)),y=l.e>14,!I.c||!I.c[0]||I.c[0]==1&&!I.e&&I.c.length==1||!l.c||!l.c[0])return C=new L(Math.pow(+lt(I),y?l.s*(2-ne(l)):+lt(l))),h?C.mod(h):C;if(_=l.s<0,h){if(h.c?!h.c[0]:!h.s)return new L(NaN);N=!_&&I.isInteger()&&h.isInteger(),N&&(I=I.mod(h))}else{if(l.e>9&&(I.e>0||I.e<-1||(I.e==0?I.c[0]>1||y&&I.c[1]>=24e7:I.c[0]<8e13||y&&I.c[0]<=9999975e7)))return b=I.s<0&&ne(l)?-0:0,I.e>-1&&(b=1/b),new L(_?1/b:b);ht&&(b=n(ht/m+2))}for(y?(p=new L(.5),_&&(l.s=1),A=ne(l)):(S=Math.abs(+lt(l)),A=S%2),C=new L(ye);;){if(A){if(C=C.times(I),!C.c)break;b?C.c.length>b&&(C.c.length=b):N&&(C=C.mod(h))}if(S){if(S=s(S/2),S===0)break;A=S%2}else if(l=l.times(p),We(l,l.e+1,1),l.e>14)A=ne(l);else{if(S=+lt(l),S===0)break;A=S%2}I=I.times(I),b?I.c&&I.c.length>b&&(I.c.length=b):N&&(I=I.mod(h))}return N?C:(_&&(C=ye.div(C)),h?C.mod(h):b?We(C,ht,ue,v):C)},M.integerValue=function(l){var h=new L(this);return l==null?l=ue:D(l,0,8),We(h,h.e+1,l)},M.isEqualTo=M.eq=function(l,h){return q(this,new L(l,h))===0},M.isFinite=function(){return!!this.c},M.isGreaterThan=M.gt=function(l,h){return q(this,new L(l,h))>0},M.isGreaterThanOrEqualTo=M.gte=function(l,h){return(h=q(this,new L(l,h)))===1||h===0},M.isInteger=function(){return!!this.c&&G(this.e/m)>this.c.length-2},M.isLessThan=M.lt=function(l,h){return q(this,new L(l,h))<0},M.isLessThanOrEqualTo=M.lte=function(l,h){return(h=q(this,new L(l,h)))===-1||h===0},M.isNaN=function(){return!this.s},M.isNegative=function(){return this.s<0},M.isPositive=function(){return this.s>0},M.isZero=function(){return!!this.c&&this.c[0]==0},M.minus=function(l,h){var p,N,S,b,v=this,y=v.s;if(l=new L(l,h),h=l.s,!y||!h)return new L(NaN);if(y!=h)return l.s=-h,v.plus(l);var _=v.e/m,A=l.e/m,C=v.c,I=l.c;if(!_||!A){if(!C||!I)return C?(l.s=-h,l):new L(I?v:NaN);if(!C[0]||!I[0])return I[0]?(l.s=-h,l):new L(C[0]?v:ue==3?-0:0)}if(_=G(_),A=G(A),C=C.slice(),y=_-A){for((b=y<0)?(y=-y,S=C):(A=_,S=I),S.reverse(),h=y;h--;S.push(0));S.reverse()}else for(N=(b=(y=C.length)<(h=I.length))?y:h,y=h=0;h<N;h++)if(C[h]!=I[h]){b=C[h]<I[h];break}if(b&&(S=C,C=I,I=S,l.s=-l.s),h=(N=I.length)-(p=C.length),h>0)for(;h--;C[p++]=0);for(h=u-1;N>y;){if(C[--N]<I[N]){for(p=N;p&&!C[--p];C[p]=h);--C[p],C[N]+=u}C[N]-=I[N]}for(;C[0]==0;C.splice(0,1),--A);return C[0]?Vn(l,C,A):(l.s=ue==3?-1:1,l.c=[l.e=0],l)},M.modulo=M.mod=function(l,h){var p,N,S=this;return l=new L(l,h),!S.c||!l.s||l.c&&!l.c[0]?new L(NaN):!l.c||S.c&&!S.c[0]?new L(S):(Ot==9?(N=l.s,l.s=1,p=j(S,l,0,3),l.s=N,p.s*=N):p=j(S,l,0,Ot),l=S.minus(p.times(l)),!l.c[0]&&Ot==1&&(l.s=S.s),l)},M.multipliedBy=M.times=function(l,h){var p,N,S,b,v,y,_,A,C,I,k,V,ie,Se,ve,re=this,fe=re.c,De=(l=new L(l,h)).c;if(!fe||!De||!fe[0]||!De[0])return!re.s||!l.s||fe&&!fe[0]&&!De||De&&!De[0]&&!fe?l.c=l.e=l.s=null:(l.s*=re.s,!fe||!De?l.c=l.e=null:(l.c=[0],l.e=0)),l;for(N=G(re.e/m)+G(l.e/m),l.s*=re.s,_=fe.length,I=De.length,_<I&&(ie=fe,fe=De,De=ie,S=_,_=I,I=S),S=_+I,ie=[];S--;ie.push(0));for(Se=u,ve=x,S=I;--S>=0;){for(p=0,k=De[S]%ve,V=De[S]/ve|0,v=_,b=S+v;b>S;)A=fe[--v]%ve,C=fe[v]/ve|0,y=V*A+C*k,A=k*A+y%ve*ve+ie[b]+p,p=(A/Se|0)+(y/ve|0)+V*C,ie[b--]=A%Se;ie[b]=p}return p?++N:ie.splice(0,1),Vn(l,ie,N)},M.negated=function(){var l=new L(this);return l.s=-l.s||null,l},M.plus=function(l,h){var p,N=this,S=N.s;if(l=new L(l,h),h=l.s,!S||!h)return new L(NaN);if(S!=h)return l.s=-h,N.minus(l);var b=N.e/m,v=l.e/m,y=N.c,_=l.c;if(!b||!v){if(!y||!_)return new L(S/0);if(!y[0]||!_[0])return _[0]?l:new L(y[0]?N:S*0)}if(b=G(b),v=G(v),y=y.slice(),S=b-v){for(S>0?(v=b,p=_):(S=-S,p=y),p.reverse();S--;p.push(0));p.reverse()}for(S=y.length,h=_.length,S-h<0&&(p=_,_=y,y=p,h=S),S=0;h;)S=(y[--h]=y[h]+_[h]+S)/u|0,y[h]=u===y[h]?0:y[h]%u;return S&&(y=[S].concat(y),++v),Vn(l,y,v)},M.precision=M.sd=function(l,h){var p,N,S,b=this;if(l!=null&&l!==!!l)return D(l,1,P),h==null?h=ue:D(h,0,8),We(new L(b),l,h);if(!(p=b.c))return null;if(S=p.length-1,N=S*m+1,S=p[S]){for(;S%10==0;S/=10,N--);for(S=p[0];S>=10;S/=10,N++);}return l&&b.e+1>N&&(N=b.e+1),N},M.shiftedBy=function(l){return D(l,-E,E),this.times("1e"+l)},M.squareRoot=M.sqrt=function(){var l,h,p,N,S,b=this,v=b.c,y=b.s,_=b.e,A=ce+4,C=new L("0.5");if(y!==1||!v||!v[0])return new L(!y||y<0&&(!v||v[0])?NaN:v?b:1/0);if(y=Math.sqrt(+lt(b)),y==0||y==1/0?(h=B(v),(h.length+_)%2==0&&(h+="0"),y=Math.sqrt(+h),_=G((_+1)/2)-(_<0||_%2),y==1/0?h="5e"+_:(h=y.toExponential(),h=h.slice(0,h.indexOf("e")+1)+_),p=new L(h)):p=new L(y+""),p.c[0]){for(_=p.e,y=_+A,y<3&&(y=0);;)if(S=p,p=C.times(S.plus(j(b,S,A,1))),B(S.c).slice(0,y)===(h=B(p.c)).slice(0,y))if(p.e<_&&--y,h=h.slice(y-3,y+1),h=="9999"||!N&&h=="4999"){if(!N&&(We(S,S.e+ce+2,0),S.times(S).eq(b))){p=S;break}A+=4,y+=4,N=1}else{(!+h||!+h.slice(1)&&h.charAt(0)=="5")&&(We(p,p.e+ce+2,1),l=!p.times(p).eq(b));break}}return We(p,p.e+ce+1,ue,l)},M.toExponential=function(l,h){return l!=null&&(D(l,0,P),l++),zn(this,l,h,1)},M.toFixed=function(l,h){return l!=null&&(D(l,0,P),l=l+this.e+1),zn(this,l,h)},M.toFormat=function(l,h,p){var N,S=this;if(p==null)l!=null&&h&&typeof h=="object"?(p=h,h=null):l&&typeof l=="object"?(p=l,l=h=null):p=Qn;else if(typeof p!="object")throw Error(o+"Argument not an object: "+p);if(N=S.toFixed(l,h),S.c){var b,v=N.split("."),y=+p.groupSize,_=+p.secondaryGroupSize,A=p.groupSeparator||"",C=v[0],I=v[1],k=S.s<0,V=k?C.slice(1):C,ie=V.length;if(_&&(b=y,y=_,_=b,ie-=b),y>0&&ie>0){for(b=ie%y||y,C=V.substr(0,b);b<ie;b+=y)C+=A+V.substr(b,y);_>0&&(C+=A+V.slice(b)),k&&(C="-"+C)}N=I?C+(p.decimalSeparator||"")+((_=+p.fractionGroupSize)?I.replace(new RegExp("\\d{"+_+"}\\B","g"),"$&"+(p.fractionGroupSeparator||"")):I):C}return(p.prefix||"")+N+(p.suffix||"")},M.toFraction=function(l){var h,p,N,S,b,v,y,_,A,C,I,k,V=this,ie=V.c;if(l!=null&&(y=new L(l),!y.isInteger()&&(y.c||y.s!==1)||y.lt(ye)))throw Error(o+"Argument "+(y.isInteger()?"out of range: ":"not an integer: ")+lt(y));if(!ie)return new L(V);for(h=new L(ye),A=p=new L(ye),N=_=new L(ye),k=B(ie),b=h.e=k.length-V.e-1,h.c[0]=g[(v=b%m)<0?m+v:v],l=!l||y.comparedTo(h)>0?b>0?h:A:y,v=Ke,Ke=1/0,y=new L(k),_.c[0]=0;C=j(y,h,0,1),S=p.plus(C.times(N)),S.comparedTo(l)!=1;)p=N,N=S,A=_.plus(C.times(S=A)),_=S,h=y.minus(C.times(S=h)),y=S;return S=j(l.minus(p),N,0,1),_=_.plus(S.times(A)),p=p.plus(S.times(N)),_.s=A.s=V.s,b=b*2,I=j(A,N,b,ue).minus(V).abs().comparedTo(j(_,p,b,ue).minus(V).abs())<1?[A,N]:[_,p],Ke=v,I},M.toNumber=function(){return+lt(this)},M.toPrecision=function(l,h){return l!=null&&D(l,1,P),zn(this,l,h,2)},M.toString=function(l){var h,p=this,N=p.s,S=p.e;return S===null?N?(h="Infinity",N<0&&(h="-"+h)):h="NaN":(l==null?h=S<=de||S>=Ee?ee(B(p.c),S):W(B(p.c),S,"0"):l===10&&kn?(p=We(new L(p),ce+S+1,ue),h=W(B(p.c),p.e,"0")):(D(l,2,xt.length,"Base"),h=$(W(B(p.c),S,"0"),10,l,N,!0)),N<0&&p.c[0]&&(h="-"+h)),h},M.valueOf=M.toJSON=function(){return lt(this)},M._isBigNumber=!0,Q!=null&&L.set(Q),L}i(Y,"clone");function G(Q){var j=Q|0;return Q>0||Q===j?j:j-1}i(G,"bitFloor");function B(Q){for(var j,$,K=1,M=Q.length,ye=Q[0]+"";K<M;){for(j=Q[K++]+"",$=m-j.length;$--;j="0"+j);ye+=j}for(M=ye.length;ye.charCodeAt(--M)===48;);return ye.slice(0,M+1||1)}i(B,"coeffToString");function q(Q,j){var $,K,M=Q.c,ye=j.c,ce=Q.s,ue=j.s,de=Q.e,Ee=j.e;if(!ce||!ue)return null;if($=M&&!M[0],K=ye&&!ye[0],$||K)return $?K?0:-ue:ce;if(ce!=ue)return ce;if($=ce<0,K=de==Ee,!M||!ye)return K?0:!M^$?1:-1;if(!K)return de>Ee^$?1:-1;for(ue=(de=M.length)<(Ee=ye.length)?de:Ee,ce=0;ce<ue;ce++)if(M[ce]!=ye[ce])return M[ce]>ye[ce]^$?1:-1;return de==Ee?0:de>Ee^$?1:-1}i(q,"compare");function D(Q,j,$,K){if(Q<j||Q>$||Q!==s(Q))throw Error(o+(K||"Argument")+(typeof Q=="number"?Q<j||Q>$?" out of range: ":" not an integer: ":" not a primitive number: ")+String(Q))}i(D,"intCheck");function ne(Q){var j=Q.c.length-1;return G(Q.e/m)==j&&Q.c[j]%2!=0}i(ne,"isOdd");function ee(Q,j){return(Q.length>1?Q.charAt(0)+"."+Q.slice(1):Q)+(j<0?"e":"e+")+j}i(ee,"toExponential");function W(Q,j,$){var K,M;if(j<0){for(M=$+".";++j;M+=$);Q=M+Q}else if(K=Q.length,++j>K){for(M=$,j-=K;--j;M+=$);Q+=M}else j<K&&(Q=Q.slice(0,j)+"."+Q.slice(j));return Q}i(W,"toFixedPoint"),e=Y(),e.default=e.BigNumber=e,typeof define=="function"&&define.amd?define(function(){return e}):typeof Jr<"u"&&Jr.exports?Jr.exports=e:(t||(t=typeof self<"u"&&self?self:window),t.BigNumber=e)})(ia)});var ua=se((gT,aa)=>{d();f();c();var sa=yi(),oa=aa.exports;(function(){"use strict";function t(E){return E<10?"0"+E:E}i(t,"f");var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,r=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n,s,o={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},a;function u(E){return r.lastIndex=0,r.test(E)?'"'+E.replace(r,function(g){var x=o[g];return typeof x=="string"?x:"\\u"+("0000"+g.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+E+'"'}i(u,"quote");function m(E,g){var x,P,Y,G,B=n,q,D=g[E],ne=D!=null&&(D instanceof sa||sa.isBigNumber(D));switch(D&&typeof D=="object"&&typeof D.toJSON=="function"&&(D=D.toJSON(E)),typeof a=="function"&&(D=a.call(g,E,D)),typeof D){case"string":return ne?D:u(D);case"number":return isFinite(D)?String(D):"null";case"boolean":case"null":case"bigint":return String(D);case"object":if(!D)return"null";if(n+=s,q=[],Object.prototype.toString.apply(D)==="[object Array]"){for(G=D.length,x=0;x<G;x+=1)q[x]=m(x,D)||"null";return Y=q.length===0?"[]":n?`[
`+n+q.join(`,
`+n)+`
`+B+"]":"["+q.join(",")+"]",n=B,Y}if(a&&typeof a=="object")for(G=a.length,x=0;x<G;x+=1)typeof a[x]=="string"&&(P=a[x],Y=m(P,D),Y&&q.push(u(P)+(n?": ":":")+Y));else Object.keys(D).forEach(function(ee){var W=m(ee,D);W&&q.push(u(ee)+(n?": ":":")+W)});return Y=q.length===0?"{}":n?`{
`+n+q.join(`,
`+n)+`
`+B+"}":"{"+q.join(",")+"}",n=B,Y}}i(m,"str"),typeof oa.stringify!="function"&&(oa.stringify=function(E,g,x){var P;if(n="",s="",typeof x=="number")for(P=0;P<x;P+=1)s+=" ";else typeof x=="string"&&(s=x);if(a=g,g&&typeof g!="function"&&(typeof g!="object"||typeof g.length!="number"))throw new Error("JSON.stringify");return m("",{"":E})})})()});var ca=se((_T,la)=>{d();f();c();var Gr=null,ph=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,gh=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/,yh=i(function(t){"use strict";var e={strict:!1,storeAsString:!1,alwaysParseAsBig:!1,useNativeBigInt:!1,protoAction:"error",constructorAction:"error"};if(t!=null){if(t.strict===!0&&(e.strict=!0),t.storeAsString===!0&&(e.storeAsString=!0),e.alwaysParseAsBig=t.alwaysParseAsBig===!0?t.alwaysParseAsBig:!1,e.useNativeBigInt=t.useNativeBigInt===!0?t.useNativeBigInt:!1,typeof t.constructorAction<"u")if(t.constructorAction==="error"||t.constructorAction==="ignore"||t.constructorAction==="preserve")e.constructorAction=t.constructorAction;else throw new Error(`Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed ${t.constructorAction}`);if(typeof t.protoAction<"u")if(t.protoAction==="error"||t.protoAction==="ignore"||t.protoAction==="preserve")e.protoAction=t.protoAction;else throw new Error(`Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed ${t.protoAction}`)}var r,n,s={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},o,a=i(function(B){throw{name:"SyntaxError",message:B,at:r,text:o}},"error"),u=i(function(B){return B&&B!==n&&a("Expected '"+B+"' instead of '"+n+"'"),n=o.charAt(r),r+=1,n},"next"),m=i(function(){var B,q="";for(n==="-"&&(q="-",u("-"));n>="0"&&n<="9";)q+=n,u();if(n===".")for(q+=".";u()&&n>="0"&&n<="9";)q+=n;if(n==="e"||n==="E")for(q+=n,u(),(n==="-"||n==="+")&&(q+=n,u());n>="0"&&n<="9";)q+=n,u();if(B=+q,!isFinite(B))a("Bad number");else return Gr==null&&(Gr=yi()),q.length>15?e.storeAsString?q:e.useNativeBigInt?BigInt(q):new Gr(q):e.alwaysParseAsBig?e.useNativeBigInt?BigInt(B):new Gr(B):B},"number"),E=i(function(){var B,q,D="",ne;if(n==='"')for(var ee=r;u();){if(n==='"')return r-1>ee&&(D+=o.substring(ee,r-1)),u(),D;if(n==="\\"){if(r-1>ee&&(D+=o.substring(ee,r-1)),u(),n==="u"){for(ne=0,q=0;q<4&&(B=parseInt(u(),16),!!isFinite(B));q+=1)ne=ne*16+B;D+=String.fromCharCode(ne)}else if(typeof s[n]=="string")D+=s[n];else break;ee=r}}a("Bad string")},"string"),g=i(function(){for(;n&&n<=" ";)u()},"white"),x=i(function(){switch(n){case"t":return u("t"),u("r"),u("u"),u("e"),!0;case"f":return u("f"),u("a"),u("l"),u("s"),u("e"),!1;case"n":return u("n"),u("u"),u("l"),u("l"),null}a("Unexpected '"+n+"'")},"word"),P,Y=i(function(){var B=[];if(n==="["){if(u("["),g(),n==="]")return u("]"),B;for(;n;){if(B.push(P()),g(),n==="]")return u("]"),B;u(","),g()}}a("Bad array")},"array"),G=i(function(){var B,q=Object.create(null);if(n==="{"){if(u("{"),g(),n==="}")return u("}"),q;for(;n;){if(B=E(),g(),u(":"),e.strict===!0&&Object.hasOwnProperty.call(q,B)&&a('Duplicate key "'+B+'"'),ph.test(B)===!0?e.protoAction==="error"?a("Object contains forbidden prototype property"):e.protoAction==="ignore"?P():q[B]=P():gh.test(B)===!0?e.constructorAction==="error"?a("Object contains forbidden constructor property"):e.constructorAction==="ignore"?P():q[B]=P():q[B]=P(),g(),n==="}")return u("}"),q;u(","),g()}}a("Bad object")},"object");return P=i(function(){switch(g(),n){case"{":return G();case"[":return Y();case'"':return E();case"-":return m();default:return n>="0"&&n<="9"?m():x()}},"value"),function(B,q){var D;return o=B+"",r=0,n=" ",D=P(),g(),n&&a("Syntax error"),typeof q=="function"?i((function ne(ee,W){var Q,j,$=ee[W];return $&&typeof $=="object"&&Object.keys($).forEach(function(K){j=ne($,K),j!==void 0?$[K]=j:delete $[K]}),q.call(ee,W,$)}),"walk")({"":D},""):D}},"json_parse");la.exports=yh});var ha=se((AT,Wr)=>{d();f();c();var fa=ua().stringify,da=ca();Wr.exports=function(t){return{parse:da(t),stringify:fa}};Wr.exports.parse=da();Wr.exports.stringify=fa});var Xr=se(Ei=>{"use strict";d();f();c();Object.defineProperty(Ei,"__esModule",{value:!0});var Eh=Object.freeze({CHARSET_DEFAULT:"utf-8",EXTENSIONS_PREFIX:"ce-",ENCODING_BASE64:"base64",DATA_ATTRIBUTE:"data",MIME_JSON:"application/json",MIME_OCTET_STREAM:"application/octet-stream",MIME_CE:"application/cloudevents",MIME_CE_JSON:"application/cloudevents+json",MIME_CE_BATCH:"application/cloudevents-batch+json",HEADER_CONTENT_TYPE:"content-type",DEFAULT_CONTENT_TYPE:"application/json; charset=utf-8",DEFAULT_CE_CONTENT_TYPE:"application/cloudevents+json; charset=utf-8",CE_HEADERS:{TYPE:"ce-type",SPEC_VERSION:"ce-specversion",SOURCE:"ce-source",ID:"ce-id",TIME:"ce-time",SUBJECT:"ce-subject"},CE_ATTRIBUTES:{ID:"id",TYPE:"type",SOURCE:"source",SPEC_VERSION:"specversion",TIME:"time",CONTENT_TYPE:"datacontenttype",SUBJECT:"subject",DATA:"data"},BINARY_HEADERS_03:{SCHEMA_URL:"ce-schemaurl",CONTENT_ENCODING:"ce-datacontentencoding"},STRUCTURED_ATTRS_03:{SCHEMA_URL:"schemaurl",CONTENT_ENCODING:"datacontentencoding"},BINARY_HEADERS_1:{DATA_SCHEMA:"ce-dataschema"},STRUCTURED_ATTRS_1:{DATA_SCHEMA:"dataschema",DATA_BASE64:"data_base64"},USE_BIG_INT_ENV:"CE_USE_BIG_INT"});Ei.default=Eh});var Si=se(Ie=>{"use strict";d();f();c();var ma=Ie&&Ie.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.parserByEncoding=Ie.DateParser=Ie.Base64Parser=Ie.parserByContentType=Ie.PassThroughParser=Ie.JSONParser=Ie.Parser=void 0;var Th=ma(ha()),Tt=ma(Xr()),dr=Pt(),Sh=JSON,hr=class{static{i(this,"Parser")}};Ie.Parser=hr;var mr=class{static{i(this,"JSONParser")}constructor(e){this.decorator=e}parse(e){return typeof e=="string"&&(/^[[|{|"]/.test(e)||(e=`"${e}"`)),this.decorator&&(e=this.decorator.parse(e)),(0,dr.isDefinedOrThrow)(e,new dr.ValidationError("null or undefined payload")),(0,dr.isStringOrObjectOrThrow)(e,new dr.ValidationError("invalid payload type, allowed are: string or object")),process.env[Tt.default.USE_BIG_INT_ENV]==="true"?JSON=(0,Th.default)({useNativeBigInt:!0}):JSON=Sh,i(n=>(0,dr.isString)(n)?JSON.parse(n):n,"parseJSON")(e)}};Ie.JSONParser=mr;var pr=class extends hr{static{i(this,"PassThroughParser")}parse(e){return e}};Ie.PassThroughParser=pr;var Zr=new mr;Ie.parserByContentType={[Tt.default.MIME_JSON]:Zr,[Tt.default.MIME_CE_JSON]:Zr,[Tt.default.DEFAULT_CONTENT_TYPE]:Zr,[Tt.default.DEFAULT_CE_CONTENT_TYPE]:Zr,[Tt.default.MIME_OCTET_STREAM]:new pr};var en=class{static{i(this,"Base64Parser")}constructor(e){this.decorator=e}parse(e){let r=e;return this.decorator&&(r=this.decorator.parse(e)),Buffer.from(r,"base64").toString()}};Ie.Base64Parser=en;var Ti=class extends hr{static{i(this,"DateParser")}parse(e){let r=new Date(Date.parse(e));return r.toString()==="Invalid Date"&&(r=new Date),r.toISOString()}};Ie.DateParser=Ti;Ie.parserByEncoding={base64:{[Tt.default.MIME_CE_JSON]:new mr(new en),[Tt.default.MIME_OCTET_STREAM]:new pr}}});var _i=se(pe=>{"use strict";d();f();c();var _h=pe&&pe.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(pe,"__esModule",{value:!0});pe.v03structuredParsers=pe.v03binaryParsers=pe.v03headerMap=pe.v1structuredParsers=pe.v1binaryParsers=pe.v1headerMap=pe.sanitize=pe.headersFor=pe.requiredHeaders=pe.allowedContentTypes=void 0;var gr=Si(),bh=Yr(),O=_h(Xr());pe.allowedContentTypes=[O.default.DEFAULT_CONTENT_TYPE,O.default.MIME_JSON,O.default.MIME_OCTET_STREAM];pe.requiredHeaders=[O.default.CE_HEADERS.ID,O.default.CE_HEADERS.SOURCE,O.default.CE_HEADERS.TYPE,O.default.CE_HEADERS.SPEC_VERSION];function wh(t){let e={},r;return t.specversion===bh.V1?r=pe.v1headerMap:r=pe.v03headerMap,Object.getOwnPropertyNames(t).forEach(n=>{let s=t[n];if(s!==void 0){let o=r[n];o?e[o.name]=o.parser.parse(s):n!==O.default.DATA_ATTRIBUTE&&n!==`${O.default.DATA_ATTRIBUTE}_base64`&&(e[`${O.default.EXTENSIONS_PREFIX}${n}`]=s)}}),t.time&&(e[O.default.CE_HEADERS.TIME]=new Date(t.time).toISOString()),e}i(wh,"headersFor");pe.headersFor=wh;function Ch(t){let e={};return Array.from(Object.keys(t)).filter(r=>Object.hasOwnProperty.call(t,r)).forEach(r=>e[r.toLowerCase()]=t[r]),e}i(Ch,"sanitize");pe.sanitize=Ch;function z(t,e=new gr.PassThroughParser){return{name:t,parser:e}}i(z,"parser");pe.v1headerMap=Object.freeze({[O.default.CE_ATTRIBUTES.CONTENT_TYPE]:z(O.default.HEADER_CONTENT_TYPE),[O.default.CE_ATTRIBUTES.SUBJECT]:z(O.default.CE_HEADERS.SUBJECT),[O.default.CE_ATTRIBUTES.TYPE]:z(O.default.CE_HEADERS.TYPE),[O.default.CE_ATTRIBUTES.SPEC_VERSION]:z(O.default.CE_HEADERS.SPEC_VERSION),[O.default.CE_ATTRIBUTES.SOURCE]:z(O.default.CE_HEADERS.SOURCE),[O.default.CE_ATTRIBUTES.ID]:z(O.default.CE_HEADERS.ID),[O.default.CE_ATTRIBUTES.TIME]:z(O.default.CE_HEADERS.TIME),[O.default.STRUCTURED_ATTRS_1.DATA_SCHEMA]:z(O.default.BINARY_HEADERS_1.DATA_SCHEMA)});pe.v1binaryParsers=Object.freeze({[O.default.CE_HEADERS.TYPE]:z(O.default.CE_ATTRIBUTES.TYPE),[O.default.CE_HEADERS.SPEC_VERSION]:z(O.default.CE_ATTRIBUTES.SPEC_VERSION),[O.default.CE_HEADERS.SOURCE]:z(O.default.CE_ATTRIBUTES.SOURCE),[O.default.CE_HEADERS.ID]:z(O.default.CE_ATTRIBUTES.ID),[O.default.CE_HEADERS.TIME]:z(O.default.CE_ATTRIBUTES.TIME,new gr.DateParser),[O.default.BINARY_HEADERS_1.DATA_SCHEMA]:z(O.default.STRUCTURED_ATTRS_1.DATA_SCHEMA),[O.default.CE_HEADERS.SUBJECT]:z(O.default.CE_ATTRIBUTES.SUBJECT),[O.default.CE_ATTRIBUTES.CONTENT_TYPE]:z(O.default.CE_ATTRIBUTES.CONTENT_TYPE),[O.default.HEADER_CONTENT_TYPE]:z(O.default.CE_ATTRIBUTES.CONTENT_TYPE)});pe.v1structuredParsers=Object.freeze({[O.default.CE_ATTRIBUTES.TYPE]:z(O.default.CE_ATTRIBUTES.TYPE),[O.default.CE_ATTRIBUTES.SPEC_VERSION]:z(O.default.CE_ATTRIBUTES.SPEC_VERSION),[O.default.CE_ATTRIBUTES.SOURCE]:z(O.default.CE_ATTRIBUTES.SOURCE),[O.default.CE_ATTRIBUTES.ID]:z(O.default.CE_ATTRIBUTES.ID),[O.default.CE_ATTRIBUTES.TIME]:z(O.default.CE_ATTRIBUTES.TIME,new gr.DateParser),[O.default.STRUCTURED_ATTRS_1.DATA_SCHEMA]:z(O.default.STRUCTURED_ATTRS_1.DATA_SCHEMA),[O.default.CE_ATTRIBUTES.CONTENT_TYPE]:z(O.default.CE_ATTRIBUTES.CONTENT_TYPE),[O.default.CE_ATTRIBUTES.SUBJECT]:z(O.default.CE_ATTRIBUTES.SUBJECT),[O.default.CE_ATTRIBUTES.DATA]:z(O.default.CE_ATTRIBUTES.DATA),[O.default.STRUCTURED_ATTRS_1.DATA_BASE64]:z(O.default.STRUCTURED_ATTRS_1.DATA_BASE64)});pe.v03headerMap=Object.freeze({[O.default.CE_ATTRIBUTES.CONTENT_TYPE]:z(O.default.HEADER_CONTENT_TYPE),[O.default.CE_ATTRIBUTES.SUBJECT]:z(O.default.CE_HEADERS.SUBJECT),[O.default.CE_ATTRIBUTES.TYPE]:z(O.default.CE_HEADERS.TYPE),[O.default.CE_ATTRIBUTES.SPEC_VERSION]:z(O.default.CE_HEADERS.SPEC_VERSION),[O.default.CE_ATTRIBUTES.SOURCE]:z(O.default.CE_HEADERS.SOURCE),[O.default.CE_ATTRIBUTES.ID]:z(O.default.CE_HEADERS.ID),[O.default.CE_ATTRIBUTES.TIME]:z(O.default.CE_HEADERS.TIME),[O.default.STRUCTURED_ATTRS_03.CONTENT_ENCODING]:z(O.default.BINARY_HEADERS_03.CONTENT_ENCODING),[O.default.STRUCTURED_ATTRS_03.SCHEMA_URL]:z(O.default.BINARY_HEADERS_03.SCHEMA_URL)});pe.v03binaryParsers=Object.freeze({[O.default.CE_HEADERS.TYPE]:z(O.default.CE_ATTRIBUTES.TYPE),[O.default.CE_HEADERS.SPEC_VERSION]:z(O.default.CE_ATTRIBUTES.SPEC_VERSION),[O.default.CE_HEADERS.SOURCE]:z(O.default.CE_ATTRIBUTES.SOURCE),[O.default.CE_HEADERS.ID]:z(O.default.CE_ATTRIBUTES.ID),[O.default.CE_HEADERS.TIME]:z(O.default.CE_ATTRIBUTES.TIME,new gr.DateParser),[O.default.BINARY_HEADERS_03.SCHEMA_URL]:z(O.default.STRUCTURED_ATTRS_03.SCHEMA_URL),[O.default.CE_HEADERS.SUBJECT]:z(O.default.CE_ATTRIBUTES.SUBJECT),[O.default.BINARY_HEADERS_03.CONTENT_ENCODING]:z(O.default.STRUCTURED_ATTRS_03.CONTENT_ENCODING),[O.default.HEADER_CONTENT_TYPE]:z(O.default.CE_ATTRIBUTES.CONTENT_TYPE)});pe.v03structuredParsers=Object.freeze({[O.default.CE_ATTRIBUTES.TYPE]:z(O.default.CE_ATTRIBUTES.TYPE),[O.default.CE_ATTRIBUTES.SPEC_VERSION]:z(O.default.CE_ATTRIBUTES.SPEC_VERSION),[O.default.CE_ATTRIBUTES.SOURCE]:z(O.default.CE_ATTRIBUTES.SOURCE),[O.default.CE_ATTRIBUTES.ID]:z(O.default.CE_ATTRIBUTES.ID),[O.default.CE_ATTRIBUTES.TIME]:z(O.default.CE_ATTRIBUTES.TIME,new gr.DateParser),[O.default.STRUCTURED_ATTRS_03.SCHEMA_URL]:z(O.default.STRUCTURED_ATTRS_03.SCHEMA_URL),[O.default.STRUCTURED_ATTRS_03.CONTENT_ENCODING]:z(O.default.STRUCTURED_ATTRS_03.CONTENT_ENCODING),[O.default.CE_ATTRIBUTES.CONTENT_TYPE]:z(O.default.CE_ATTRIBUTES.CONTENT_TYPE),[O.default.CE_ATTRIBUTES.SUBJECT]:z(O.default.CE_ATTRIBUTES.SUBJECT),[O.default.CE_ATTRIBUTES.DATA]:z(O.default.CE_ATTRIBUTES.DATA)})});var ga=se(tn=>{"use strict";d();f();c();Object.defineProperty(tn,"__esModule",{value:!0});tn.HTTP=void 0;var Nh=na(),le=Bt(),_t=_i(),St=Pt(),bi=Si();function Ah(t){let r={...{[le.CONSTANTS.HEADER_CONTENT_TYPE]:le.CONSTANTS.DEFAULT_CONTENT_TYPE},...(0,_t.headersFor)(t)},n=t.data;return typeof t.data=="object"&&!Nh.types.isTypedArray(t.data)&&(n=JSON.stringify(t.data)),{headers:r,body:n}}i(Ah,"binary");function vh(t){return t.data_base64&&(t=t.cloneWith({data:void 0})),{headers:{[le.CONSTANTS.HEADER_CONTENT_TYPE]:le.CONSTANTS.DEFAULT_CE_CONTENT_TYPE},body:t.toString()}}i(vh,"structured");function Oh(t){try{return pa(t),!0}catch{return!1}}i(Oh,"isEvent");function pa(t){let e=(0,_t.sanitize)(t.headers),r=xh(e),n=Rh(r,e,t.body);switch(r){case le.Mode.BINARY:return Ih(t,n);case le.Mode.STRUCTURED:return Ph(t,n);case le.Mode.BATCH:return Bh(t);default:throw new St.ValidationError("Unknown Message mode")}}i(pa,"deserialize");function xh(t){let e=t[le.CONSTANTS.HEADER_CONTENT_TYPE];if(e){if(e.startsWith(le.CONSTANTS.MIME_CE_BATCH))return le.Mode.BATCH;if(e.startsWith(le.CONSTANTS.MIME_CE))return le.Mode.STRUCTURED}if(t[le.CONSTANTS.CE_HEADERS.ID])return le.Mode.BINARY;throw new St.ValidationError("no cloud event detected")}i(xh,"getMode");function Rh(t,e,r){if(t===le.Mode.BINARY){let n=e[le.CONSTANTS.CE_HEADERS.SPEC_VERSION];if(n)return n}else return typeof r=="string"?JSON.parse(r).specversion:r.specversion;return le.V1}i(Rh,"getVersion");function Ih(t,e){let r={...t.headers},n=t.body;if(!r)throw new St.ValidationError("headers is null or undefined");let s=(0,_t.sanitize)(r),o={},a=e===le.V03?_t.v03binaryParsers:_t.v1binaryParsers;for(let m in a)if(s[m]){let E=a[m];o[E.name]=E.parser.parse(s[m]),delete s[m],delete r[m]}for(let m in r)m.startsWith(le.CONSTANTS.EXTENSIONS_PREFIX)&&(o[m.substring(le.CONSTANTS.EXTENSIONS_PREFIX.length)]=r[m]);let u=bi.parserByContentType[o.datacontenttype];return u&&n&&(n=u.parse(n)),o.datacontenttype===le.CONSTANTS.MIME_JSON&&o.datacontentencoding===le.CONSTANTS.ENCODING_BASE64&&delete o.datacontentencoding,new le.CloudEvent({...o,data:n},!1)}i(Ih,"parseBinary");function Ph(t,e){let r=t.body,n=t.headers;if(!r)throw new St.ValidationError("payload is null or undefined");if(!n)throw new St.ValidationError("headers is null or undefined");(0,St.isStringOrObjectOrThrow)(r,new St.ValidationError("payload must be an object or a string"));let s=(0,_t.sanitize)(n),o=s[le.CONSTANTS.HEADER_CONTENT_TYPE],a=o?bi.parserByContentType[o]:new bi.JSONParser;if(!a)throw new St.ValidationError(`invalid content type ${s[le.CONSTANTS.HEADER_CONTENT_TYPE]}`);let u={...a.parse(r)},m={},E=e===le.V03?_t.v03structuredParsers:_t.v1structuredParsers;for(let g in E){let x=u[g];if(x){let P=E[g];m[P.name]=P.parser.parse(x)}delete u[g]}for(let g in u)m[g]=u[g];if(m.data_base64||m.datacontentencoding===le.CONSTANTS.ENCODING_BASE64){let g=m.data_base64||m.data;m.data=new Uint32Array(Buffer.from(g,"base64")),delete m.data_base64,delete m.datacontentencoding}return new le.CloudEvent(m,!1)}i(Ph,"parseStructured");function Bh(t){let e=[];return JSON.parse(t.body).forEach(n=>{e.push(new le.CloudEvent(n))}),e}i(Bh,"parseBatched");tn.HTTP={binary:Ah,structured:vh,toEvent:pa,isEvent:Oh}});var Ea=se(qe=>{"use strict";d();f();c();Object.defineProperty(qe,"__esModule",{value:!0});qe.headersFor=qe.HEADER_MAP=qe.KAFKA_CE_HEADERS=void 0;var ya=Bt();qe.KAFKA_CE_HEADERS=Object.freeze({ID:"ce_id",TYPE:"ce_type",SOURCE:"ce_source",SPEC_VERSION:"ce_specversion",TIME:"ce_time",SUBJECT:"ce_subject",DATACONTENTTYPE:"ce_datacontenttype",DATASCHEMA:"ce_dataschema"});qe.HEADER_MAP={[qe.KAFKA_CE_HEADERS.ID]:"id",[qe.KAFKA_CE_HEADERS.TYPE]:"type",[qe.KAFKA_CE_HEADERS.SOURCE]:"source",[qe.KAFKA_CE_HEADERS.SPEC_VERSION]:"specversion",[qe.KAFKA_CE_HEADERS.TIME]:"time",[qe.KAFKA_CE_HEADERS.SUBJECT]:"subject",[qe.KAFKA_CE_HEADERS.DATACONTENTTYPE]:"datacontenttype",[qe.KAFKA_CE_HEADERS.DATASCHEMA]:"dataschema"};function Dh(t){let e={};return Object.getOwnPropertyNames(t).forEach(r=>{r!=ya.CONSTANTS.CE_ATTRIBUTES.DATA&&r!=ya.CONSTANTS.STRUCTURED_ATTRS_1.DATA_BASE64&&(e[`ce_${r}`]=t[r])}),e}i(Dh,"headersFor");qe.headersFor=Dh});var ba=se(rn=>{"use strict";d();f();c();Object.defineProperty(rn,"__esModule",{value:!0});rn.Kafka=void 0;var te=Bt(),Qt=Ea(),Ta=_i(),Lh={binary:Mh,structured:Uh,toEvent:$h,isEvent:Sa};rn.Kafka=Lh;function Mh(t){return{headers:{[te.CONSTANTS.HEADER_CONTENT_TYPE]:t.datacontenttype,...(0,Qt.headersFor)(t)},key:t.partitionkey,value:t.data,body:t.data,timestamp:_a(t.time)}}i(Mh,"toBinaryKafkaMessage");function Uh(t){t instanceof te.CloudEvent&&t.data_base64&&(t=t.cloneWith({data:void 0}));let e=t.toString();return{key:t.partitionkey,value:e,headers:{[te.CONSTANTS.HEADER_CONTENT_TYPE]:te.CONSTANTS.DEFAULT_CE_CONTENT_TYPE},body:e,timestamp:_a(t.time)}}i(Uh,"toStructuredKafkaMessage");function $h(t){if(!Sa(t))throw new te.ValidationError("No CloudEvent detected");let e=t;if(!e.value)throw new te.ValidationError("Value is null or undefined");if(!e.headers)throw new te.ValidationError("Headers are null or undefined");let r=(0,Ta.sanitize)(e.headers);switch(qh(r)){case te.Mode.BINARY:return jh(e);case te.Mode.STRUCTURED:return Fh(e);case te.Mode.BATCH:return Hh(e);default:throw new te.ValidationError("Unknown Message mode")}}i($h,"deserializeKafkaMessage");function Sa(t){let e=(0,Ta.sanitize)(t.headers);return!!e[Qt.KAFKA_CE_HEADERS.ID]||e[te.CONSTANTS.HEADER_CONTENT_TYPE]?.startsWith(te.CONSTANTS.MIME_CE)||e[te.CONSTANTS.HEADER_CONTENT_TYPE]?.startsWith(te.CONSTANTS.MIME_CE_BATCH)}i(Sa,"isKafkaEvent");function qh(t){let e=t[te.CONSTANTS.HEADER_CONTENT_TYPE];if(e){if(e.startsWith(te.CONSTANTS.MIME_CE_BATCH))return te.Mode.BATCH;if(e.startsWith(te.CONSTANTS.MIME_CE))return te.Mode.STRUCTURED}return te.Mode.BINARY}i(qh,"getMode");function jh(t){let e={},r={...t.headers};e.datacontenttype=r[te.CONSTANTS.HEADER_CONTENT_TYPE];for(let n in Qt.KAFKA_CE_HEADERS){let s=Qt.KAFKA_CE_HEADERS[n];r[s]&&(e[Qt.HEADER_MAP[s]]=r[s],s===Qt.KAFKA_CE_HEADERS.TIME&&(e.time=new Date(e.time).toISOString()),delete r[s])}for(let n in r)n.startsWith("ce_")&&(e[n.replace("ce_","")]=r[n]);return new te.CloudEvent({...e,data:Qh(t),partitionkey:t.key},!1)}i(jh,"parseBinary");function Fh(t){if(!t.headers[te.CONSTANTS.HEADER_CONTENT_TYPE]?.startsWith(te.CONSTANTS.MIME_CE_JSON))throw new te.ValidationError(`Unsupported event encoding ${t.headers[te.CONSTANTS.HEADER_CONTENT_TYPE]}`);let e=JSON.parse(t.value);return e.time=new Date(e.time).toISOString(),new te.CloudEvent({...e,partitionkey:t.key},!1)}i(Fh,"parseStructured");function Hh(t){if(!t.headers[te.CONSTANTS.HEADER_CONTENT_TYPE]?.startsWith(te.CONSTANTS.MIME_CE_BATCH))throw new te.ValidationError(`Unsupported event encoding ${t.headers[te.CONSTANTS.HEADER_CONTENT_TYPE]}`);return JSON.parse(t.value).map(r=>new te.CloudEvent({...r,partitionkey:t.key},!1))}i(Hh,"parseBatched");function Qh(t){let e=t.value,r=t.headers[te.CONSTANTS.HEADER_CONTENT_TYPE];return r&&r.startsWith(te.CONSTANTS.MIME_JSON)&&(typeof t.value=="string"?e=JSON.parse(t.value):typeof t.value=="object"&&Buffer.isBuffer(t.value)&&(e=JSON.parse(t.value.toString()))),e}i(Qh,"extractBinaryData");function _a(t){return t?`${Date.parse(t)}`:void 0}i(_a,"timestamp")});var Na=se(zt=>{"use strict";d();f();c();Object.defineProperty(zt,"__esModule",{value:!0});zt.MQTTMessageFactory=zt.MQTT=void 0;var kt=Bt(),kh=Pt(),zh={binary:Vh,structured:Kh,toEvent:Yh,isEvent:wa};zt.MQTT=zh;function Vh(t){let e={...t},r=e.data;return!r&&e.data_base64&&(r=(0,kh.base64AsBinary)(e.data_base64)),delete e.data,delete e.data_base64,wi(t.datacontenttype,e,r)}i(Vh,"binary");function Kh(t){let e;return t instanceof kt.CloudEvent?e=t.toJSON():e=t,wi(kt.CONSTANTS.DEFAULT_CE_CONTENT_TYPE,{},e)}i(Kh,"structured");function wi(t,e,r){return{PUBLISH:{"Content Type":t},body:r,get payload(){return this.body},headers:e,get"User Properties"(){return this.headers}}}i(wi,"MQTTMessageFactory");zt.MQTTMessageFactory=wi;function Yh(t,e=!1){if(e&&!wa(t))throw new kt.ValidationError("No CloudEvent detected");if(Ca(t)){let r=typeof t.body=="string"?JSON.parse(t.body):t.body;return new kt.CloudEvent({...r},!1)}else return new kt.CloudEvent({...t.headers,data:t.body},!1)}i(Yh,"toEvent");function wa(t){return Jh(t)||Ca(t)}i(wa,"isEvent");function Jh(t){return!!t.headers.id&&!!t.headers.source&&!!t.headers.type&&!!t.headers.specversion}i(Jh,"isBinaryMessage");function Ca(t){return t&&t.PUBLISH&&t?.PUBLISH["Content Type"]?.startsWith(kt.CONSTANTS.MIME_CE_JSON)||!1}i(Ca,"isStructuredMessage")});var Ni=se(Ze=>{"use strict";d();f();c();var Gh=Ze&&Ze.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:i(function(){return e[r]},"get")}),Object.defineProperty(t,n,s)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Ci=Ze&&Ze.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Gh(e,t,r)};Object.defineProperty(Ze,"__esModule",{value:!0});Ze.Mode=void 0;Ci(ga(),Ze);Ci(ba(),Ze);Ci(Na(),Ze);var Wh;(function(t){t.BINARY="binary",t.STRUCTURED="structured",t.BATCH="batch"})(Wh=Ze.Mode||(Ze.Mode={}))});import Xh from"events";var va=se((gS,Aa)=>{d();f();c();Aa.exports=Xh});var xa=se(Vt=>{"use strict";d();f();c();Object.defineProperty(Vt,"__esModule",{value:!0});Vt.Emitter=Vt.emitterFor=void 0;var nn=Ni(),Zh=va(),Oa={binding:nn.HTTP,mode:nn.Mode.BINARY};function em(t,e=Oa){if(!t)throw new TypeError("A TransportFunction is required");let{binding:r,mode:n}={...Oa,...e};return i(function(o,a){switch(a=a||{},n){case nn.Mode.BINARY:return t(r.binary(o),a);case nn.Mode.STRUCTURED:return t(r.structured(o),a);default:throw new TypeError(`Unexpected transport mode: ${n}`)}},"emit")}i(em,"emitterFor");Vt.emitterFor=em;var sn=class t{static{i(this,"Emitter")}static getInstance(){return t.instance||(t.instance=new Zh.EventEmitter),t.instance}static on(e,r){t.getInstance().on(e,r)}static async emitEvent(e,r=!0){r?await Promise.all(t.getInstance().listeners("cloudevent").map(async n=>n(e))):t.getInstance().emit("cloudevent",e)}};Vt.Emitter=sn;sn.instance=void 0});import{Socket as tm}from"node:net";import{Readable as rm}from"node:stream";function Ra(t){let e={};for(let[r,n]of Object.entries(t))r&&(e[r]=(Array.isArray(n)?n:[n]).filter(Boolean));return e}var on,Ai=Z(()=>{d();f();c();Rt();on=class extends rm{static{i(this,"IncomingMessage")}__unenv__={};aborted=!1;httpVersion="1.1";httpVersionMajor=1;httpVersionMinor=1;complete=!0;connection;socket;headers={};trailers={};method="GET";url="/";statusCode=200;statusMessage="";closed=!1;errored=null;readable=!1;constructor(e){super(),this.socket=this.connection=e||new tm}get rawHeaders(){return Vs(this.headers)}get rawTrailers(){return[]}setTimeout(e,r){return this}get headersDistinct(){return Ra(this.headers)}get trailersDistinct(){return Ra(this.trailers)}_read(){}};i(Ra,"_distinct")});import{Writable as nm}from"node:stream";var an,vi=Z(()=>{d();f();c();an=class extends nm{static{i(this,"ServerResponse")}__unenv__=!0;statusCode=200;statusMessage="";upgrading=!1;chunkedEncoding=!1;shouldKeepAlive=!1;useChunkedEncodingByDefault=!1;sendDate=!1;finished=!1;headersSent=!1;strictContentLength=!1;connection=null;socket=null;req;_headers={};constructor(e){super(),this.req=e}assignSocket(e){e._httpMessage=this,this.socket=e,this.connection=e,this.emit("socket",e),this._flush()}_flush(){this.flushHeaders()}detachSocket(e){}writeContinue(e){}writeHead(e,r,n){e&&(this.statusCode=e),typeof r=="string"&&(this.statusMessage=r,r=void 0);let s=n||r;if(s&&!Array.isArray(s))for(let o in s)this.setHeader(o,s[o]);return this.headersSent=!0,this}writeProcessing(){}setTimeout(e,r){return this}appendHeader(e,r){e=e.toLowerCase();let n=this._headers[e],s=[...Array.isArray(n)?n:[n],...Array.isArray(r)?r:[r]].filter(Boolean);return this._headers[e]=s.length>1?s:s[0],this}setHeader(e,r){return this._headers[e.toLowerCase()]=Array.isArray(r)?[...r]:r,this}setHeaders(e){for(let[r,n]of e.entries())this.setHeader(r,n);return this}getHeader(e){return this._headers[e.toLowerCase()]}getHeaders(){return this._headers}getHeaderNames(){return Object.keys(this._headers)}hasHeader(e){return e.toLowerCase()in this._headers}removeHeader(e){delete this._headers[e.toLowerCase()]}addTrailers(e){}flushHeaders(){}writeEarlyHints(e,r){typeof r=="function"&&r()}}});import{EventEmitter as im}from"node:events";var Dt,Oi=Z(()=>{d();f();c();Dt=class extends im{static{i(this,"Agent")}__unenv__={};maxFreeSockets=256;maxSockets=1/0;maxTotalSockets=1/0;freeSockets={};sockets={};requests={};options;constructor(e={}){super(),this.options=e}destroy(){}}});var Ia,Pa,Ba,Da=Z(()=>{d();f();c();Ia=["ACL","BIND","CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LINK","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCALENDAR","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PRI","PROPFIND","PROPPATCH","PURGE","PUT","REBIND","REPORT","SEARCH","SOURCE","SUBSCRIBE","TRACE","UNBIND","UNLINK","UNLOCK","UNSUBSCRIBE"],Pa={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a Teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"},Ba=16384});var sm,om,am,um,lm,cm,fm,dm,hm,mm,pm,gm,ym,Em,La,Ma=Z(()=>{d();f();c();Rt();Ai();vi();Oi();Da();Ai();vi();sm=we("http.createServer"),om=we("http.request"),am=we("http.get"),um=rt("http.Server"),lm=rt("http.OutgoingMessage"),cm=rt("http.ClientRequest"),fm=new Dt,dm=we("http.validateHeaderName"),hm=we("http.validateHeaderValue"),mm=we("http.setMaxIdleHTTPParsers"),pm=we("http._connectionListener"),gm=globalThis.WebSocket||rt("WebSocket"),ym=globalThis.CloseEvent||rt("CloseEvent"),Em=globalThis.MessageEvent||rt("MessageEvent"),La={METHODS:Ia,STATUS_CODES:Pa,maxHeaderSize:Ba,IncomingMessage:on,ServerResponse:an,WebSocket:gm,CloseEvent:ym,MessageEvent:Em,createServer:sm,request:om,get:am,Server:um,OutgoingMessage:lm,ClientRequest:cm,Agent:Dt,globalAgent:fm,validateHeaderName:dm,validateHeaderValue:hm,setMaxIdleHTTPParsers:mm,_connectionListener:pm}});var $a=se((a_,Ua)=>{d();f();c();Ma();Ua.exports=La});var Tm,qa,Sm,_m,bm,wm,ja,Fa=Z(()=>{d();f();c();Rt();Oi();Tm=rt("https.Server"),qa=Dt,Sm=new qa,_m=we("https.get"),bm=we("https.createServer"),wm=we("https.request"),ja={Server:Tm,Agent:qa,globalAgent:Sm,get:_m,createServer:bm,request:wm}});var Qa=se((E_,Ha)=>{d();f();c();Fa();Ha.exports=ja});var za=se(Kt=>{"use strict";d();f();c();var ka=Kt&&Kt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Kt,"__esModule",{value:!0});Kt.httpTransport=void 0;var Cm=ka($a()),Nm=ka(Qa());function Am(t){let e=new URL(t),r;if(e.protocol==="https:")r=Nm.default;else if(e.protocol==="http:")r=Cm.default;else throw new TypeError(`unsupported protocol ${e.protocol}`);return function(n,s){return new Promise((o,a)=>{s={...s};let u={method:"POST",headers:{...n.headers,...s.headers}};try{let m={body:"",headers:{}},E=r.request(e,u,g=>{g.setEncoding("utf-8"),m.headers=g.headers,g.on("data",x=>m.body+=x),g.on("end",()=>{o(m)})});E.on("error",a),E.write(n.body),E.end()}catch(m){a(m)}})}}i(Am,"httpTransport");Kt.httpTransport=Am});var Bt=se(ae=>{"use strict";d();f();c();var vm=ae&&ae.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ae,"__esModule",{value:!0});ae.CONSTANTS=ae.Emitter=ae.httpTransport=ae.emitterFor=ae.MQTTMessageFactory=ae.MQTT=ae.Kafka=ae.HTTP=ae.Mode=ae.ValidationError=ae.V03=ae.V1=ae.CloudEvent=void 0;var xi=Yr();Object.defineProperty(ae,"CloudEvent",{enumerable:!0,get:i(function(){return xi.CloudEvent},"get")});Object.defineProperty(ae,"V1",{enumerable:!0,get:i(function(){return xi.V1},"get")});Object.defineProperty(ae,"V03",{enumerable:!0,get:i(function(){return xi.V03},"get")});var Om=Pt();Object.defineProperty(ae,"ValidationError",{enumerable:!0,get:i(function(){return Om.ValidationError},"get")});var Va=xa();Object.defineProperty(ae,"emitterFor",{enumerable:!0,get:i(function(){return Va.emitterFor},"get")});Object.defineProperty(ae,"Emitter",{enumerable:!0,get:i(function(){return Va.Emitter},"get")});var xm=za();Object.defineProperty(ae,"httpTransport",{enumerable:!0,get:i(function(){return xm.httpTransport},"get")});var yr=Ni();Object.defineProperty(ae,"Mode",{enumerable:!0,get:i(function(){return yr.Mode},"get")});Object.defineProperty(ae,"HTTP",{enumerable:!0,get:i(function(){return yr.HTTP},"get")});Object.defineProperty(ae,"Kafka",{enumerable:!0,get:i(function(){return yr.Kafka},"get")});Object.defineProperty(ae,"MQTT",{enumerable:!0,get:i(function(){return yr.MQTT},"get")});Object.defineProperty(ae,"MQTTMessageFactory",{enumerable:!0,get:i(function(){return yr.MQTTMessageFactory},"get")});var Rm=vm(Xr());ae.CONSTANTS=Rm.default});var pl=se(X=>{"use strict";d();f();c();Object.defineProperty(X,"__esModule",{value:!0});X.toBig=X.shrSL=X.shrSH=X.rotrSL=X.rotrSH=X.rotrBL=X.rotrBH=X.rotr32L=X.rotr32H=X.rotlSL=X.rotlSH=X.rotlBL=X.rotlBH=X.add5L=X.add5H=X.add4L=X.add4H=X.add3L=X.add3H=void 0;X.add=ul;X.fromBig=Ds;X.split=Yu;var qn=BigInt(2**32-1),Bs=BigInt(32);function Ds(t,e=!1){return e?{h:Number(t&qn),l:Number(t>>Bs&qn)}:{h:Number(t>>Bs&qn)|0,l:Number(t&qn)|0}}i(Ds,"fromBig");function Yu(t,e=!1){let r=t.length,n=new Uint32Array(r),s=new Uint32Array(r);for(let o=0;o<r;o++){let{h:a,l:u}=Ds(t[o],e);[n[o],s[o]]=[a,u]}return[n,s]}i(Yu,"split");var Ju=i((t,e)=>BigInt(t>>>0)<<Bs|BigInt(e>>>0),"toBig");X.toBig=Ju;var Gu=i((t,e,r)=>t>>>r,"shrSH");X.shrSH=Gu;var Wu=i((t,e,r)=>t<<32-r|e>>>r,"shrSL");X.shrSL=Wu;var Xu=i((t,e,r)=>t>>>r|e<<32-r,"rotrSH");X.rotrSH=Xu;var Zu=i((t,e,r)=>t<<32-r|e>>>r,"rotrSL");X.rotrSL=Zu;var el=i((t,e,r)=>t<<64-r|e>>>r-32,"rotrBH");X.rotrBH=el;var tl=i((t,e,r)=>t>>>r-32|e<<64-r,"rotrBL");X.rotrBL=tl;var rl=i((t,e)=>e,"rotr32H");X.rotr32H=rl;var nl=i((t,e)=>t,"rotr32L");X.rotr32L=nl;var il=i((t,e,r)=>t<<r|e>>>32-r,"rotlSH");X.rotlSH=il;var sl=i((t,e,r)=>e<<r|t>>>32-r,"rotlSL");X.rotlSL=sl;var ol=i((t,e,r)=>e<<r-32|t>>>64-r,"rotlBH");X.rotlBH=ol;var al=i((t,e,r)=>t<<r-32|e>>>64-r,"rotlBL");X.rotlBL=al;function ul(t,e,r,n){let s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}i(ul,"add");var ll=i((t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),"add3L");X.add3L=ll;var cl=i((t,e,r,n)=>e+r+n+(t/2**32|0)|0,"add3H");X.add3H=cl;var fl=i((t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),"add4L");X.add4L=fl;var dl=i((t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,"add4H");X.add4H=dl;var hl=i((t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),"add5L");X.add5L=hl;var ml=i((t,e,r,n,s,o)=>e+r+n+s+o+(t/2**32|0)|0,"add5H");X.add5H=ml;var zm={fromBig:Ds,split:Yu,toBig:Ju,shrSH:Gu,shrSL:Wu,rotrSH:Xu,rotrSL:Zu,rotrBH:el,rotrBL:tl,rotr32H:rl,rotr32L:nl,rotlSH:il,rotlSL:sl,rotlBH:ol,rotlBL:al,add:ul,add3L:ll,add3H:cl,add4L:fl,add4H:dl,add5H:ml,add5L:hl};X.default=zm});var gl=se(jn=>{"use strict";d();f();c();Object.defineProperty(jn,"__esModule",{value:!0});jn.crypto=void 0;jn.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0});var Cl=se(J=>{"use strict";d();f();c();Object.defineProperty(J,"__esModule",{value:!0});J.wrapXOFConstructorWithOpts=J.wrapConstructorWithOpts=J.wrapConstructor=J.Hash=J.nextTick=J.swap32IfBE=J.byteSwapIfBE=J.swap8IfBE=J.isLE=void 0;J.isBytes=El;J.anumber=Ls;J.abytes=tr;J.ahash=Vm;J.aexists=Km;J.aoutput=Ym;J.u8=Jm;J.u32=Gm;J.clean=Wm;J.createView=Xm;J.rotr=Zm;J.rotl=ep;J.byteSwap=Us;J.byteSwap32=Tl;J.bytesToHex=rp;J.hexToBytes=np;J.asyncLoop=sp;J.utf8ToBytes=$s;J.bytesToUtf8=op;J.toBytes=Fn;J.kdfInputToBytes=ap;J.concatBytes=up;J.checkOpts=lp;J.createHasher=_l;J.createOptHasher=bl;J.createXOFer=wl;J.randomBytes=cp;var er=gl();function El(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}i(El,"isBytes");function Ls(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}i(Ls,"anumber");function tr(t,...e){if(!El(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}i(tr,"abytes");function Vm(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Ls(t.outputLen),Ls(t.blockLen)}i(Vm,"ahash");function Km(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}i(Km,"aexists");function Ym(t,e){tr(t);let r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}i(Ym,"aoutput");function Jm(t){return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}i(Jm,"u8");function Gm(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}i(Gm,"u32");function Wm(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}i(Wm,"clean");function Xm(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}i(Xm,"createView");function Zm(t,e){return t<<32-e|t>>>e}i(Zm,"rotr");function ep(t,e){return t<<e|t>>>32-e>>>0}i(ep,"rotl");J.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Us(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}i(Us,"byteSwap");J.swap8IfBE=J.isLE?t=>t:t=>Us(t);J.byteSwapIfBE=J.swap8IfBE;function Tl(t){for(let e=0;e<t.length;e++)t[e]=Us(t[e]);return t}i(Tl,"byteSwap32");J.swap32IfBE=J.isLE?t=>t:Tl;var Sl=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",tp=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function rp(t){if(tr(t),Sl)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=tp[t[r]];return e}i(rp,"bytesToHex");var dt={_0:48,_9:57,A:65,F:70,a:97,f:102};function yl(t){if(t>=dt._0&&t<=dt._9)return t-dt._0;if(t>=dt.A&&t<=dt.F)return t-(dt.A-10);if(t>=dt.a&&t<=dt.f)return t-(dt.a-10)}i(yl,"asciiToBase16");function np(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Sl)return Uint8Array.fromHex(t);let e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(r);for(let s=0,o=0;s<r;s++,o+=2){let a=yl(t.charCodeAt(o)),u=yl(t.charCodeAt(o+1));if(a===void 0||u===void 0){let m=t[o]+t[o+1];throw new Error('hex string expected, got non-hex character "'+m+'" at index '+o)}n[s]=a*16+u}return n}i(np,"hexToBytes");var ip=i(async()=>{},"nextTick");J.nextTick=ip;async function sp(t,e,r){let n=Date.now();for(let s=0;s<t;s++){r(s);let o=Date.now()-n;o>=0&&o<e||(await(0,J.nextTick)(),n+=o)}}i(sp,"asyncLoop");function $s(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}i($s,"utf8ToBytes");function op(t){return new TextDecoder().decode(t)}i(op,"bytesToUtf8");function Fn(t){return typeof t=="string"&&(t=$s(t)),tr(t),t}i(Fn,"toBytes");function ap(t){return typeof t=="string"&&(t=$s(t)),tr(t),t}i(ap,"kdfInputToBytes");function up(...t){let e=0;for(let n=0;n<t.length;n++){let s=t[n];tr(s),e+=s.length}let r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){let o=t[n];r.set(o,s),s+=o.length}return r}i(up,"concatBytes");function lp(t,e){if(e!==void 0&&{}.toString.call(e)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(t,e)}i(lp,"checkOpts");var Ms=class{static{i(this,"Hash")}};J.Hash=Ms;function _l(t){let e=i(n=>t().update(Fn(n)).digest(),"hashC"),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}i(_l,"createHasher");function bl(t){let e=i((n,s)=>t(s).update(Fn(n)).digest(),"hashC"),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}i(bl,"createOptHasher");function wl(t){let e=i((n,s)=>t(s).update(Fn(n)).digest(),"hashC"),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}i(wl,"createXOFer");J.wrapConstructor=_l;J.wrapConstructorWithOpts=bl;J.wrapXOFConstructorWithOpts=wl;function cp(t=32){if(er.crypto&&typeof er.crypto.getRandomValues=="function")return er.crypto.getRandomValues(new Uint8Array(t));if(er.crypto&&typeof er.crypto.randomBytes=="function")return Uint8Array.from(er.crypto.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}i(cp,"randomBytes")});var Bl=se(ge=>{"use strict";d();f();c();Object.defineProperty(ge,"__esModule",{value:!0});ge.shake256=ge.shake128=ge.keccak_512=ge.keccak_384=ge.keccak_256=ge.keccak_224=ge.sha3_512=ge.sha3_384=ge.sha3_256=ge.sha3_224=ge.Keccak=void 0;ge.keccakP=Il;var Dr=pl(),He=Cl(),fp=BigInt(0),Br=BigInt(1),dp=BigInt(2),hp=BigInt(7),mp=BigInt(256),pp=BigInt(113),vl=[],Ol=[],xl=[];for(let t=0,e=Br,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],vl.push(2*(5*n+r)),Ol.push((t+1)*(t+2)/2%64);let s=fp;for(let o=0;o<7;o++)e=(e<<Br^(e>>hp)*pp)%mp,e&dp&&(s^=Br<<(Br<<BigInt(o))-Br);xl.push(s)}var Rl=(0,Dr.split)(xl,!0),gp=Rl[0],yp=Rl[1],Nl=i((t,e,r)=>r>32?(0,Dr.rotlBH)(t,e,r):(0,Dr.rotlSH)(t,e,r),"rotlH"),Al=i((t,e,r)=>r>32?(0,Dr.rotlBL)(t,e,r):(0,Dr.rotlSL)(t,e,r),"rotlL");function Il(t,e=24){let r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let a=0;a<10;a++)r[a]=t[a]^t[a+10]^t[a+20]^t[a+30]^t[a+40];for(let a=0;a<10;a+=2){let u=(a+8)%10,m=(a+2)%10,E=r[m],g=r[m+1],x=Nl(E,g,1)^r[u],P=Al(E,g,1)^r[u+1];for(let Y=0;Y<50;Y+=10)t[a+Y]^=x,t[a+Y+1]^=P}let s=t[2],o=t[3];for(let a=0;a<24;a++){let u=Ol[a],m=Nl(s,o,u),E=Al(s,o,u),g=vl[a];s=t[g],o=t[g+1],t[g]=m,t[g+1]=E}for(let a=0;a<50;a+=10){for(let u=0;u<10;u++)r[u]=t[a+u];for(let u=0;u<10;u++)t[a+u]^=~r[(u+2)%10]&r[(u+4)%10]}t[0]^=gp[n],t[1]^=yp[n]}(0,He.clean)(r)}i(Il,"keccakP");var Lr=class t extends He.Hash{static{i(this,"Keccak")}constructor(e,r,n,s=!1,o=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=s,this.rounds=o,(0,He.anumber)(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=(0,He.u32)(this.state)}clone(){return this._cloneInto()}keccak(){(0,He.swap32IfBE)(this.state32),Il(this.state32,this.rounds),(0,He.swap32IfBE)(this.state32),this.posOut=0,this.pos=0}update(e){(0,He.aexists)(this),e=(0,He.toBytes)(e),(0,He.abytes)(e);let{blockLen:r,state:n}=this,s=e.length;for(let o=0;o<s;){let a=Math.min(r-this.pos,s-o);for(let u=0;u<a;u++)n[this.pos++]^=e[o++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:r,pos:n,blockLen:s}=this;e[n]^=r,(r&128)!==0&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){(0,He.aexists)(this,!1),(0,He.abytes)(e),this.finish();let r=this.state,{blockLen:n}=this;for(let s=0,o=e.length;s<o;){this.posOut>=n&&this.keccak();let a=Math.min(n-this.posOut,o-s);e.set(r.subarray(this.posOut,this.posOut+a),s),this.posOut+=a,s+=a}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return(0,He.anumber)(e),this.xofInto(new Uint8Array(e))}digestInto(e){if((0,He.aoutput)(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,(0,He.clean)(this.state)}_cloneInto(e){let{blockLen:r,suffix:n,outputLen:s,rounds:o,enableXOF:a}=this;return e||(e=new t(r,n,s,a,o)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=o,e.suffix=n,e.outputLen=s,e.enableXOF=a,e.destroyed=this.destroyed,e}};ge.Keccak=Lr;var At=i((t,e,r)=>(0,He.createHasher)(()=>new Lr(e,t,r)),"gen");ge.sha3_224=At(6,144,224/8);ge.sha3_256=At(6,136,256/8);ge.sha3_384=At(6,104,384/8);ge.sha3_512=At(6,72,512/8);ge.keccak_224=At(1,144,224/8);ge.keccak_256=At(1,136,256/8);ge.keccak_384=At(1,104,384/8);ge.keccak_512=At(1,72,512/8);var Pl=i((t,e,r)=>(0,He.createXOFer)((n={})=>new Lr(e,t,n.dkLen===void 0?r:n.dkLen,!0)),"genShake");ge.shake128=Pl(31,168,128/8);ge.shake256=Pl(31,136,256/8)});var Fl=se((Ix,vt)=>{d();f();c();var{sha3_512:Ep}=Bl(),Ll=24,Mr=32,qs=i((t=4,e=Math.random)=>{let r="";for(;r.length<t;)r=r+Math.floor(e()*36).toString(36);return r},"createEntropy");function Ml(t){let e=8n,r=0n;for(let n of t.values()){let s=BigInt(n);r=(r<<e)+s}return r}i(Ml,"bufToBigInt");var Ul=i((t="")=>Ml(Ep(t)).toString(36).slice(1),"hash"),Dl=Array.from({length:26},(t,e)=>String.fromCharCode(e+97)),Tp=i(t=>Dl[Math.floor(t()*Dl.length)],"randomLetter"),$l=i(({globalObj:t=typeof global<"u"?global:typeof window<"u"?window:{},random:e=Math.random}={})=>{let r=Object.keys(t).toString(),n=r.length?r+qs(Mr,e):qs(Mr,e);return Ul(n).substring(0,Mr)},"createFingerprint"),ql=i(t=>()=>t++,"createCounter"),Sp=476782367,jl=i(({random:t=Math.random,counter:e=ql(Math.floor(t()*Sp)),length:r=Ll,fingerprint:n=$l({random:t})}={})=>i(function(){let o=Tp(t),a=Date.now().toString(36),u=e().toString(36),m=qs(r,t),E=`${a+m+u+n}`;return`${o+Ul(E).substring(1,r)}`},"cuid2"),"init"),_p=jl(),bp=i((t,{minLength:e=2,maxLength:r=Mr}={})=>{let n=t.length,s=/^[0-9a-z]+$/;try{if(typeof t=="string"&&n>=e&&n<=r&&s.test(t))return!0}finally{}return!1},"isCuid");vt.exports.getConstants=()=>({defaultLength:Ll,bigLength:Mr});vt.exports.init=jl;vt.exports.createId=_p;vt.exports.bufToBigInt=Ml;vt.exports.createCounter=ql;vt.exports.createFingerprint=$l;vt.exports.isCuid=bp});var Hl=se((Mx,Ur)=>{d();f();c();var{createId:wp,init:Cp,getConstants:Np,isCuid:Ap}=Fl();Ur.exports.createId=wp;Ur.exports.init=Cp;Ur.exports.getConstants=Np;Ur.exports.isCuid=Ap});d();f();c();d();f();c();var kl=zs(Bt(),1);import{WorkerEntrypoint as vp}from"cloudflare:workers";d();f();c();d();f();c();var w=Symbol.for("drizzle:entityKind"),P_=Symbol.for("drizzle:hasOwnEntityKind");function R(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,w))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(w in r&&r[w]===e[w])return!0;r=Object.getPrototypeOf(r)}return!1}i(R,"is");d();f();c();var Ri=class{static{i(this,"ConsoleLogWriter")}static[w]="ConsoleLogWriter";write(e){console.log(e)}},un=class{static{i(this,"DefaultLogger")}static[w]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Ri}logQuery(e,r){let n=r.map(o=>{try{return JSON.stringify(o)}catch{return String(o)}}),s=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${s}`)}},ln=class{static{i(this,"NoopLogger")}static[w]="NoopLogger";logQuery(){}};d();f();c();d();f();c();d();f();c();var je=Symbol.for("drizzle:Name");var cn=Symbol.for("drizzle:Schema"),fn=Symbol.for("drizzle:Columns"),Ka=Symbol.for("drizzle:ExtraConfigColumns"),Ii=Symbol.for("drizzle:OriginalName"),Pi=Symbol.for("drizzle:BaseName"),dn=Symbol.for("drizzle:IsAlias"),Ya=Symbol.for("drizzle:ExtraConfigBuilder"),Im=Symbol.for("drizzle:IsDrizzleTable"),U=class{static{i(this,"Table")}static[w]="Table";static Symbol={Name:je,Schema:cn,OriginalName:Ii,Columns:fn,ExtraConfigColumns:Ka,BaseName:Pi,IsAlias:dn,ExtraConfigBuilder:Ya};[je];[Ii];[cn];[fn];[Ka];[Pi];[dn]=!1;[Im]=!0;[Ya]=void 0;constructor(e,r,n){this[je]=this[Ii]=e,this[cn]=r,this[Pi]=n}};function bt(t){return t[je]}i(bt,"getTableName");function Lt(t){return`${t[cn]??"public"}.${t[je]}`}i(Lt,"getTableUniqueName");d();f();c();var oe=class{static{i(this,"Column")}constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[w]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};d();f();c();d();f();c();d();f();c();d();f();c();d();f();c();d();f();c();d();f();c();var Yt=class{static{i(this,"ColumnBuilder")}static[w]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};d();f();c();var hn=class{static{i(this,"ForeignKeyBuilder")}static[w]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:s,foreignColumns:o}=e();return{name:n,columns:s,foreignTable:o[0].table,foreignColumns:o}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Bi(e,this)}},Bi=class{static{i(this,"ForeignKey")}constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[w]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),s=r.map(u=>u.name),o=n.map(u=>u.name),a=[this.table[je],...s,n[0].table[je],...o];return e??`${a.join("_")}_fk`}};d();f();c();function mn(t,...e){return t(...e)}i(mn,"iife");d();f();c();function Mi(t,e){return`${t[je]}_${e.join("_")}_unique`}i(Mi,"uniqueKeyName");var Di=class{static{i(this,"UniqueConstraintBuilder")}constructor(e,r){this.name=r,this.columns=e}static[w]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Li(e,this.columns,this.nullsNotDistinctConfig,this.name)}},Ja=class{static{i(this,"UniqueOnConstraintBuilder")}static[w]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Di(e,this.name)}},Li=class{static{i(this,"UniqueConstraint")}constructor(e,r,n,s){this.table=e,this.columns=r,this.name=s??Mi(this.table,this.columns.map(o=>o.name)),this.nullsNotDistinct=n}static[w]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};d();f();c();function Ga(t,e,r){for(let n=e;n<t.length;n++){let s=t[n];if(s==="\\"){n++;continue}if(s==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(s===","||s==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}i(Ga,"parsePgArrayValue");function Wa(t,e=0){let r=[],n=e,s=!1;for(;n<t.length;){let o=t[n];if(o===","){(s||n===e)&&r.push(""),s=!0,n++;continue}if(s=!1,o==="\\"){n+=2;continue}if(o==='"'){let[m,E]=Ga(t,n+1,!0);r.push(m),n=E;continue}if(o==="}")return[r,n+1];if(o==="{"){let[m,E]=Wa(t,n+1);r.push(m),n=E;continue}let[a,u]=Ga(t,n,!1);r.push(a),n=u}return[r,n]}i(Wa,"parsePgNestedArray");function Xa(t){let[e]=Wa(t,1);return e}i(Xa,"parsePgArray");function Ui(t){return`{${t.map(e=>Array.isArray(e)?Ui(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}i(Ui,"makePgArray");var Er=class extends Yt{static{i(this,"PgColumnBuilder")}foreignKeyConfigs=[];static[w]="PgColumnBuilder";array(e){return new qi(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:s})=>mn((o,a)=>{let u=new hn(()=>{let m=o();return{columns:[e],foreignColumns:[m]}});return a.onUpdate&&u.onUpdate(a.onUpdate),a.onDelete&&u.onDelete(a.onDelete),u.build(r)},n,s))}buildExtraConfigColumn(e){return new $i(e,this.config)}},Jt=class extends oe{static{i(this,"PgColumn")}constructor(e,r){r.uniqueName||(r.uniqueName=Mi(e,[r.name])),super(e,r),this.table=e}static[w]="PgColumn"},$i=class extends Jt{static{i(this,"ExtraConfigColumn")}static[w]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Za=class{static{i(this,"IndexedColumn")}static[w]="IndexedColumn";constructor(e,r,n,s){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=s}name;keyAsName;type;indexConfig},qi=class extends Er{static{i(this,"PgArrayBuilder")}static[w]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new ji(e,this.config,r)}},ji=class t extends Jt{static{i(this,"PgArray")}constructor(e,r,n,s){super(e,r),this.baseColumn=n,this.range=s,this.size=r.size}size;static[w]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=Xa(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(s=>s===null?null:R(this.baseColumn,t)?this.baseColumn.mapToDriverValue(s,!0):this.baseColumn.mapToDriverValue(s));return r?n:Ui(n)}};var eu=Symbol.for("drizzle:isPgEnum");function ru(t){return!!t&&typeof t=="function"&&eu in t&&t[eu]===!0}i(ru,"isPgEnum");var tu=class extends Er{static{i(this,"PgEnumColumnBuilder")}static[w]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new Fi(e,this.config)}},Fi=class extends Jt{static{i(this,"PgEnumColumn")}static[w]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};d();f();c();var Oe=class{static{i(this,"Subquery")}static[w]="Subquery";constructor(e,r,n,s=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:s}}},Gt=class extends Oe{static{i(this,"WithSubquery")}static[w]="WithSubquery"};d();f();c();d();f();c();var nu="0.38.4";var Hi,Qi,iu={startActiveSpan(t,e){return Hi?(Qi||(Qi=Hi.trace.getTracer("drizzle-orm",nu)),mn((r,n)=>n.startActiveSpan(t,s=>{try{return e(s)}catch(o){throw s.setStatus({code:r.SpanStatusCode.ERROR,message:o instanceof Error?o.message:"Unknown error"}),o}finally{s.end()}}),Hi,Qi)):e()}};d();f();c();var be=Symbol.for("drizzle:ViewBaseConfig");var su=class{static{i(this,"FakePrimitiveParam")}static[w]="FakePrimitiveParam"};function ki(t){return t!=null&&typeof t.getSQL=="function"}i(ki,"isSQLWrapper");function Pm(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}i(Pm,"mergeQueries");var Ne=class{static{i(this,"StringChunk")}static[w]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new H([this])}},H=class t{static{i(this,"SQL")}constructor(e){this.queryChunks=e}static[w]="SQL";decoder=au;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return iu.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:s,escapeName:o,escapeParam:a,prepareTyping:u,inlineParams:m,paramStartIndex:E}=n;return Pm(e.map(g=>{if(R(g,Ne))return{sql:g.value.join(""),params:[]};if(R(g,Tr))return{sql:o(g.value),params:[]};if(g===void 0)return{sql:"",params:[]};if(Array.isArray(g)){let x=[new Ne("(")];for(let[P,Y]of g.entries())x.push(Y),P<g.length-1&&x.push(new Ne(", "));return x.push(new Ne(")")),this.buildQueryFromSourceParams(x,n)}if(R(g,t))return this.buildQueryFromSourceParams(g.queryChunks,{...n,inlineParams:m||g.shouldInlineParams});if(R(g,U)){let x=g[U.Symbol.Schema],P=g[U.Symbol.Name];return{sql:x===void 0?o(P):o(x)+"."+o(P),params:[]}}if(R(g,oe)){let x=s.getColumnCasing(g);if(r.invokeSource==="indexes")return{sql:o(x),params:[]};let P=g.table[U.Symbol.Schema];return{sql:g.table[dn]||P===void 0?o(g.table[U.Symbol.Name])+"."+o(x):o(P)+"."+o(g.table[U.Symbol.Name])+"."+o(x),params:[]}}if(R(g,Ye)){let x=g[be].schema,P=g[be].name;return{sql:x===void 0?o(P):o(x)+"."+o(P),params:[]}}if(R(g,ke)){if(R(g.value,ct))return{sql:a(E.value++,g),params:[g],typings:["none"]};let x=g.value===null?null:g.encoder.mapToDriverValue(g.value);if(R(x,t))return this.buildQueryFromSourceParams([x],n);if(m)return{sql:this.mapInlineParam(x,n),params:[]};let P=["none"];return u&&(P=[u(g.encoder)]),{sql:a(E.value++,x),params:[x],typings:P}}return R(g,ct)?{sql:a(E.value++,g),params:[g],typings:["none"]}:R(g,t.Aliased)&&g.fieldAlias!==void 0?{sql:o(g.fieldAlias),params:[]}:R(g,Oe)?g._.isWith?{sql:o(g._.alias),params:[]}:this.buildQueryFromSourceParams([new Ne("("),g._.sql,new Ne(") "),new Tr(g._.alias)],n):ru(g)?g.schema?{sql:o(g.schema)+"."+o(g.enumName),params:[]}:{sql:o(g.enumName),params:[]}:ki(g)?g.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([g.getSQL()],n):this.buildQueryFromSourceParams([new Ne("("),g.getSQL(),new Ne(")")],n):m?{sql:this.mapInlineParam(g,n),params:[]}:{sql:a(E.value++,g),params:[g],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},Tr=class{static{i(this,"Name")}constructor(e){this.value=e}static[w]="Name";brand;getSQL(){return new H([this])}};function ou(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}i(ou,"isDriverValueEncoder");var au={mapFromDriverValue:i(t=>t,"mapFromDriverValue")},uu={mapToDriverValue:i(t=>t,"mapToDriverValue")},xb={...au,...uu},ke=class{static{i(this,"Param")}constructor(e,r=uu){this.value=e,this.encoder=r}static[w]="Param";brand;getSQL(){return new H([this])}};function T(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Ne(t[0]));for(let[n,s]of e.entries())r.push(s,new Ne(t[n+1]));return new H(r)}i(T,"sql");(t=>{function e(){return new H([])}i(e,"empty"),t.empty=e;function r(m){return new H(m)}i(r,"fromList"),t.fromList=r;function n(m){return new H([new Ne(m)])}i(n,"raw"),t.raw=n;function s(m,E){let g=[];for(let[x,P]of m.entries())x>0&&E!==void 0&&g.push(E),g.push(P);return new H(g)}i(s,"join"),t.join=s;function o(m){return new Tr(m)}i(o,"identifier"),t.identifier=o;function a(m){return new ct(m)}i(a,"placeholder2"),t.placeholder=a;function u(m,E){return new ke(m,E)}i(u,"param2"),t.param=u})(T||(T={}));(t=>{class e{static{i(this,"Aliased")}constructor(n,s){this.sql=n,this.fieldAlias=s}static[w]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(H||(H={}));var ct=class{static{i(this,"Placeholder")}constructor(e){this.name=e}static[w]="Placeholder";getSQL(){return new H([this])}};function Sr(t,e){return t.map(r=>{if(R(r,ct)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(R(r,ke)&&R(r.value,ct)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}i(Sr,"fillPlaceholders");var Bm=Symbol.for("drizzle:IsDrizzleView"),Ye=class{static{i(this,"View")}static[w]="View";[be];[Bm]=!0;constructor({name:e,schema:r,selectedFields:n,query:s}){this[be]={name:e,originalName:e,schema:r,selectedFields:n,query:s,isExisting:!s,isAlias:!1}}getSQL(){return new H([this])}};oe.prototype.getSQL=function(){return new H([this])};U.prototype.getSQL=function(){return new H([this])};Oe.prototype.getSQL=function(){return new H([this])};function pn(t,e,r){let n={},s=t.reduce((o,{path:a,field:u},m)=>{let E;R(u,oe)?E=u:R(u,H)?E=u.decoder:E=u.sql.decoder;let g=o;for(let[x,P]of a.entries())if(x<a.length-1)P in g||(g[P]={}),g=g[P];else{let Y=e[m],G=g[P]=Y===null?null:E.mapFromDriverValue(Y);if(r&&R(u,oe)&&a.length===2){let B=a[0];B in n?typeof n[B]=="string"&&n[B]!==bt(u.table)&&(n[B]=!1):n[B]=G===null?bt(u.table):!1}}return o},{});if(r&&Object.keys(n).length>0)for(let[o,a]of Object.entries(n))typeof a=="string"&&!r[a]&&(s[o]=null);return s}i(pn,"mapResultRow");function et(t,e){return Object.entries(t).reduce((r,[n,s])=>{if(typeof n!="string")return r;let o=e?[...e,n]:[n];return R(s,oe)||R(s,H)||R(s,H.Aliased)?r.push({path:o,field:s}):R(s,U)?r.push(...et(s[U.Symbol.Columns],o)):r.push(...et(s,o)),r},[])}i(et,"orderSelectedFields");function _r(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[s,o]of r.entries())if(o!==n[s])return!1;return!0}i(_r,"haveSameKeys");function gn(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,s])=>R(s,H)||R(s,oe)?[n,s]:[n,new ke(s,t[U.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}i(gn,"mapUpdateSet");function lu(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}i(lu,"applyMixins");function cu(t){return t[U.Symbol.Columns]}i(cu,"getTableColumns");function br(t){return R(t,Oe)?t._.alias:R(t,Ye)?t[be].name:R(t,H)?void 0:t[U.Symbol.IsAlias]?t[U.Symbol.Name]:t[U.Symbol.BaseName]}i(br,"getTableLikeName");function wt(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}i(wt,"getColumnNameAndConfig");var fu=Symbol.for("drizzle:PgInlineForeignKeys"),du=Symbol.for("drizzle:EnableRLS"),yn=class extends U{static{i(this,"PgTable")}static[w]="PgTable";static Symbol=Object.assign({},U.Symbol,{InlineForeignKeys:fu,EnableRLS:du});[fu]=[];[du]=!1;[U.Symbol.ExtraConfigBuilder]=void 0};var En=class{static{i(this,"PrimaryKeyBuilder")}static[w]="PgPrimaryKeyBuilder";columns;name;constructor(e,r){this.columns=e,this.name=r}build(e){return new zi(e,this.columns,this.name)}},zi=class{static{i(this,"PrimaryKey")}constructor(e,r,n){this.table=e,this.columns=r,this.name=n}static[w]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[yn.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};d();f();c();function ze(t,e){return ou(e)&&!ki(t)&&!R(t,ke)&&!R(t,ct)&&!R(t,oe)&&!R(t,U)&&!R(t,Ye)?new ke(t,e):t}i(ze,"bindIfParam");var Ve=i((t,e)=>T`${t} = ${ze(e,t)}`,"eq"),hu=i((t,e)=>T`${t} <> ${ze(e,t)}`,"ne");function ft(...t){let e=t.filter(r=>r!==void 0);if(e.length!==0)return e.length===1?new H(e):new H([new Ne("("),T.join(e,new Ne(" and ")),new Ne(")")])}i(ft,"and");function mu(...t){let e=t.filter(r=>r!==void 0);if(e.length!==0)return e.length===1?new H(e):new H([new Ne("("),T.join(e,new Ne(" or ")),new Ne(")")])}i(mu,"or");function pu(t){return T`not ${t}`}i(pu,"not");var gu=i((t,e)=>T`${t} > ${ze(e,t)}`,"gt"),yu=i((t,e)=>T`${t} >= ${ze(e,t)}`,"gte"),Eu=i((t,e)=>T`${t} < ${ze(e,t)}`,"lt"),Tu=i((t,e)=>T`${t} <= ${ze(e,t)}`,"lte");function Su(t,e){return Array.isArray(e)?e.length===0?T`false`:T`${t} in ${e.map(r=>ze(r,t))}`:T`${t} in ${ze(e,t)}`}i(Su,"inArray");function _u(t,e){return Array.isArray(e)?e.length===0?T`true`:T`${t} not in ${e.map(r=>ze(r,t))}`:T`${t} not in ${ze(e,t)}`}i(_u,"notInArray");function bu(t){return T`${t} is null`}i(bu,"isNull");function wu(t){return T`${t} is not null`}i(wu,"isNotNull");function Cu(t){return T`exists ${t}`}i(Cu,"exists");function Nu(t){return T`not exists ${t}`}i(Nu,"notExists");function Au(t,e,r){return T`${t} between ${ze(e,t)} and ${ze(r,t)}`}i(Au,"between");function vu(t,e,r){return T`${t} not between ${ze(e,t)} and ${ze(r,t)}`}i(vu,"notBetween");function Ou(t,e){return T`${t} like ${e}`}i(Ou,"like");function xu(t,e){return T`${t} not like ${e}`}i(xu,"notLike");function Ru(t,e){return T`${t} ilike ${e}`}i(Ru,"ilike");function Iu(t,e){return T`${t} not ilike ${e}`}i(Iu,"notIlike");d();f();c();function Pu(t){return T`${t} asc`}i(Pu,"asc");function Bu(t){return T`${t} desc`}i(Bu,"desc");var Tn=class{static{i(this,"Relation")}constructor(e,r,n){this.sourceTable=e,this.referencedTable=r,this.relationName=n,this.referencedTableName=r[U.Symbol.Name]}static[w]="Relation";referencedTableName;fieldName},Vi=class{static{i(this,"Relations")}constructor(e,r){this.table=e,this.config=r}static[w]="Relations"},Ct=class t extends Tn{static{i(this,"One")}constructor(e,r,n,s){super(e,r,n?.relationName),this.config=n,this.isNullable=s}static[w]="One";withFieldName(e){let r=new t(this.sourceTable,this.referencedTable,this.config,this.isNullable);return r.fieldName=e,r}},wr=class t extends Tn{static{i(this,"Many")}constructor(e,r,n){super(e,r,n?.relationName),this.config=n}static[w]="Many";withFieldName(e){let r=new t(this.sourceTable,this.referencedTable,this.config);return r.fieldName=e,r}};function Du(){return{and:ft,between:Au,eq:Ve,exists:Cu,gt:gu,gte:yu,ilike:Ru,inArray:Su,isNull:bu,isNotNull:wu,like:Ou,lt:Eu,lte:Tu,ne:hu,not:pu,notBetween:vu,notExists:Nu,notLike:xu,notIlike:Iu,notInArray:_u,or:mu,sql:T}}i(Du,"getOperators");function Lu(){return{sql:T,asc:Pu,desc:Bu}}i(Lu,"getOrderByOperators");function Mu(t,e){Object.keys(t).length===1&&"default"in t&&!R(t.default,U)&&(t=t.default);let r={},n={},s={};for(let[o,a]of Object.entries(t))if(R(a,U)){let u=Lt(a),m=n[u];r[u]=o,s[o]={tsName:o,dbName:a[U.Symbol.Name],schema:a[U.Symbol.Schema],columns:a[U.Symbol.Columns],relations:m?.relations??{},primaryKey:m?.primaryKey??[]};for(let g of Object.values(a[U.Symbol.Columns]))g.primary&&s[o].primaryKey.push(g);let E=a[U.Symbol.ExtraConfigBuilder]?.(a[U.Symbol.ExtraConfigColumns]);if(E)for(let g of Object.values(E))R(g,En)&&s[o].primaryKey.push(...g.columns)}else if(R(a,Vi)){let u=Lt(a.table),m=r[u],E=a.config(e(a.table)),g;for(let[x,P]of Object.entries(E))if(m){let Y=s[m];Y.relations[x]=P,g&&Y.primaryKey.push(...g)}else u in n||(n[u]={relations:{},primaryKey:g}),n[u].relations[x]=P}return{tables:s,tableNamesMap:r}}i(Mu,"extractTablesRelationalConfig");function Dm(t){return i(function(r,n){return new Ct(t,r,n,n?.fields.reduce((s,o)=>s&&o.notNull,!0)??!1)},"one")}i(Dm,"createOne");function Lm(t){return i(function(r,n){return new wr(t,r,n)},"many")}i(Lm,"createMany");function Uu(t,e,r){if(R(r,Ct)&&r.config)return{fields:r.config.fields,references:r.config.references};let n=e[Lt(r.referencedTable)];if(!n)throw new Error(`Table "${r.referencedTable[U.Symbol.Name]}" not found in schema`);let s=t[n];if(!s)throw new Error(`Table "${n}" not found in schema`);let o=r.sourceTable,a=e[Lt(o)];if(!a)throw new Error(`Table "${o[U.Symbol.Name]}" not found in schema`);let u=[];for(let m of Object.values(s.relations))(r.relationName&&r!==m&&m.relationName===r.relationName||!r.relationName&&m.referencedTable===r.sourceTable)&&u.push(m);if(u.length>1)throw r.relationName?new Error(`There are multiple relations with name "${r.relationName}" in table "${n}"`):new Error(`There are multiple relations between "${n}" and "${r.sourceTable[U.Symbol.Name]}". Please specify relation name`);if(u[0]&&R(u[0],Ct)&&u[0].config)return{fields:u[0].config.references,references:u[0].config.fields};throw new Error(`There is not enough information to infer relation "${a}.${r.fieldName}"`)}i(Uu,"normalizeRelation");function $u(t){return{one:Dm(t),many:Lm(t)}}i($u,"createTableRelationsHelpers");function Sn(t,e,r,n,s=o=>o){let o={};for(let[a,u]of n.entries())if(u.isJson){let m=e.relations[u.tsKey],E=r[a],g=typeof E=="string"?JSON.parse(E):E;o[u.tsKey]=R(m,Ct)?g&&Sn(t,t[u.relationTableTsKey],g,u.selection,s):g.map(x=>Sn(t,t[u.relationTableTsKey],x,u.selection,s))}else{let m=s(r[a]),E=u.field,g;R(E,oe)?g=E:R(E,H)?g=E.decoder:g=E.sql.decoder,o[u.tsKey]=m===null?null:g.mapFromDriverValue(m)}return o}i(Sn,"mapRelationalRow");d();f();c();d();f();c();d();f();c();var Mt=class{static{i(this,"ColumnAliasProxyHandler")}constructor(e){this.table=e}static[w]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},Wt=class{static{i(this,"TableAliasProxyHandler")}constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[w]="TableAliasProxyHandler";get(e,r){if(r===U.Symbol.IsAlias)return!0;if(r===U.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===U.Symbol.OriginalName)return this.alias;if(r===be)return{...e[be],name:this.alias,isAlias:!0};if(r===U.Symbol.Columns){let s=e[U.Symbol.Columns];if(!s)return s;let o={};return Object.keys(s).map(a=>{o[a]=new Proxy(s[a],new Mt(new Proxy(e,this)))}),o}let n=e[r];return R(n,oe)?new Proxy(n,new Mt(new Proxy(e,this))):n}},qu=class{static{i(this,"RelationTableAliasProxyHandler")}constructor(e){this.alias=e}static[w]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?Cr(e.sourceTable,this.alias):e[r]}};function Cr(t,e){return new Proxy(t,new Wt(e,!1))}i(Cr,"aliasedTable");function at(t,e){return new Proxy(t,new Mt(new Proxy(t.table,new Wt(e,!1))))}i(at,"aliasedTableColumn");function Ki(t,e){return new H.Aliased(Nr(t.sql,e),t.fieldAlias)}i(Ki,"mapColumnsInAliasedSQLToAlias");function Nr(t,e){return T.join(t.queryChunks.map(r=>R(r,oe)?at(r,e):R(r,H)?Nr(r,e):R(r,H.Aliased)?Ki(r,e):r))}i(Nr,"mapColumnsInSQLToAlias");var Ae=class t{static{i(this,"SelectionProxyHandler")}static[w]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(r===be)return{...e[be],selectedFields:new Proxy(e[be].selectedFields,this)};if(typeof r=="symbol")return e[r];let s=(R(e,Oe)?e._.selectedFields:R(e,Ye)?e[be].selectedFields:e)[r];if(R(s,H.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!s.isSelectionField)return s.sql;let o=s.clone();return o.isSelectionField=!0,o}if(R(s,H)){if(this.config.sqlBehavior==="sql")return s;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return R(s,oe)?this.config.alias?new Proxy(s,new Mt(new Proxy(s.table,new Wt(this.config.alias,this.config.replaceOriginalName??!1)))):s:typeof s!="object"||s===null?s:new Proxy(s,new t(this.config))}};d();f();c();d();f();c();var Fe=class{static{i(this,"QueryPromise")}static[w]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}then(e,r){return this.execute().then(e,r)}};d();f();c();d();f();c();d();f();c();d();f();c();d();f();c();var _n=class{static{i(this,"ForeignKeyBuilder")}static[w]="SQLiteForeignKeyBuilder";reference;_onUpdate;_onDelete;constructor(e,r){this.reference=()=>{let{name:n,columns:s,foreignColumns:o}=e();return{name:n,columns:s,foreignTable:o[0].table,foreignColumns:o}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e,this}onDelete(e){return this._onDelete=e,this}build(e){return new Yi(e,this)}},Yi=class{static{i(this,"ForeignKey")}constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[w]="SQLiteForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),s=r.map(u=>u.name),o=n.map(u=>u.name),a=[this.table[je],...s,n[0].table[je],...o];return e??`${a.join("_")}_fk`}};d();f();c();function Wi(t,e){return`${t[je]}_${e.join("_")}_unique`}i(Wi,"uniqueKeyName");var Ji=class{static{i(this,"UniqueConstraintBuilder")}constructor(e,r){this.name=r,this.columns=e}static[w]="SQLiteUniqueConstraintBuilder";columns;build(e){return new Gi(e,this.columns,this.name)}},ju=class{static{i(this,"UniqueOnConstraintBuilder")}static[w]="SQLiteUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Ji(e,this.name)}},Gi=class{static{i(this,"UniqueConstraint")}constructor(e,r,n){this.table=e,this.columns=r,this.name=n??Wi(this.table,this.columns.map(s=>s.name))}static[w]="SQLiteUniqueConstraint";columns;name;getName(){return this.name}};var Be=class extends Yt{static{i(this,"SQLiteColumnBuilder")}static[w]="SQLiteColumnBuilder";foreignKeyConfigs=[];references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e){return this.config.isUnique=!0,this.config.uniqueName=e,this}generatedAlwaysAs(e,r){return this.config.generated={as:e,type:"always",mode:r?.mode??"virtual"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:s})=>((o,a)=>{let u=new _n(()=>{let m=o();return{columns:[e],foreignColumns:[m]}});return a.onUpdate&&u.onUpdate(a.onUpdate),a.onDelete&&u.onDelete(a.onDelete),u.build(r)})(n,s))}},Ce=class extends oe{static{i(this,"SQLiteColumn")}constructor(e,r){r.uniqueName||(r.uniqueName=Wi(e,[r.name])),super(e,r),this.table=e}static[w]="SQLiteColumn"};var Xi=class extends Be{static{i(this,"SQLiteBigIntBuilder")}static[w]="SQLiteBigIntBuilder";constructor(e){super(e,"bigint","SQLiteBigInt")}build(e){return new Zi(e,this.config)}},Zi=class extends Ce{static{i(this,"SQLiteBigInt")}static[w]="SQLiteBigInt";getSQLType(){return"blob"}mapFromDriverValue(e){if(Buffer.isBuffer(e))return BigInt(e.toString());if(e instanceof ArrayBuffer){let r=new TextDecoder;return BigInt(r.decode(e))}return BigInt(String.fromCodePoint(...e))}mapToDriverValue(e){return Buffer.from(e.toString())}},es=class extends Be{static{i(this,"SQLiteBlobJsonBuilder")}static[w]="SQLiteBlobJsonBuilder";constructor(e){super(e,"json","SQLiteBlobJson")}build(e){return new ts(e,this.config)}},ts=class extends Ce{static{i(this,"SQLiteBlobJson")}static[w]="SQLiteBlobJson";getSQLType(){return"blob"}mapFromDriverValue(e){if(Buffer.isBuffer(e))return JSON.parse(e.toString());if(e instanceof ArrayBuffer){let r=new TextDecoder;return JSON.parse(r.decode(e))}return JSON.parse(String.fromCodePoint(...e))}mapToDriverValue(e){return Buffer.from(JSON.stringify(e))}},rs=class extends Be{static{i(this,"SQLiteBlobBufferBuilder")}static[w]="SQLiteBlobBufferBuilder";constructor(e){super(e,"buffer","SQLiteBlobBuffer")}build(e){return new ns(e,this.config)}},ns=class extends Ce{static{i(this,"SQLiteBlobBuffer")}static[w]="SQLiteBlobBuffer";getSQLType(){return"blob"}};function Fu(t,e){let{name:r,config:n}=wt(t,e);return n?.mode==="json"?new es(r):n?.mode==="bigint"?new Xi(r):new rs(r)}i(Fu,"blob");d();f();c();var is=class extends Be{static{i(this,"SQLiteCustomColumnBuilder")}static[w]="SQLiteCustomColumnBuilder";constructor(e,r,n){super(e,"custom","SQLiteCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new ss(e,this.config)}},ss=class extends Ce{static{i(this,"SQLiteCustomColumn")}static[w]="SQLiteCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function Hu(t){return(e,r)=>{let{name:n,config:s}=wt(e,r);return new is(n,s,t)}}i(Hu,"customType");d();f();c();var Ar=class extends Be{static{i(this,"SQLiteBaseIntegerBuilder")}static[w]="SQLiteBaseIntegerBuilder";constructor(e,r,n){super(e,r,n),this.config.autoIncrement=!1}primaryKey(e){return e?.autoIncrement&&(this.config.autoIncrement=!0),this.config.hasDefault=!0,super.primaryKey()}},vr=class extends Ce{static{i(this,"SQLiteBaseInteger")}static[w]="SQLiteBaseInteger";autoIncrement=this.config.autoIncrement;getSQLType(){return"integer"}},os=class extends Ar{static{i(this,"SQLiteIntegerBuilder")}static[w]="SQLiteIntegerBuilder";constructor(e){super(e,"number","SQLiteInteger")}build(e){return new as(e,this.config)}},as=class extends vr{static{i(this,"SQLiteInteger")}static[w]="SQLiteInteger"},us=class extends Ar{static{i(this,"SQLiteTimestampBuilder")}static[w]="SQLiteTimestampBuilder";constructor(e,r){super(e,"date","SQLiteTimestamp"),this.config.mode=r}defaultNow(){return this.default(T`(cast((julianday('now') - 2440587.5)*86400000 as integer))`)}build(e){return new ls(e,this.config)}},ls=class extends vr{static{i(this,"SQLiteTimestamp")}static[w]="SQLiteTimestamp";mode=this.config.mode;mapFromDriverValue(e){return this.config.mode==="timestamp"?new Date(e*1e3):new Date(e)}mapToDriverValue(e){let r=e.getTime();return this.config.mode==="timestamp"?Math.floor(r/1e3):r}},cs=class extends Ar{static{i(this,"SQLiteBooleanBuilder")}static[w]="SQLiteBooleanBuilder";constructor(e,r){super(e,"boolean","SQLiteBoolean"),this.config.mode=r}build(e){return new fs(e,this.config)}},fs=class extends vr{static{i(this,"SQLiteBoolean")}static[w]="SQLiteBoolean";mode=this.config.mode;mapFromDriverValue(e){return Number(e)===1}mapToDriverValue(e){return e?1:0}};function Or(t,e){let{name:r,config:n}=wt(t,e);return n?.mode==="timestamp"||n?.mode==="timestamp_ms"?new us(r,n.mode):n?.mode==="boolean"?new cs(r,n.mode):new os(r)}i(Or,"integer");d();f();c();var ds=class extends Be{static{i(this,"SQLiteNumericBuilder")}static[w]="SQLiteNumericBuilder";constructor(e){super(e,"string","SQLiteNumeric")}build(e){return new hs(e,this.config)}},hs=class extends Ce{static{i(this,"SQLiteNumeric")}static[w]="SQLiteNumeric";getSQLType(){return"numeric"}};function Qu(t){return new ds(t??"")}i(Qu,"numeric");d();f();c();var ms=class extends Be{static{i(this,"SQLiteRealBuilder")}static[w]="SQLiteRealBuilder";constructor(e){super(e,"number","SQLiteReal")}build(e){return new ps(e,this.config)}},ps=class extends Ce{static{i(this,"SQLiteReal")}static[w]="SQLiteReal";getSQLType(){return"real"}};function ku(t){return new ms(t??"")}i(ku,"real");d();f();c();var gs=class extends Be{static{i(this,"SQLiteTextBuilder")}static[w]="SQLiteTextBuilder";constructor(e,r){super(e,"string","SQLiteText"),this.config.enumValues=r.enum,this.config.length=r.length}build(e){return new ys(e,this.config)}},ys=class extends Ce{static{i(this,"SQLiteText")}static[w]="SQLiteText";enumValues=this.config.enumValues;length=this.config.length;constructor(e,r){super(e,r)}getSQLType(){return`text${this.config.length?`(${this.config.length})`:""}`}},Es=class extends Be{static{i(this,"SQLiteTextJsonBuilder")}static[w]="SQLiteTextJsonBuilder";constructor(e){super(e,"json","SQLiteTextJson")}build(e){return new Ts(e,this.config)}},Ts=class extends Ce{static{i(this,"SQLiteTextJson")}static[w]="SQLiteTextJson";getSQLType(){return"text"}mapFromDriverValue(e){return JSON.parse(e)}mapToDriverValue(e){return JSON.stringify(e)}};function it(t,e={}){let{name:r,config:n}=wt(t,e);return n.mode==="json"?new Es(r):new gs(r,n)}i(it,"text");function zu(){return{blob:Fu,customType:Hu,integer:Or,numeric:Qu,real:ku,text:it}}i(zu,"getSQLiteColumnBuilders");var Ss=Symbol.for("drizzle:SQLiteInlineForeignKeys"),xe=class extends U{static{i(this,"SQLiteTable")}static[w]="SQLiteTable";static Symbol=Object.assign({},U.Symbol,{InlineForeignKeys:Ss});[U.Symbol.Columns];[Ss]=[];[U.Symbol.ExtraConfigBuilder]=void 0};function Mm(t,e,r,n,s=t){let o=new xe(t,n,s),a=typeof e=="function"?e(zu()):e,u=Object.fromEntries(Object.entries(a).map(([E,g])=>{let x=g;x.setName(E);let P=x.build(o);return o[Ss].push(...x.buildForeignKeys(P,o)),[E,P]})),m=Object.assign(o,u);return m[U.Symbol.Columns]=u,m[U.Symbol.ExtraConfigColumns]=u,r&&(m[xe.Symbol.ExtraConfigBuilder]=r),m}i(Mm,"sqliteTableBase");var _s=i((t,e,r)=>Mm(t,e,r),"sqliteTable");var xr=class extends Fe{static{i(this,"SQLiteDeleteBase")}constructor(e,r,n,s){super(),this.table=e,this.session=r,this.dialect=n,this.config={table:e,withList:s}}static[w]="SQLiteDelete";config;where(e){return this.config.where=e,this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.table[U.Symbol.Columns],new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.orderBy=n}else{let r=e;this.config.orderBy=r}return this}limit(e){return this.config.limit=e,this}returning(e=this.table[xe.Symbol.Columns]){return this.config.returning=et(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0)}prepare(){return this._prepare(!1)}run=i(e=>this._prepare().run(e),"run");all=i(e=>this._prepare().all(e),"all");get=i(e=>this._prepare().get(e),"get");values=i(e=>this._prepare().values(e),"values");async execute(e){return this._prepare().execute(e)}$dynamic(){return this}};d();f();c();d();f();c();d();f();c();d();f();c();function Um(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(r=>r.toLowerCase()).join("_")}i(Um,"toSnakeCase");function $m(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((r,n,s)=>{let o=s===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return r+o},"")}i($m,"toCamelCase");function qm(t){return t}i(qm,"noopCase");var bn=class{static{i(this,"CasingCache")}static[w]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?Um:e==="camelCase"?$m:qm}getColumnCasing(e){if(!e.keyAsName)return e.name;let r=e.table[U.Symbol.Schema]??"public",n=e.table[U.Symbol.OriginalName],s=`${r}.${n}.${e.name}`;return this.cache[s]||this.cacheTable(e.table),this.cache[s]}cacheTable(e){let r=e[U.Symbol.Schema]??"public",n=e[U.Symbol.OriginalName],s=`${r}.${n}`;if(!this.cachedTables[s]){for(let o of Object.values(e[U.Symbol.Columns])){let a=`${s}.${o.name}`;this.cache[a]=this.convert(o.name)}this.cachedTables[s]=!0}}clearCache(){this.cache={},this.cachedTables={}}};d();f();c();var Ut=class extends Error{static{i(this,"DrizzleError")}static[w]="DrizzleError";constructor({message:e,cause:r}){super(e),this.name="DrizzleError",this.cause=r}},wn=class extends Ut{static{i(this,"TransactionRollbackError")}static[w]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};d();f();c();var Nt=class extends Ye{static{i(this,"SQLiteViewBase")}static[w]="SQLiteViewBase"};var $t=class{static{i(this,"SQLiteDialect")}static[w]="SQLiteDialect";casing;constructor(e){this.casing=new bn(e?.casing)}escapeName(e){return`"${e}"`}escapeParam(e){return"?"}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[T`with `];for(let[n,s]of e.entries())r.push(T`${T.identifier(s._.alias)} as (${s._.sql})`),n<e.length-1&&r.push(T`, `);return r.push(T` `),T.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:s,limit:o,orderBy:a}){let u=this.buildWithCTE(s),m=n?T` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,E=r?T` where ${r}`:void 0,g=this.buildOrderBy(a),x=this.buildLimit(o);return T`${u}delete from ${e}${E}${m}${g}${x}`}buildUpdateSet(e,r){let n=e[U.Symbol.Columns],s=Object.keys(n).filter(a=>r[a]!==void 0||n[a]?.onUpdateFn!==void 0),o=s.length;return T.join(s.flatMap((a,u)=>{let m=n[a],E=r[a]??T.param(m.onUpdateFn(),m),g=T`${T.identifier(this.casing.getColumnCasing(m))} = ${E}`;return u<o-1?[g,T.raw(", ")]:[g]}))}buildUpdateQuery({table:e,set:r,where:n,returning:s,withList:o,joins:a,from:u,limit:m,orderBy:E}){let g=this.buildWithCTE(o),x=this.buildUpdateSet(e,r),P=u&&T.join([T.raw(" from "),this.buildFromTable(u)]),Y=this.buildJoins(a),G=s?T` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,B=n?T` where ${n}`:void 0,q=this.buildOrderBy(E),D=this.buildLimit(m);return T`${g}update ${e} set ${x}${P}${Y}${B}${G}${q}${D}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,s=e.flatMap(({field:o},a)=>{let u=[];if(R(o,H.Aliased)&&o.isSelectionField)u.push(T.identifier(o.fieldAlias));else if(R(o,H.Aliased)||R(o,H)){let m=R(o,H.Aliased)?o.sql:o;r?u.push(new H(m.queryChunks.map(E=>R(E,oe)?T.identifier(this.casing.getColumnCasing(E)):E))):u.push(m),R(o,H.Aliased)&&u.push(T` as ${T.identifier(o.fieldAlias)}`)}else if(R(o,oe)){let m=o.table[U.Symbol.Name];r?u.push(T.identifier(this.casing.getColumnCasing(o))):u.push(T`${T.identifier(m)}.${T.identifier(this.casing.getColumnCasing(o))}`)}return a<n-1&&u.push(T`, `),u});return T.join(s)}buildJoins(e){if(!e||e.length===0)return;let r=[];if(e)for(let[n,s]of e.entries()){n===0&&r.push(T` `);let o=s.table;if(R(o,xe)){let a=o[xe.Symbol.Name],u=o[xe.Symbol.Schema],m=o[xe.Symbol.OriginalName],E=a===m?void 0:s.alias;r.push(T`${T.raw(s.joinType)} join ${u?T`${T.identifier(u)}.`:void 0}${T.identifier(m)}${E&&T` ${T.identifier(E)}`} on ${s.on}`)}else r.push(T`${T.raw(s.joinType)} join ${o} on ${s.on}`);n<e.length-1&&r.push(T` `)}return T.join(r)}buildLimit(e){return typeof e=="object"||typeof e=="number"&&e>=0?T` limit ${e}`:void 0}buildOrderBy(e){let r=[];if(e)for(let[n,s]of e.entries())r.push(s),n<e.length-1&&r.push(T`, `);return r.length>0?T` order by ${T.join(r)}`:void 0}buildFromTable(e){return R(e,U)&&e[U.Symbol.OriginalName]!==e[U.Symbol.Name]?T`${T.identifier(e[U.Symbol.OriginalName])} ${T.identifier(e[U.Symbol.Name])}`:e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:s,having:o,table:a,joins:u,orderBy:m,groupBy:E,limit:g,offset:x,distinct:P,setOperators:Y}){let G=n??et(r);for(let de of G)if(R(de.field,oe)&&bt(de.field.table)!==(R(a,Oe)?a._.alias:R(a,Nt)?a[be].name:R(a,H)?void 0:bt(a))&&!(Ee=>u?.some(({alias:Ge})=>Ge===(Ee[U.Symbol.IsAlias]?bt(Ee):Ee[U.Symbol.BaseName])))(de.field.table)){let Ee=bt(de.field.table);throw new Error(`Your "${de.path.join("->")}" field references a column "${Ee}"."${de.field.name}", but the table "${Ee}" is not part of the query! Did you forget to join it?`)}let B=!u||u.length===0,q=this.buildWithCTE(e),D=P?T` distinct`:void 0,ne=this.buildSelection(G,{isSingleTable:B}),ee=this.buildFromTable(a),W=this.buildJoins(u),Q=s?T` where ${s}`:void 0,j=o?T` having ${o}`:void 0,$=[];if(E)for(let[de,Ee]of E.entries())$.push(Ee),de<E.length-1&&$.push(T`, `);let K=$.length>0?T` group by ${T.join($)}`:void 0,M=this.buildOrderBy(m),ye=this.buildLimit(g),ce=x?T` offset ${x}`:void 0,ue=T`${q}select${D} ${ne} from ${ee}${W}${Q}${K}${j}${M}${ye}${ce}`;return Y.length>0?this.buildSetOperations(ue,Y):ue}buildSetOperations(e,r){let[n,...s]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return s.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),s)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:s,limit:o,orderBy:a,offset:u}}){let m=T`${e.getSQL()} `,E=T`${s.getSQL()}`,g;if(a&&a.length>0){let G=[];for(let B of a)if(R(B,Ce))G.push(T.identifier(B.name));else if(R(B,H)){for(let q=0;q<B.queryChunks.length;q++){let D=B.queryChunks[q];R(D,Ce)&&(B.queryChunks[q]=T.identifier(this.casing.getColumnCasing(D)))}G.push(T`${B}`)}else G.push(T`${B}`);g=T` order by ${T.join(G,T`, `)}`}let x=typeof o=="object"||typeof o=="number"&&o>=0?T` limit ${o}`:void 0,P=T.raw(`${r} ${n?"all ":""}`),Y=u?T` offset ${u}`:void 0;return T`${m}${P}${E}${g}${x}${Y}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:s,withList:o,select:a}){let u=[],m=e[U.Symbol.Columns],E=Object.entries(m).filter(([B,q])=>!q.shouldDisableInsert()),g=E.map(([,B])=>T.identifier(this.casing.getColumnCasing(B)));if(a){let B=r;R(B,H)?u.push(B):u.push(B.getSQL())}else{let B=r;u.push(T.raw("values "));for(let[q,D]of B.entries()){let ne=[];for(let[ee,W]of E){let Q=D[ee];if(Q===void 0||R(Q,ke)&&Q.value===void 0){let j;if(W.default!==null&&W.default!==void 0)j=R(W.default,H)?W.default:T.param(W.default,W);else if(W.defaultFn!==void 0){let $=W.defaultFn();j=R($,H)?$:T.param($,W)}else if(!W.default&&W.onUpdateFn!==void 0){let $=W.onUpdateFn();j=R($,H)?$:T.param($,W)}else j=T`null`;ne.push(j)}else ne.push(Q)}u.push(ne),q<B.length-1&&u.push(T`, `)}}let x=this.buildWithCTE(o),P=T.join(u),Y=s?T` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,G=n?T` on conflict ${n}`:void 0;return T`${x}insert into ${e} ${g} ${P}${G}${Y}`}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,invokeSource:r})}buildRelationalQuery({fullSchema:e,schema:r,tableNamesMap:n,table:s,tableConfig:o,queryConfig:a,tableAlias:u,nestedQueryRelation:m,joinOn:E}){let g=[],x,P,Y=[],G,B=[];if(a===!0)g=Object.entries(o.columns).map(([ne,ee])=>({dbKey:ee.name,tsKey:ne,field:at(ee,u),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let D=Object.fromEntries(Object.entries(o.columns).map(([$,K])=>[$,at(K,u)]));if(a.where){let $=typeof a.where=="function"?a.where(D,Du()):a.where;G=$&&Nr($,u)}let ne=[],ee=[];if(a.columns){let $=!1;for(let[K,M]of Object.entries(a.columns))M!==void 0&&K in o.columns&&(!$&&M===!0&&($=!0),ee.push(K));ee.length>0&&(ee=$?ee.filter(K=>a.columns?.[K]===!0):Object.keys(o.columns).filter(K=>!ee.includes(K)))}else ee=Object.keys(o.columns);for(let $ of ee){let K=o.columns[$];ne.push({tsKey:$,value:K})}let W=[];a.with&&(W=Object.entries(a.with).filter($=>!!$[1]).map(([$,K])=>({tsKey:$,queryConfig:K,relation:o.relations[$]})));let Q;if(a.extras){Q=typeof a.extras=="function"?a.extras(D,{sql:T}):a.extras;for(let[$,K]of Object.entries(Q))ne.push({tsKey:$,value:Ki(K,u)})}for(let{tsKey:$,value:K}of ne)g.push({dbKey:R(K,H.Aliased)?K.fieldAlias:o.columns[$].name,tsKey:$,field:R(K,oe)?at(K,u):K,relationTableTsKey:void 0,isJson:!1,selection:[]});let j=typeof a.orderBy=="function"?a.orderBy(D,Lu()):a.orderBy??[];Array.isArray(j)||(j=[j]),Y=j.map($=>R($,oe)?at($,u):Nr($,u)),x=a.limit,P=a.offset;for(let{tsKey:$,queryConfig:K,relation:M}of W){let ye=Uu(r,n,M),ce=Lt(M.referencedTable),ue=n[ce],de=`${u}_${$}`,Ee=ft(...ye.fields.map((ut,Ot)=>Ve(at(ye.references[Ot],de),at(ut,u)))),Ge=this.buildRelationalQuery({fullSchema:e,schema:r,tableNamesMap:n,table:e[ue],tableConfig:r[ue],queryConfig:R(M,Ct)?K===!0?{limit:1}:{...K,limit:1}:K,tableAlias:de,joinOn:Ee,nestedQueryRelation:M}),Ke=T`(${Ge.sql})`.as($);g.push({dbKey:$,tsKey:$,field:Ke,relationTableTsKey:ue,isJson:!0,selection:Ge.selection})}}if(g.length===0)throw new Ut({message:`No fields selected for table "${o.tsName}" ("${u}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});let q;if(G=ft(E,G),m){let D=T`json_array(${T.join(g.map(({field:W})=>R(W,Ce)?T.identifier(this.casing.getColumnCasing(W)):R(W,H.Aliased)?W.sql:W),T`, `)})`;R(m,wr)&&(D=T`coalesce(json_group_array(${D}), json_array())`);let ne=[{dbKey:"data",tsKey:"data",field:D.as("data"),isJson:!0,relationTableTsKey:o.tsName,selection:g}];x!==void 0||P!==void 0||Y.length>0?(q=this.buildSelectQuery({table:Cr(s,u),fields:{},fieldsFlat:[{path:[],field:T.raw("*")}],where:G,limit:x,offset:P,orderBy:Y,setOperators:[]}),G=void 0,x=void 0,P=void 0,Y=void 0):q=Cr(s,u),q=this.buildSelectQuery({table:R(q,xe)?q:new Oe(q,{},u),fields:{},fieldsFlat:ne.map(({field:W})=>({path:[],field:R(W,oe)?at(W,u):W})),joins:B,where:G,limit:x,offset:P,orderBy:Y,setOperators:[]})}else q=this.buildSelectQuery({table:Cr(s,u),fields:{},fieldsFlat:g.map(({field:D})=>({path:[],field:R(D,oe)?at(D,u):D})),joins:B,where:G,limit:x,offset:P,orderBy:Y,setOperators:[]});return{tableTsKey:o.tsName,sql:q,selection:g}}},Cn=class extends $t{static{i(this,"SQLiteSyncDialect")}static[w]="SQLiteSyncDialect";migrate(e,r,n){let s=n===void 0||typeof n=="string"?"__drizzle_migrations":n.migrationsTable??"__drizzle_migrations",o=T`
			CREATE TABLE IF NOT EXISTS ${T.identifier(s)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;r.run(o);let u=r.values(T`SELECT id, hash, created_at FROM ${T.identifier(s)} ORDER BY created_at DESC LIMIT 1`)[0]??void 0;r.run(T`BEGIN`);try{for(let m of e)if(!u||Number(u[2])<m.folderMillis){for(let E of m.sql)r.run(T.raw(E));r.run(T`INSERT INTO ${T.identifier(s)} ("hash", "created_at") VALUES(${m.hash}, ${m.folderMillis})`)}r.run(T`COMMIT`)}catch(m){throw r.run(T`ROLLBACK`),m}}},Nn=class extends $t{static{i(this,"SQLiteAsyncDialect")}static[w]="SQLiteAsyncDialect";async migrate(e,r,n){let s=n===void 0||typeof n=="string"?"__drizzle_migrations":n.migrationsTable??"__drizzle_migrations",o=T`
			CREATE TABLE IF NOT EXISTS ${T.identifier(s)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;await r.run(o);let u=(await r.values(T`SELECT id, hash, created_at FROM ${T.identifier(s)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0;await r.transaction(async m=>{for(let E of e)if(!u||Number(u[2])<E.folderMillis){for(let g of E.sql)await m.run(T.raw(g));await m.run(T`INSERT INTO ${T.identifier(s)} ("hash", "created_at") VALUES(${E.hash}, ${E.folderMillis})`)}})}};d();f();c();d();f();c();var An=class{static{i(this,"TypedQueryBuilder")}static[w]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var tt=class{static{i(this,"SQLiteSelectBuilder")}static[w]="SQLiteSelectBuilder";fields;session;dialect;withList;distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,this.withList=e.withList,this.distinct=e.distinct}from(e){let r=!!this.fields,n;return this.fields?n=this.fields:R(e,Oe)?n=Object.fromEntries(Object.keys(e._.selectedFields).map(s=>[s,e[s]])):R(e,Nt)?n=e[be].selectedFields:R(e,H)?n={}:n=cu(e),new vn({table:e,fields:n,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}},bs=class extends An{static{i(this,"SQLiteSelectQueryBuilderBase")}static[w]="SQLiteSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:s,dialect:o,withList:a,distinct:u}){super(),this.config={withList:a,table:e,fields:{...r},distinct:u,setOperators:[]},this.isPartialSelect=n,this.session=s,this.dialect=o,this._={selectedFields:r},this.tableName=br(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let s=this.tableName,o=br(r);if(typeof o=="string"&&this.config.joins?.some(a=>a.alias===o))throw new Error(`Alias "${o}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof s=="string"&&(this.config.fields={[s]:this.config.fields}),typeof o=="string"&&!R(r,H))){let a=R(r,Oe)?r._.selectedFields:R(r,Ye)?r[be].selectedFields:r[U.Symbol.Columns];this.config.fields[o]=a}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:o}),typeof o=="string")switch(e){case"left":{this.joinsNotNullableMap[o]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[o]=!0;break}case"inner":{this.joinsNotNullableMap[o]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[o]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let s=typeof n=="function"?n(jm()):n;if(!_r(this.getSelectedFields(),s.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:s}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);except=this.createSetOperator("except",!1);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new Oe(this.getSQL(),this.config.fields,e),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Ae({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},vn=class extends bs{static{i(this,"SQLiteSelectBase")}static[w]="SQLiteSelect";_prepare(e=!0){if(!this.session)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");let r=et(this.config.fields),n=this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),r,"all",!0);return n.joinsNotNullableMap=this.joinsNotNullableMap,n}prepare(){return this._prepare(!1)}run=i(e=>this._prepare().run(e),"run");all=i(e=>this._prepare().all(e),"all");get=i(e=>this._prepare().get(e),"get");values=i(e=>this._prepare().values(e),"values");async execute(){return this.all()}};lu(vn,[Fe]);function On(t,e){return(r,n,...s)=>{let o=[n,...s].map(a=>({type:t,isAll:e,rightSelect:a}));for(let a of o)if(!_r(r.getSelectedFields(),a.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(o)}}i(On,"createSetOperator");var jm=i(()=>({union:Fm,unionAll:Hm,intersect:Qm,except:km}),"getSQLiteSetOperators"),Fm=On("union",!1),Hm=On("union",!0),Qm=On("intersect",!1),km=On("except",!1);var Xt=class{static{i(this,"QueryBuilder")}static[w]="SQLiteQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=R(e,$t)?e:void 0,this.dialectConfig=R(e,$t)?void 0:e}$with(e){let r=this;return{as(n){return typeof n=="function"&&(n=n(r)),new Proxy(new Gt(n.getSQL(),n.getSelectedFields(),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}}with(...e){let r=this;function n(o){return new tt({fields:o??void 0,session:void 0,dialect:r.getDialect(),withList:e})}i(n,"select");function s(o){return new tt({fields:o??void 0,session:void 0,dialect:r.getDialect(),withList:e,distinct:!0})}return i(s,"selectDistinct"),{select:n,selectDistinct:s}}select(e){return new tt({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new tt({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){return this.dialect||(this.dialect=new Cn(this.dialectConfig)),this.dialect}};var Rr=class{static{i(this,"SQLiteInsertBuilder")}constructor(e,r,n,s){this.table=e,this.session=r,this.dialect=n,this.withList=s}static[w]="SQLiteInsertBuilder";values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let s={},o=this.table[U.Symbol.Columns];for(let a of Object.keys(n)){let u=n[a];s[a]=R(u,H)?u:new ke(u,o[a])}return s});return new xn(this.table,r,this.session,this.dialect,this.withList)}select(e){let r=typeof e=="function"?e(new Xt):e;if(!R(r,H)&&!_r(this.table[fn],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new xn(this.table,r,this.session,this.dialect,this.withList,!0)}},xn=class extends Fe{static{i(this,"SQLiteInsertBase")}constructor(e,r,n,s,o,a){super(),this.session=n,this.dialect=s,this.config={table:e,values:r,withList:o,select:a}}static[w]="SQLiteInsert";config;returning(e=this.config.table[xe.Symbol.Columns]){return this.config.returning=et(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=T`do nothing`;else{let r=Array.isArray(e.target)?T`${e.target}`:T`${[e.target]}`,n=e.where?T` where ${e.where}`:T``;this.config.onConflict=T`${r} do nothing${n}`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?T` where ${e.where}`:void 0,n=e.targetWhere?T` where ${e.targetWhere}`:void 0,s=e.setWhere?T` where ${e.setWhere}`:void 0,o=Array.isArray(e.target)?T`${e.target}`:T`${[e.target]}`,a=this.dialect.buildUpdateSet(this.config.table,gn(this.config.table,e.set));return this.config.onConflict=T`${o}${n} do update set ${a}${r}${s}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0)}prepare(){return this._prepare(!1)}run=i(e=>this._prepare().run(e),"run");all=i(e=>this._prepare().all(e),"all");get=i(e=>this._prepare().get(e),"get");values=i(e=>this._prepare().values(e),"values");async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}};d();f();c();var Ir=class{static{i(this,"SQLiteUpdateBuilder")}constructor(e,r,n,s){this.table=e,this.session=r,this.dialect=n,this.withList=s}static[w]="SQLiteUpdateBuilder";set(e){return new ws(this.table,gn(this.table,e),this.session,this.dialect,this.withList)}},ws=class extends Fe{static{i(this,"SQLiteUpdateBase")}constructor(e,r,n,s,o){super(),this.session=n,this.dialect=s,this.config={set:r,table:e,withList:o,joins:[]}}static[w]="SQLiteUpdate";config;from(e){return this.config.from=e,this}createJoin(e){return(r,n)=>{let s=br(r);if(typeof s=="string"&&this.config.joins.some(o=>o.alias===s))throw new Error(`Alias "${s}" is already used in this query`);if(typeof n=="function"){let o=this.config.from?R(r,xe)?r[U.Symbol.Columns]:R(r,Oe)?r._.selectedFields:R(r,Nt)?r[be].selectedFields:void 0:void 0;n=n(new Proxy(this.config.table[U.Symbol.Columns],new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),o&&new Proxy(o,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}return this.config.joins.push({on:n,table:r,joinType:e,alias:s}),this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.table[U.Symbol.Columns],new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.orderBy=n}else{let r=e;this.config.orderBy=r}return this}limit(e){return this.config.limit=e,this}returning(e=this.config.table[xe.Symbol.Columns]){return this.config.returning=et(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0)}prepare(){return this._prepare(!1)}run=i(e=>this._prepare().run(e),"run");all=i(e=>this._prepare().all(e),"all");get=i(e=>this._prepare().get(e),"get");values=i(e=>this._prepare().values(e),"values");async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}};d();f();c();var Rn=class t extends H{static{i(this,"SQLiteCountBuilder")}constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;static[w]="SQLiteCountBuilderAsync";[Symbol.toStringTag]="SQLiteCountBuilderAsync";session;static buildEmbeddedCount(e,r){return T`(select count(*) from ${e}${T.raw(" where ").if(r)}${r})`}static buildCount(e,r){return T`select count(*) from ${e}${T.raw(" where ").if(r)}${r}`}then(e,r){return Promise.resolve(this.session.count(this.sql)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};d();f();c();var In=class{static{i(this,"RelationalQueryBuilder")}constructor(e,r,n,s,o,a,u,m){this.mode=e,this.fullSchema=r,this.schema=n,this.tableNamesMap=s,this.table=o,this.tableConfig=a,this.dialect=u,this.session=m}static[w]="SQLiteAsyncRelationalQueryBuilder";findMany(e){return this.mode==="sync"?new Pn(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many"):new Pr(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return this.mode==="sync"?new Pn(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first"):new Pr(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Pr=class extends Fe{static{i(this,"SQLiteRelationalQuery")}constructor(e,r,n,s,o,a,u,m,E){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=s,this.tableConfig=o,this.dialect=a,this.session=u,this.config=m,this.mode=E}static[w]="SQLiteAsyncRelationalQuery";mode;getSQL(){return this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}).sql}_prepare(e=!1){let{query:r,builtQuery:n}=this._toSQL();return this.session[e?"prepareOneTimeQuery":"prepareQuery"](n,void 0,this.mode==="first"?"get":"all",!0,(s,o)=>{let a=s.map(u=>Sn(this.schema,this.tableConfig,u,r.selection,o));return this.mode==="first"?a[0]:a})}prepare(){return this._prepare(!1)}_toSQL(){let e=this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}executeRaw(){return this.mode==="first"?this._prepare(!1).get():this._prepare(!1).all()}async execute(){return this.executeRaw()}},Pn=class extends Pr{static{i(this,"SQLiteSyncRelationalQuery")}static[w]="SQLiteSyncRelationalQuery";sync(){return this.executeRaw()}};d();f();c();var qt=class extends Fe{static{i(this,"SQLiteRaw")}constructor(e,r,n,s,o){super(),this.execute=e,this.getSQL=r,this.dialect=s,this.mapBatchResult=o,this.config={action:n}}static[w]="SQLiteRaw";config;getQuery(){return{...this.dialect.sqlToQuery(this.getSQL()),method:this.config.action}}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Zt=class{static{i(this,"BaseSQLiteDatabase")}constructor(e,r,n,s){this.resultKind=e,this.dialect=r,this.session=n,this._=s?{schema:s.schema,fullSchema:s.fullSchema,tableNamesMap:s.tableNamesMap}:{schema:void 0,fullSchema:{},tableNamesMap:{}},this.query={};let o=this.query;if(this._.schema)for(let[a,u]of Object.entries(this._.schema))o[a]=new In(e,s.fullSchema,this._.schema,this._.tableNamesMap,s.fullSchema[a],u,r,n)}static[w]="BaseSQLiteDatabase";query;$with(e){let r=this;return{as(n){return typeof n=="function"&&(n=n(new Xt(r.dialect))),new Proxy(new Gt(n.getSQL(),n.getSelectedFields(),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}}$count(e,r){return new Rn({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(m){return new tt({fields:m??void 0,session:r.session,dialect:r.dialect,withList:e})}i(n,"select");function s(m){return new tt({fields:m??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}i(s,"selectDistinct");function o(m){return new Ir(m,r.session,r.dialect,e)}i(o,"update");function a(m){return new Rr(m,r.session,r.dialect,e)}i(a,"insert");function u(m){return new xr(m,r.session,r.dialect,e)}return i(u,"delete_"),{select:n,selectDistinct:s,update:o,insert:a,delete:u}}select(e){return new tt({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new tt({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(e){return new Ir(e,this.session,this.dialect)}insert(e){return new Rr(e,this.session,this.dialect)}delete(e){return new xr(e,this.session,this.dialect)}run(e){let r=typeof e=="string"?T.raw(e):e.getSQL();return this.resultKind==="async"?new qt(async()=>this.session.run(r),()=>r,"run",this.dialect,this.session.extractRawRunValueFromBatchResult.bind(this.session)):this.session.run(r)}all(e){let r=typeof e=="string"?T.raw(e):e.getSQL();return this.resultKind==="async"?new qt(async()=>this.session.all(r),()=>r,"all",this.dialect,this.session.extractRawAllValueFromBatchResult.bind(this.session)):this.session.all(r)}get(e){let r=typeof e=="string"?T.raw(e):e.getSQL();return this.resultKind==="async"?new qt(async()=>this.session.get(r),()=>r,"get",this.dialect,this.session.extractRawGetValueFromBatchResult.bind(this.session)):this.session.get(r)}values(e){let r=typeof e=="string"?T.raw(e):e.getSQL();return this.resultKind==="async"?new qt(async()=>this.session.values(r),()=>r,"values",this.dialect,this.session.extractRawValuesValueFromBatchResult.bind(this.session)):this.session.values(r)}transaction(e,r){return this.session.transaction(e,r)}};d();f();c();d();f();c();var Cs=class{static{i(this,"IndexBuilderOn")}constructor(e,r){this.name=e,this.unique=r}static[w]="SQLiteIndexBuilderOn";on(...e){return new Ns(this.name,e,this.unique)}},Ns=class{static{i(this,"IndexBuilder")}static[w]="SQLiteIndexBuilder";config;constructor(e,r,n){this.config={name:e,columns:r,unique:n,where:void 0}}where(e){return this.config.where=e,this}build(e){return new As(this.config,e)}},As=class{static{i(this,"Index")}static[w]="SQLiteIndex";config;constructor(e,r){this.config={...e,table:r}}};function Bn(t){return new Cs(t,!1)}i(Bn,"index");d();f();c();function Vu(...t){return t[0].columns?new Dn(t[0].columns,t[0].name):new Dn(t)}i(Vu,"primaryKey");var Dn=class{static{i(this,"PrimaryKeyBuilder")}static[w]="SQLitePrimaryKeyBuilder";columns;name;constructor(e,r){this.columns=e,this.name=r}build(e){return new vs(e,this.columns,this.name)}},vs=class{static{i(this,"PrimaryKey")}constructor(e,r,n){this.table=e,this.columns=r,this.name=n}static[w]="SQLitePrimaryKey";columns;name;getName(){return this.name??`${this.table[xe.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};d();f();c();var Os=class extends Fe{static{i(this,"ExecuteResultSync")}constructor(e){super(),this.resultCb=e}static[w]="ExecuteResultSync";async execute(){return this.resultCb()}sync(){return this.resultCb()}},Ln=class{static{i(this,"SQLitePreparedQuery")}constructor(e,r,n){this.mode=e,this.executeMethod=r,this.query=n}static[w]="PreparedQuery";joinsNotNullableMap;getQuery(){return this.query}mapRunResult(e,r){return e}mapAllResult(e,r){throw new Error("Not implemented")}mapGetResult(e,r){throw new Error("Not implemented")}execute(e){return this.mode==="async"?this[this.executeMethod](e):new Os(()=>this[this.executeMethod](e))}mapResult(e,r){switch(this.executeMethod){case"run":return this.mapRunResult(e,r);case"all":return this.mapAllResult(e,r);case"get":return this.mapGetResult(e,r)}}},Mn=class{static{i(this,"SQLiteSession")}constructor(e){this.dialect=e}static[w]="SQLiteSession";prepareOneTimeQuery(e,r,n,s){return this.prepareQuery(e,r,n,s)}run(e){let r=this.dialect.sqlToQuery(e);try{return this.prepareOneTimeQuery(r,void 0,"run",!1).run()}catch(n){throw new Ut({cause:n,message:`Failed to run the query '${r.sql}'`})}}extractRawRunValueFromBatchResult(e){return e}all(e){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(e),void 0,"run",!1).all()}extractRawAllValueFromBatchResult(e){throw new Error("Not implemented")}get(e){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(e),void 0,"run",!1).get()}extractRawGetValueFromBatchResult(e){throw new Error("Not implemented")}values(e){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(e),void 0,"run",!1).values()}async count(e){return(await this.values(e))[0][0]}extractRawValuesValueFromBatchResult(e){throw new Error("Not implemented")}},Un=class extends Zt{static{i(this,"SQLiteTransaction")}constructor(e,r,n,s,o=0){super(e,r,n,s),this.schema=s,this.nestedIndex=o}static[w]="SQLiteTransaction";rollback(){throw new wn}};var $n=class extends Mn{static{i(this,"SQLiteD1Session")}constructor(e,r,n,s={}){super(r),this.client=e,this.schema=n,this.options=s,this.logger=s.logger??new ln}static[w]="SQLiteD1Session";logger;prepareQuery(e,r,n,s,o){let a=this.client.prepare(e.sql);return new Is(a,e,this.logger,r,n,s,o)}async batch(e){let r=[],n=[];for(let o of e){let a=o._prepare(),u=a.getQuery();if(r.push(a),u.params.length>0)n.push(a.stmt.bind(...u.params));else{let m=a.getQuery();n.push(this.client.prepare(m.sql).bind(...m.params))}}return(await this.client.batch(n)).map((o,a)=>r[a].mapResult(o,!0))}extractRawAllValueFromBatchResult(e){return e.results}extractRawGetValueFromBatchResult(e){return e.results[0]}extractRawValuesValueFromBatchResult(e){return Rs(e.results)}async transaction(e,r){let n=new xs("async",this.dialect,this,this.schema);await this.run(T.raw(`begin${r?.behavior?" "+r.behavior:""}`));try{let s=await e(n);return await this.run(T`commit`),s}catch(s){throw await this.run(T`rollback`),s}}},xs=class t extends Un{static{i(this,"D1Transaction")}static[w]="D1Transaction";async transaction(e){let r=`sp${this.nestedIndex}`,n=new t("async",this.dialect,this.session,this.schema,this.nestedIndex+1);await this.session.run(T.raw(`savepoint ${r}`));try{let s=await e(n);return await this.session.run(T.raw(`release savepoint ${r}`)),s}catch(s){throw await this.session.run(T.raw(`rollback to savepoint ${r}`)),s}}};function Rs(t){let e=[];for(let r of t){let n=Object.keys(r).map(s=>r[s]);e.push(n)}return e}i(Rs,"d1ToRawMapping");var Is=class extends Ln{static{i(this,"D1PreparedQuery")}constructor(e,r,n,s,o,a,u){super("async",o,r),this.logger=n,this._isResponseInArrayMode=a,this.customResultMapper=u,this.fields=s,this.stmt=e}static[w]="D1PreparedQuery";customResultMapper;fields;stmt;run(e){let r=Sr(this.query.params,e??{});return this.logger.logQuery(this.query.sql,r),this.stmt.bind(...r).run()}async all(e){let{fields:r,query:n,logger:s,stmt:o,customResultMapper:a}=this;if(!r&&!a){let m=Sr(n.params,e??{});return s.logQuery(n.sql,m),o.bind(...m).all().then(({results:E})=>this.mapAllResult(E))}let u=await this.values(e);return this.mapAllResult(u)}mapAllResult(e,r){return r&&(e=Rs(e.results)),!this.fields&&!this.customResultMapper?e:this.customResultMapper?this.customResultMapper(e):e.map(n=>pn(this.fields,n,this.joinsNotNullableMap))}async get(e){let{fields:r,joinsNotNullableMap:n,query:s,logger:o,stmt:a,customResultMapper:u}=this;if(!r&&!u){let E=Sr(s.params,e??{});return o.logQuery(s.sql,E),a.bind(...E).all().then(({results:g})=>g[0])}let m=await this.values(e);if(m[0])return u?u(m):pn(r,m[0],n)}mapGetResult(e,r){return r&&(e=Rs(e.results)[0]),!this.fields&&!this.customResultMapper?e:this.customResultMapper?this.customResultMapper([e]):pn(this.fields,e,this.joinsNotNullableMap)}values(e){let r=Sr(this.query.params,e??{});return this.logger.logQuery(this.query.sql,r),this.stmt.bind(...r).raw()}isResponseInArrayMode(){return this._isResponseInArrayMode}};var Ps=class extends Zt{static{i(this,"DrizzleD1Database")}static[w]="D1Database";async batch(e){return this.session.batch(e)}};function Ku(t,e={}){let r=new Nn({casing:e.casing}),n;e.logger===!0?n=new un:e.logger!==!1&&(n=e.logger);let s;if(e.schema){let u=Mu(e.schema,$u);s={fullSchema:e.schema,schema:u.tables,tableNamesMap:u.tableNamesMap}}let o=new $n(t,r,s,{logger:n}),a=new Ps("async",r,o,s);return a.$client=t,a}i(Ku,"drizzle");var Fs={};Qs(Fs,{emailPreferenceEventsTable:()=>js,emailPreferencesTable:()=>Je});d();f();c();var Ql=zs(Hl(),1);var Je=_s("email_preferences",{userId:it("user_id").notNull(),channel:it("channel").notNull(),audience:it("audience").notNull(),createdAt:Or("created_at",{mode:"timestamp"}).notNull()},t=>({pk:Vu({columns:[t.userId,t.channel,t.audience]}),userIdx:Bn("email_preferences_user_idx").on(t.userId)})),js=_s("email_preference_events",{id:it("id").notNull().$defaultFn(Ql.createId).primaryKey(),userId:it("user_id").notNull(),channel:it("channel").notNull(),audience:it("audience").notNull(),action:it("action").notNull(),occurredAt:Or("occurred_at",{mode:"timestamp"}).notNull()},t=>({userIdx:Bn("email_pref_events_user_idx").on(t.userId),audienceIdx:Bn("email_pref_events_audience_idx").on(t.audience)}));var Op=new Set(["marketing","newsletter","service"]),Hn=class extends vp{static{i(this,"EmailPreferences")}get db(){return Ku(this.env.DB,{schema:Fs})}async trackAnalyticsEvent(e,r){if(!this.env.ANALYTICS){console.warn("Analytics service not configured");return}let n=new kl.CloudEvent({specversion:"1.0",type:e,source:"/email-preferences",id:crypto.randomUUID(),time:new Date().toISOString(),datacontenttype:"application/json",data:r});try{await this.env.ANALYTICS.fetch("https://analytics.internal/track",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:n,attributes:["user_id","channel","audience"]})})}catch(s){console.error("Failed to track analytics event",s)}}async fetch(e){return new URL(e.url).pathname==="/health"?new Response("ok",{headers:{"Content-Type":"text/plain"}}):new Response("Not Found",{status:404})}async setPreference(e,r){let n=this.validatePayload(r);if(!n.valid)throw new Error(n.error??"Validation failed");let s=n.value,o=await this.db.query.emailPreferencesTable.findFirst({where:ft(Ve(Je.userId,e),Ve(Je.channel,s.channel),Ve(Je.audience,s.audience))}),a=o!==void 0,u=new Date;s.status==="subscribed"?o||await this.db.insert(Je).values({userId:e,channel:s.channel,audience:s.audience,createdAt:u}):o&&await this.db.delete(Je).where(ft(Ve(Je.userId,e),Ve(Je.channel,s.channel),Ve(Je.audience,s.audience))),await this.db.insert(js).values({userId:e,channel:s.channel,audience:s.audience,action:s.status,occurredAt:u});let m=s.status==="subscribed"?"com.rawkode.academy.email.subscribed":"com.rawkode.academy.email.unsubscribed";await this.trackAnalyticsEvent(m,{user_id:e,channel:s.channel,audience:s.audience,source:s.source});let E={userId:e,channel:s.channel,audience:s.audience,status:s.status};return{success:!0,alreadySubscribed:a,preference:E}}async getPreferences(e,r,n){return(await this.db.query.emailPreferencesTable.findMany({where:ft(Ve(Je.userId,e),r?Ve(Je.channel,r):void 0,n?Ve(Je.audience,n):void 0)})).map(o=>({userId:o.userId,channel:o.channel,audience:o.audience,status:"subscribed"}))}validatePayload(e){if(!e||typeof e!="object")return{valid:!1,error:"Payload must be an object"};let r=(e.audience??"").toString().trim();if(!r)return{valid:!1,error:"Audience identifier is required"};let n=(e.channel??"marketing").toString().trim().toLowerCase(),s=Op.has(n)?n:"marketing",o=e.status==="unsubscribed"?"unsubscribed":"subscribed",a=e.source?e.source.toString().trim():void 0;return a&&a.length>255?{valid:!1,error:"Source field is too long (max 255 characters)"}:{valid:!0,value:{audience:r,channel:s,status:o,source:a}}}};var Zx=Hn;export{Zx as default};
/*! Bundled license information:

@noble/hashes/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
//# sourceMappingURL=main.js.map
