---
export const prerender = false;

import { css } from "styled-system/css";
import "../../../styles/global.css";
import BracketForm from "@/components/bracket/admin/BracketForm.vue";

const user = Astro.locals.user;

const ADMIN_USER_IDS = ["rawkode"];
const isAdmin = user && ADMIN_USER_IDS.includes(user.id);

if (!user) {
	return Astro.redirect(`/api/auth/sign-in?returnTo=${encodeURIComponent(Astro.url.pathname)}`);
}

if (!isAdmin) {
	return Astro.redirect("/");
}

const pageStyles = css({
	minHeight: "100vh",
	background: "linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #16213e 100%)",
	paddingBlock: "2rem",
	paddingInline: "1rem",
});

const containerStyles = css({
	maxWidth: "600px",
	marginInline: "auto",
});

const backLinkStyles = css({
	display: "inline-flex",
	alignItems: "center",
	gap: "0.5rem",
	color: "rgba(255, 255, 255, 0.6)",
	textDecoration: "none",
	fontSize: "0.875rem",
	marginBottom: "1.5rem",
	transition: "color 0.2s",
	"&:hover": {
		color: "white",
	},
});

const titleStyles = css({
	fontSize: "1.5rem",
	fontWeight: 700,
	color: "white",
	marginBottom: "2rem",
});

const cardStyles = css({
	background: "rgba(255, 255, 255, 0.03)",
	border: "1px solid rgba(255, 255, 255, 0.1)",
	borderRadius: "1rem",
	padding: "2rem",
});
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/x-icon" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width" />
		<title>New Bracket - Klustered '26</title>
	</head>
	<body>
		<main class={pageStyles}>
			<div class={containerStyles}>
				<a href="/admin" class={backLinkStyles}>
					<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
					</svg>
					Back to Admin
				</a>

				<h1 class={titleStyles}>Create New Bracket</h1>

				<div class={cardStyles}>
					<BracketForm
						client:load
						mode="create"
					/>
				</div>
			</div>
		</main>

		<script>
			document.addEventListener("astro:page-load", () => {
				const form = document.querySelector(".bracket-form");
				if (form) {
					form.addEventListener("success", (e: Event) => {
						const detail = (e as CustomEvent).detail;
						if (detail?.id) {
							window.location.href = `/admin/brackets/${detail.id}`;
						}
					});
					form.addEventListener("cancel", () => {
						window.location.href = "/admin";
					});
				}
			});
		</script>
	</body>
</html>
